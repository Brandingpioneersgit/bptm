import{j as e,d as A,k as D}from"./manager-dashboard-BSBEKJka.js";import{r as o}from"./react-vendor-z5qVsTvS.js";import"./shared-ui-DksRfdM8.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";import"./forms-F81hZsoD.js";const z=()=>{const[b,l]=o.useState(null);if(b)return e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"text-red-600 text-2xl",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-red-800",children:"Performance Scoring Error"})]}),e.jsx("p",{className:"text-red-700 mb-4",children:b}),e.jsx("button",{onClick:()=>l(null),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})});const i=A(),{user:x}=D(),[S,E]=o.useState([]),[a,k]=o.useState(""),[t,h]=o.useState({performance_period:"",overall_score:"",productivity_score:"",quality_score:"",communication_score:"",teamwork_score:"",attendance_score:"",performance_status:"satisfactory",is_low_performer:!1,notes:""}),[y,v]=o.useState(!1),[p,f]=o.useState(""),[_,j]=o.useState([]);o.useEffect(()=>{try{P()}catch(r){l(`Initialization error: ${r.message}`)}},[]),o.useEffect(()=>{if(a)try{N()}catch(r){l(`Error loading performance data: ${r.message}`)}},[a]);const P=async()=>{try{if(!i)throw new Error("Database connection not available");const{data:r,error:s}=await i.from("employees").select("id, name, email, department").order("name");if(s)throw console.error("Supabase error:",s),new Error(`Database error: ${s.message}`);E(r||[])}catch(r){console.error("Error fetching employees:",r),l(`Failed to load employees: ${r.message}`)}},N=async()=>{try{if(!i)throw new Error("Database connection not available");const{data:r,error:s}=await i.from("employee_performance").select("*").eq("employee_id",a).order("evaluation_date",{ascending:!1});if(s){if(console.error("Supabase error:",s),s.code==="PGRST116"||s.message.includes("does not exist")){j([]);return}throw new Error(`Database error: ${s.message}`)}j(r||[])}catch(r){console.error("Error fetching performance:",r),l(`Failed to load performance data: ${r.message}`)}},n=r=>{const{name:s,value:c,type:d,checked:g}=r.target;h(u=>({...u,[s]:d==="checkbox"?g:c}))},m=()=>{const s=[parseFloat(t.productivity_score)||0,parseFloat(t.quality_score)||0,parseFloat(t.communication_score)||0,parseFloat(t.teamwork_score)||0,parseFloat(t.attendance_score)||0].filter(c=>c>0);return s.length===0?0:(s.reduce((c,d)=>c+d,0)/s.length).toFixed(2)},w=r=>r>=9?"excellent":r>=7?"good":r>=5?"satisfactory":r>=3?"needs_improvement":"unsatisfactory",C=async r=>{r.preventDefault(),v(!0),f("");try{if(!a)throw new Error("Please select an employee");const s=m(),c=w(s),d=s<5,g={employee_id:a,performance_period:t.performance_period,overall_score:s,productivity_score:parseFloat(t.productivity_score)||null,quality_score:parseFloat(t.quality_score)||null,communication_score:parseFloat(t.communication_score)||null,teamwork_score:parseFloat(t.teamwork_score)||null,attendance_score:parseFloat(t.attendance_score)||null,performance_status:c,is_low_performer:d,evaluated_by:x==null?void 0:x.id,notes:t.notes},{error:u}=await i.from("employee_performance").insert([g]);if(u)throw u;f(`Performance evaluation submitted successfully! Overall Score: ${s}/10`),h({performance_period:"",overall_score:"",productivity_score:"",quality_score:"",communication_score:"",teamwork_score:"",attendance_score:"",performance_status:"satisfactory",is_low_performer:!1,notes:""}),N()}catch(s){console.error("Error submitting performance:",s),f(`Error: ${s.message}`)}finally{v(!1)}},F=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),q=r=>({excellent:"text-green-600 bg-green-100",good:"text-blue-600 bg-blue-100",satisfactory:"text-yellow-600 bg-yellow-100",needs_improvement:"text-orange-600 bg-orange-100",unsatisfactory:"text-red-600 bg-red-100"})[r]||"text-gray-600 bg-gray-100";return e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-lg",children:[e.jsx("h2",{className:"text-2xl font-bold flex items-center gap-2",children:"📊 Employee Performance Scoring"}),e.jsx("p",{className:"text-blue-100 mt-2",children:"Evaluate employee performance and identify development needs"})]}),e.jsxs("div",{className:"p-6",children:[p&&e.jsx("div",{className:`mb-4 p-4 rounded-lg ${p.includes("Error")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:p}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📝 New Performance Evaluation"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee *"}),e.jsxs("select",{value:a,onChange:r=>k(r.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Choose an employee..."}),S.map(r=>e.jsxs("option",{value:r.id,children:[r.name," - ",r.department]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Performance Period *"}),e.jsx("input",{type:"text",name:"performance_period",value:t.performance_period,onChange:n,placeholder:"e.g., Q1-2024, H1-2024, Jan-2024",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Productivity Score (0-10)"}),e.jsx("input",{type:"number",name:"productivity_score",value:t.productivity_score,onChange:n,min:"0",max:"10",step:"0.1",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quality Score (0-10)"}),e.jsx("input",{type:"number",name:"quality_score",value:t.quality_score,onChange:n,min:"0",max:"10",step:"0.1",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Communication Score (0-10)"}),e.jsx("input",{type:"number",name:"communication_score",value:t.communication_score,onChange:n,min:"0",max:"10",step:"0.1",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teamwork Score (0-10)"}),e.jsx("input",{type:"number",name:"teamwork_score",value:t.teamwork_score,onChange:n,min:"0",max:"10",step:"0.1",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attendance Score (0-10)"}),e.jsx("input",{type:"number",name:"attendance_score",value:t.attendance_score,onChange:n,min:"0",max:"10",step:"0.1",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(t.productivity_score||t.quality_score||t.communication_score||t.teamwork_score||t.attendance_score)&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Calculated Overall Score: ",e.jsxs("span",{className:"text-lg",children:[m(),"/10"]})]}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Status: ",w(m()),m()<5&&e.jsx("span",{className:"ml-2 text-red-600 font-medium",children:"⚠️ Low Performer - Will have access to Performance Concerns Form"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Evaluation Notes"}),e.jsx("textarea",{name:"notes",value:t.notes,onChange:n,rows:4,placeholder:"Additional comments, feedback, or recommendations...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("button",{type:"submit",disabled:y||!a,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium",children:y?"Submitting...":"Submit Performance Evaluation"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"📈 Performance History"}),a?e.jsx("div",{className:"space-y-4",children:_.length>0?_.map((r,s)=>e.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.performance_period}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Evaluated on ",F(r.evaluation_date)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[r.overall_score,"/10"]}),e.jsx("div",{className:`text-xs px-2 py-1 rounded-full ${q(r.performance_status)}`,children:r.performance_status.replace("_"," ")})]})]}),r.is_low_performer&&e.jsx("div",{className:"bg-red-100 border border-red-200 rounded p-2 mb-2",children:e.jsx("div",{className:"text-red-700 text-sm font-medium",children:"⚠️ Low Performer - Has access to Performance Concerns Form"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{children:["Productivity: ",r.productivity_score||"N/A"]}),e.jsxs("div",{children:["Quality: ",r.quality_score||"N/A"]}),e.jsxs("div",{children:["Communication: ",r.communication_score||"N/A"]}),e.jsxs("div",{children:["Teamwork: ",r.teamwork_score||"N/A"]}),e.jsxs("div",{children:["Attendance: ",r.attendance_score||"N/A"]})]}),r.notes&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("strong",{children:"Notes:"})," ",r.notes]})]},r.id)):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"No performance records found for this employee."})}):e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Select an employee to view their performance history."})]})]})]})]})})};export{z as default};
