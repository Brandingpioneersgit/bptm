import{d as S,k as C,j as e}from"./manager-dashboard-BSBEKJka.js";import{r as m}from"./react-vendor-z5qVsTvS.js";import{u as P,S as y,T as c,a as A}from"./shared-ui-DksRfdM8.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";import"./forms-F81hZsoD.js";const p={hiring_recommendation:{name:"Full-time Hire Recommendation",amount:3e3,currency:"INR",description:"Recommend a candidate who gets hired full-time (eligible after 3 months)",eligibilityMonths:3,proofFields:["recommended_candidate_name","appointment_letter_url"]},client_testimonial:{name:"Client Video Testimonial",amount:1e3,currency:"INR (Amazon Coupon)",description:"Get a video testimonial from client posted on YouTube",eligibilityMonths:0,proofFields:["client_name","testimonial_youtube_url"]},promotional_video:{name:"Department Promotional Video",amount:500,currency:"INR",description:"Create an advertisement/promotional video for your department",eligibilityMonths:0,proofFields:["video_title","video_description","promotional_video_url"]}},V=()=>{const{supabase:u}=S(),{showToast:o}=P(),{user:s}=C(),[i,h]=m.useState({incentive_type:"",recommended_candidate_name:"",appointment_letter_url:"",client_name:"",testimonial_youtube_url:"",video_title:"",video_description:"",promotional_video_url:""}),[a,b]=m.useState(null),[v,x]=m.useState(!1),[_,f]=m.useState([]);m.useEffect(()=>{s!=null&&s.email&&(j(),g())},[s]);const j=async()=>{try{const{data:t,error:n}=await u.from("employees").select("id, name, email, department, role").eq("email",s.email).single();if(n)throw n;b(t)}catch(t){console.error("Error fetching employee data:",t),o("Error loading employee information","error")}},g=async()=>{try{const{data:t,error:n}=await u.from("incentive_applications").select(`
          *,
          incentive_types!inner(type_name)
        `).eq("employee_email",s.email).order("created_at",{ascending:!1});if(n)throw n;f(t||[])}catch(t){console.error("Error fetching applications:",t)}},r=(t,n)=>{h(l=>({...l,[t]:n}))},N=()=>{var l;if(!i.incentive_type)return o("Please select an incentive type","error"),!1;const t=p[i.incentive_type],n=t.proofFields;for(const d of n)if(!((l=i[d])!=null&&l.trim()))return o(`Please fill in all required fields for ${t.name}`,"error"),!1;return i.incentive_type==="client_testimonial"&&!/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/.test(i.testimonial_youtube_url)?(o("Please enter a valid YouTube URL","error"),!1):i.incentive_type==="hiring_recommendation"&&i.appointment_letter_url&&!i.appointment_letter_url.includes("drive.google.com")?(o("Please provide a Google Drive link for the appointment letter","error"),!1):i.incentive_type==="promotional_video"&&i.promotional_video_url&&!i.promotional_video_url.includes("drive.google.com")?(o("Please provide a Google Drive link for the promotional video","error"),!1):!0},w=async t=>{if(t.preventDefault(),!(!N()||!a)){x(!0);try{const n={employee_id:a.id,employee_name:a.name,employee_email:a.email,department:a.department,incentive_type:i.incentive_type,...i.incentive_type==="hiring_recommendation"&&{recommended_candidate_name:i.recommended_candidate_name,appointment_letter_url:i.appointment_letter_url},...i.incentive_type==="client_testimonial"&&{client_name:i.client_name,testimonial_youtube_url:i.testimonial_youtube_url},...i.incentive_type==="promotional_video"&&{video_title:i.video_title,video_description:i.video_description,promotional_video_url:i.promotional_video_url}},{data:l,error:d}=await u.from("incentive_applications").insert([n]).select();if(d)throw d;o("Incentive application submitted successfully!","success"),h({incentive_type:"",recommended_candidate_name:"",appointment_letter_url:"",client_name:"",testimonial_youtube_url:"",video_title:"",video_description:"",promotional_video_url:""}),g()}catch(n){console.error("Error submitting application:",n),o("Error submitting application. Please try again.","error")}finally{x(!1)}}},D=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"disbursed":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},E=()=>{if(!i.incentive_type)return null;switch(p[i.incentive_type],i.incentive_type){case"hiring_recommendation":return e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{label:"Recommended Candidate Name *",value:i.recommended_candidate_name,onChange:t=>r("recommended_candidate_name",t.target.value),placeholder:"Enter the full name of the recommended candidate"}),e.jsxs("div",{children:[e.jsx(c,{label:"Appointment Letter Screenshot (Google Drive Link) *",value:i.appointment_letter_url,onChange:t=>r("appointment_letter_url",t.target.value),placeholder:"Paste Google Drive link to appointment letter screenshot"}),e.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["üìã Please upload the appointment letter screenshot to Google Drive and share access with: ",e.jsx("strong",{children:"brandingpioneers@gmail.com"})]})]}),e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-2",children:"‚è∞ Eligibility Notice"}),e.jsx("p",{className:"text-sm text-amber-700",children:"This incentive becomes eligible for approval 3 months after the candidate's joining date. Please ensure the candidate has completed 3 months of employment before applying."})]})]});case"client_testimonial":return e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{label:"Client Name *",value:i.client_name,onChange:t=>r("client_name",t.target.value),placeholder:"Enter the client's name or company name"}),e.jsxs("div",{children:[e.jsx(c,{label:"YouTube URL of Client Testimonial *",value:i.testimonial_youtube_url,onChange:t=>r("testimonial_youtube_url",t.target.value),placeholder:"https://www.youtube.com/watch?v=..."}),e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"üé• Please ensure the video testimonial is publicly accessible on YouTube and mentions our services."})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"üéÅ Reward"}),e.jsx("p",{className:"text-sm text-green-700",children:"Upon approval, you will receive a ‚Çπ1,000 Amazon coupon via email."})]})]});case"promotional_video":return e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{label:"Video Title *",value:i.video_title,onChange:t=>r("video_title",t.target.value),placeholder:"Enter a descriptive title for your promotional video"}),e.jsx(A,{label:"Video Description *",value:i.video_description,onChange:t=>r("video_description",t.target.value),placeholder:"Describe the content and purpose of your promotional video",rows:3}),e.jsxs("div",{children:[e.jsx(c,{label:"Promotional Video (Google Drive Link) *",value:i.promotional_video_url,onChange:t=>r("promotional_video_url",t.target.value),placeholder:"Paste Google Drive link to your promotional video"}),e.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["üìπ Please upload your promotional video to Google Drive and share access with: ",e.jsx("strong",{children:"brandingpioneers@gmail.com"})]})]})]});default:return null}};return a?e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Employee Incentive Application"}),e.jsx("p",{className:"text-gray-600",children:"Apply for performance-based incentives with proof of achievement"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"üë§ Employee Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",a.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Department:"})," ",a.department]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",a.email]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Submit New Application"}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsx(y,{title:"Select Incentive Type",children:e.jsx("div",{className:"space-y-4",children:Object.entries(p).map(([t,n])=>e.jsxs("label",{className:"flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"incentive_type",value:t,checked:i.incentive_type===t,onChange:l=>r("incentive_type",l.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:n.name}),e.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["‚Çπ",n.amount," ",n.currency]}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:n.description}),n.eligibilityMonths>0&&e.jsxs("div",{className:"text-xs text-amber-600 mt-1",children:["‚è∞ Eligible after ",n.eligibilityMonths," months"]})]})]},t))})}),i.incentive_type&&e.jsx(y,{title:"Proof Requirements",children:E()}),e.jsx("button",{type:"submit",disabled:v||!i.incentive_type,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:v?"Submitting Application...":"Submit Incentive Application"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"My Applications"}),_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìã"}),e.jsx("p",{className:"text-gray-600",children:"No applications submitted yet"})]}):e.jsx("div",{className:"space-y-4",children:_.map(t=>{var n;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:((n=p[t.incentive_type])==null?void 0:n.name)||t.incentive_type}),e.jsxs("p",{className:"text-sm text-green-600 font-medium",children:["‚Çπ",t.incentive_amount]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${D(t.status)}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Applied:"})," ",new Date(t.application_date).toLocaleDateString()]}),t.eligible_date&&e.jsxs("div",{children:[e.jsx("strong",{children:"Eligible:"})," ",new Date(t.eligible_date).toLocaleDateString()]}),t.reviewed_date&&e.jsxs("div",{children:[e.jsx("strong",{children:"Reviewed:"})," ",new Date(t.reviewed_date).toLocaleDateString()]}),t.hr_comments&&e.jsxs("div",{children:[e.jsx("strong",{children:"HR Comments:"})," ",t.hr_comments]})]})]},t.id)})})]})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"‚è≥"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Loading Employee Information"}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we fetch your employee details..."})]})})};export{V as default};
