import{d as T,j as e}from"./manager-dashboard-BSBEKJka.js";import{r as a}from"./react-vendor-z5qVsTvS.js";import{c as A,d as G,e as M}from"./arcadeValidation-D-laYFZz.js";import"./shared-ui-DksRfdM8.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";import"./forms-F81hZsoD.js";const K=({currentUser:i,onNavigate:N})=>{const c=T(),[_,q]=a.useState([]),[o,R]=a.useState(0),[t,x]=a.useState(null),[m,p]=a.useState(""),[P,k]=a.useState(!0),[h,d]=a.useState(!1),[S,g]=a.useState(!1),[y,l]=a.useState(""),[f,F]=a.useState("individual");a.useEffect(()=>{i!=null&&i.id&&(E(),j())},[i]);const E=async()=>{try{const{data:r,error:s}=await c.from("arcade_rewards").select("*").eq("availability_status","available").order("points_required",{ascending:!0});if(s){console.error("Error fetching rewards:",s),l("Failed to load rewards");return}q(r||[])}catch(r){console.error("Error:",r),l("Failed to load rewards")}},j=async()=>{try{const{data:r,error:s}=await c.from("arcade_points").select("current_points").eq("employee_id",i.id).single();if(s&&s.code!=="PGRST116"){console.error("Error fetching points:",s);return}R((r==null?void 0:r.current_points)||0)}catch(r){console.error("Error:",r)}finally{k(!1)}},H=async()=>{if(t){d(!0),l("");try{const r=A(i);if(!r.isEligible){l(r.reason),d(!1);return}const s={reward_id:t.id,points_required:t.points_required,reward_type:t.reward_type,manager_approval_requested:t.reward_name==="Work From Home (WFH)"},u=G(s,o,i);if(!u.isValid){l(u.errors.join(". ")),d(!1);return}if(!m.trim()){l("Please provide request details"),d(!1);return}const{data:n}=await c.from("arcade_activities").select("points_earned, created_at").eq("employee_id",i.id).eq("status","approved").order("created_at",{ascending:!0}),b=M(n||[]);b.hasExpiring&&console.warn(`Warning: ${b.expiringPoints} points will expire on ${b.expirationDate}`);const{data:B,error:w}=await c.from("arcade_redemptions").insert({employee_id:i.id,reward_type:t.reward_type,reward_name:t.reward_name,points_required:t.points_required,request_details:m.trim(),status:t.reward_name==="Work From Home (WFH)"?"pending_manager_approval":"pending"});if(w){console.error("Error submitting redemption:",w),l("Failed to submit redemption request. Please try again.");return}g(!0),x(null),p(""),j(),setTimeout(()=>g(!1),3e3)}catch(r){console.error("Error:",r),l("An unexpected error occurred. Please try again.")}finally{d(!1)}}},W=r=>_.filter(s=>s.reward_type===r),C=r=>o>=r,v=r=>({"Work From Home (WFH)":"🏠","Leave with Pay":"🌴","Movie Tickets (Pair)":"🎬","Lunch with Leader":"🍽️","Lunch for Two":"🥗","Software Purchase":"💻","Course Purchase":"📚","Netflix (3 Months)":"📺","Mystery Box":"🎁","Office Party":"🎉","One-day Trip":"🚌","Two-day Trip":"✈️","Board Game":"🎲","Gourmet Coffee/Tea Set":"☕","Bluetooth Accessories":"🎧","Gift Cards":"💳","Professional Development Tools":"🛠️","Wellness Products":"🧘","Entertainment Subscriptions":"🎮"})[r]||"🎁";return P?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading rewards..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"🛍️ Redeem Points"}),e.jsx("p",{className:"text-gray-600",children:"Spend your points on amazing rewards!"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"bg-white px-4 py-2 rounded-lg shadow",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Your Points: "}),e.jsx("span",{className:"text-xl font-bold text-purple-600",children:o})]}),e.jsx("button",{onClick:()=>N("arcade"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"← Back to Arcade"})]})]})}),S&&e.jsx("div",{className:"mb-6 bg-gray-100 border border-gray-400 text-gray-700 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"✅"}),e.jsx("span",{children:"Redemption request submitted successfully! HR will review and approve it."})]})}),y&&e.jsx("div",{className:"mb-6 bg-gray-100 border border-gray-400 text-gray-700 px-4 py-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-500 mr-2",children:"❌"}),e.jsx("span",{children:y})]})}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"individual",label:"Individual Rewards",icon:"👤"},{key:"group",label:"Group Rewards",icon:"👥"},{key:"mystery_box",label:"Mystery Box Items",icon:"🎁"}].map(r=>e.jsxs("button",{onClick:()=>F(r.key),className:`py-2 px-1 border-b-2 font-medium text-sm ${f===r.key?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:r.icon}),r.label]},r.key))})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:W(f).map(r=>{const s=C(r.points_required),n=!(r.reward_name==="Work From Home (WFH)")||o>=50;return e.jsxs("div",{className:`bg-white rounded-xl shadow-lg p-6 border-2 transition-all ${s&&n?"border-gray-200 hover:border-purple-300 hover:shadow-xl":"border-gray-200 opacity-60"}`,children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:v(r.reward_name)}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:r.reward_name}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsxs("span",{className:`text-2xl font-bold ${s&&n?"text-purple-600":"text-gray-400"}`,children:[r.points_required," pts"]}),!s&&e.jsxs("span",{className:"text-red-500 text-sm",children:["(Need ",r.points_required-o," more)"]})]})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:r.description}),r.special_requirements&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",r.special_requirements]})}),e.jsx("button",{onClick:()=>x(r),disabled:!s||!n,className:`w-full py-2 px-4 rounded-lg font-medium transition-colors ${s&&n?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:s&&n?"Redeem":"Insufficient Points"})]},r.id)})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-4xl mb-2",children:v(t.reward_name)}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:t.reward_name}),e.jsxs("p",{className:"text-purple-600 font-bold text-lg",children:[t.points_required," points"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"request_details",className:"block text-sm font-medium text-gray-700 mb-2",children:"Request Details *"}),e.jsx("textarea",{id:"request_details",rows:4,value:m,onChange:r=>p(r.target.value),placeholder:"Please provide any specific details for your redemption request (e.g., preferred dates for WFH, movie preferences, etc.)...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0})]}),t.special_requirements&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("span",{className:"font-medium",children:"Requirements:"})," ",t.special_requirements]})}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>{x(null),p(""),l("")},className:"flex-1 py-2 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:H,disabled:h||!m.trim(),className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting..."]}):"Submit Request"})]})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-3",children:"📋 Redemption Guidelines"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800",children:[e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:"• Points are non-transferable between employees"}),e.jsx("li",{children:"• All redemptions require HR approval"}),e.jsx("li",{children:"• Points are valid for one year from earning date"}),e.jsx("li",{children:"• WFH redemption requires manager approval"})]}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:"• Group rewards require collective point contribution"}),e.jsx("li",{children:"• Redemptions subject to business conditions"}),e.jsx("li",{children:"• Mystery box items are randomly assigned"}),e.jsx("li",{children:"• Allow 2-5 business days for processing"})]})]})]})]})})};export{K as default};
