import{d as E,j as e}from"./manager-dashboard-BSBEKJka.js";import{r as i}from"./react-vendor-z5qVsTvS.js";import"./shared-ui-DksRfdM8.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";import"./forms-F81hZsoD.js";const V=({currentUser:n,onNavigate:y})=>{const m=E(),[d,b]=i.useState([]),[o,v]=i.useState([]),[g,N]=i.useState([]),[_,w]=i.useState(!0),[c,A]=i.useState("activities"),[a,S]=i.useState("all"),[p,D]=i.useState("desc");i.useEffect(()=>{n!=null&&n.id&&(L(),P(),k())},[n]);const L=async()=>{try{const{data:t,error:s}=await m.from("arcade_activities").select("*").eq("employee_id",n.id).order("created_at",{ascending:!1});if(s){console.error("Error fetching activities:",s);return}b(t||[])}catch(t){console.error("Error:",t)}},P=async()=>{try{const{data:t,error:s}=await m.from("arcade_redemptions").select("*").eq("employee_id",n.id).order("created_at",{ascending:!1});if(s){console.error("Error fetching redemptions:",s);return}v(t||[])}catch(t){console.error("Error:",t)}},k=async()=>{try{const{data:t,error:s}=await m.from("arcade_audit_log").select("*").eq("employee_id",n.id).order("created_at",{ascending:!1});if(s){console.error("Error fetching audit log:",s);return}N(t||[])}catch(t){console.error("Error:",t)}finally{w(!1)}},h=t=>{const s={pending:"bg-gray-100 text-gray-800",approved:"bg-gray-100 text-gray-800",rejected:"bg-gray-100 text-gray-800",fulfilled:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s[t]||"bg-gray-100 text-gray-800"}`,children:t.charAt(0).toUpperCase()+t.slice(1)})},C=(t,s)=>{const l={client_engagement:"Client Engagement",content_creation:"Content Creation",attendance:"Attendance",performance:"Performance",polls:"Poll Performance"};return{whatsapp_appreciation:"WhatsApp Appreciation",google_review:"Google Review",video_testimonial:"Video Testimonial",client_referral:"Client Referral",bp_reel:"BP Reel",full_video:"Full Video",monthly_attendance:"100% Monthly Attendance",employee_referral:"Employee Referral",tactical_goals:"Tactical Goals",strategic_goals:"Strategic Goals",poll_first:"Poll - 1st Place",poll_second:"Poll - 2nd Place",poll_third:"Poll - 3rd Place"}[s]||`${l[t]||t} - ${s}`},u=()=>{let t=d;return a!=="all"&&(t=d.filter(s=>s.status===a)),t.sort((s,l)=>{const r=new Date(s.created_at),x=new Date(l.created_at);return p==="desc"?x-r:r-x})},f=()=>{let t=o;return a!=="all"&&(t=o.filter(s=>s.status===a)),t.sort((s,l)=>{const r=new Date(s.created_at),x=new Date(l.created_at);return p==="desc"?x-r:r-x})},j=()=>g.sort((t,s)=>{const l=new Date(t.created_at),r=new Date(s.created_at);return p==="desc"?r-l:l-r}),R=t=>({points_earned:"ðŸ’°",points_deducted:"âš ï¸",points_redeemed:"ðŸ›ï¸"})[t]||"ðŸ“",T=t=>({points_earned:"text-green-600",points_deducted:"text-red-600",points_redeemed:"text-purple-600"})[t]||"text-gray-600";return _?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your history..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"ðŸ“Š Arcade History"}),e.jsx("p",{className:"text-gray-600",children:"Track your activities, redemptions, and point changes"})]}),e.jsx("button",{onClick:()=>y("arcade"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"â† Back to Arcade"})]})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"activities",label:"Activities",icon:"ðŸ’°",count:d.length},{key:"redemptions",label:"Redemptions",icon:"ðŸ›ï¸",count:o.length},{key:"audit",label:"Audit Log",icon:"ðŸ“‹",count:g.length}].map(t=>e.jsxs("button",{onClick:()=>A(t.key),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${c===t.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{children:t.icon}),e.jsx("span",{children:t.label}),e.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs",children:t.count})]},t.key))})})}),(c==="activities"||c==="redemptions")&&e.jsxs("div",{className:"mb-6 flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Filter by Status"}),e.jsxs("select",{value:a,onChange:t=>S(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),c==="redemptions"&&e.jsx("option",{value:"fulfilled",children:"Fulfilled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sort Order"}),e.jsxs("select",{value:p,onChange:t=>D(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"desc",children:"Newest First"}),e.jsx("option",{value:"asc",children:"Oldest First"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg",children:[c==="activities"&&e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Activity History"}),u().length>0?e.jsx("div",{className:"space-y-4",children:u().map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:C(t.activity_type,t.activity_subtype)}),e.jsxs("span",{className:`font-bold ${t.status==="approved"?"text-green-600":"text-gray-600"}`,children:["+",t.points_earned," pts"]}),h(t.status)]}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.description}),t.proof_url&&e.jsx("a",{href:t.proof_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm",children:"ðŸ“Ž View Proof"})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[e.jsx("p",{children:new Date(t.created_at).toLocaleDateString()}),e.jsx("p",{children:new Date(t.created_at).toLocaleTimeString()}),t.approved_at&&e.jsxs("p",{className:"text-green-600 mt-1",children:["Approved: ",new Date(t.approved_at).toLocaleDateString()]})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"ðŸ“"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No activities found"}),e.jsx("p",{className:"text-sm text-gray-400",children:a==="all"?"Start earning points by logging activities!":`No ${a} activities found.`})]})]}),c==="redemptions"&&e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Redemption History"}),f().length>0?e.jsx("div",{className:"space-y-4",children:f().map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.reward_name}),e.jsxs("span",{className:"font-bold text-purple-600",children:["-",t.points_required," pts"]}),h(t.status)]}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.request_details}),e.jsxs("p",{className:"text-sm text-gray-500 capitalize",children:["Type: ",t.reward_type.replace("_"," ")]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-500",children:[e.jsx("p",{children:new Date(t.created_at).toLocaleDateString()}),e.jsx("p",{children:new Date(t.created_at).toLocaleTimeString()}),t.approved_at&&e.jsxs("p",{className:"text-green-600 mt-1",children:["Approved: ",new Date(t.approved_at).toLocaleDateString()]}),t.fulfilled_at&&e.jsxs("p",{className:"text-blue-600 mt-1",children:["Fulfilled: ",new Date(t.fulfilled_at).toLocaleDateString()]})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"ðŸ›ï¸"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No redemptions found"}),e.jsx("p",{className:"text-sm text-gray-400",children:a==="all"?"Start redeeming your points for rewards!":`No ${a} redemptions found.`})]})]}),c==="audit"&&e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Complete Audit Log"}),j().length>0?e.jsx("div",{className:"space-y-3",children:j().map(t=>e.jsx("div",{className:"border-l-4 border-gray-300 pl-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-xl",children:R(t.action_type)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.action_type.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-bold ${T(t.action_type)}`,children:[t.points_change>0?"+":"",t.points_change," pts"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(t.created_at).toLocaleDateString()," ",new Date(t.created_at).toLocaleTimeString()]})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"ðŸ“‹"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No audit log entries found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Point changes will appear here as they happen."})]})]})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-2",children:d.filter(t=>t.status==="approved").length}),e.jsx("p",{className:"text-gray-600",children:"Approved Activities"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 mb-2",children:o.filter(t=>t.status==="fulfilled").length}),e.jsx("p",{className:"text-gray-600",children:"Fulfilled Redemptions"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-2",children:d.filter(t=>t.status==="pending").length+o.filter(t=>t.status==="pending").length}),e.jsx("p",{className:"text-gray-600",children:"Pending Items"})]})]})]})})};export{V as default};
