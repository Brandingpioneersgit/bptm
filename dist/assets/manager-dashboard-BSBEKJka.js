import{r as i,R as q,a as ns,b as Zs}from"./react-vendor-z5qVsTvS.js";import{u as pe,T as ls,a as er,S as be}from"./shared-ui-DksRfdM8.js";import{C as tr,a as sr}from"./clients-Dg_kG3rU.js";import{c as os}from"./supabase-vendor-D6KV1zBy.js";import{A as rr}from"./auth-out34swX.js";import{E as ar,a as nr}from"./employees-C0R0oL0z.js";var is={exports:{}},dt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lr=i,or=Symbol.for("react.element"),ir=Symbol.for("react.fragment"),cr=Object.prototype.hasOwnProperty,dr=lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ur={key:!0,ref:!0,__self:!0,__source:!0};function cs(s,t,r){var a,n={},l=null,o=null;r!==void 0&&(l=""+r),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(o=t.ref);for(a in t)cr.call(t,a)&&!ur.hasOwnProperty(a)&&(n[a]=t[a]);if(s&&s.defaultProps)for(a in t=s.defaultProps,t)n[a]===void 0&&(n[a]=t[a]);return{$$typeof:or,type:s,key:l,ref:o,props:n,_owner:dr.current}}dt.Fragment=ir;dt.jsx=cs;dt.jsxs=cs;is.exports=dt;var e=is.exports;const mr="https://igwgryykglsetfvomhdj.supabase.co",hr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlnd2dyeXlrZ2xzZXRmdm9taGRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3NTcxMDgsImV4cCI6MjA3MDMzMzEwOH0.yL1hK263qf9msp7K4vUtF4Lvb7x7yxPcyvgkPiLokqA",ds=os(mr,hr),us=i.createContext(ds),dl=({children:s})=>e.jsx(us.Provider,{value:ds,children:s}),Ne=()=>{const s=i.useContext(us);if(!s)throw new Error("useSupabase must be used within a SupabaseProvider");return s},ms=i.createContext(),ul=({children:s})=>{const t=Ne(),{notify:r}=pe(),[a,n]=i.useState([]),[l,o]=i.useState([]),[c,d]=i.useState(!0),h=async()=>{try{const{data:u,error:b}=await t.from("clients").select("*").order("created_at",{ascending:!1});if(b)throw b;n(u||[])}catch(u){console.error("Error fetching clients:",u),r("Failed to fetch clients","error")}},m=async()=>{try{const{data:u,error:b}=await t.from("employees").select("*").order("created_at",{ascending:!1});if(b)throw b;o(u||[])}catch(u){console.error("Error fetching employees:",u),r("Failed to fetch employees","error")}},f=u=>{n(b=>[u,...b])},C=(u,b)=>{n(E=>E.map(y=>y.id===u?{...y,...b}:y))},x=u=>{n(b=>b.filter(E=>E.id!==u))},N=u=>{o(b=>[u,...b])},M=(u,b)=>{o(E=>E.map(y=>y.id===u?{...y,...b}:y))},S=u=>{o(b=>b.filter(E=>E.id!==u))};i.useEffect(()=>{(async()=>{d(!0),await Promise.all([h(),m()]),d(!1)})()},[]);const v={clients:a,employees:l,loading:c,fetchClients:h,fetchEmployees:m,addClient:f,updateClient:C,removeClient:x,addEmployee:N,updateEmployee:M,removeEmployee:S};return e.jsx(ms.Provider,{value:v,children:s})},Le=()=>{const s=i.useContext(ms);if(!s)throw new Error("useDataSync must be used within a DataSyncProvider");return s};async function xr(s){if(!s)return console.log("No Supabase client available"),!1;try{const{data:t,error:r}=await s.from("employees").select("count").limit(1);return r?r.code==="PGRST205"?(console.log("‚ö†Ô∏è  Employees table does not exist in the database."),console.log("üìã Please create the employees table manually in your Supabase dashboard."),console.log("üí° You can use the SQL from database/schemas/create_employees_table.sql"),[]):(console.error("Unexpected error checking employees table:",r),[]):(console.log("Employees table already exists"),!0)}catch(t){return console.error("Error in ensureEmployeesTableExists:",t),[]}}async function pr(s,t){if(!s)return console.log("No Supabase client available - running in local mode"),t;try{const{name:r,phone:a,department:n,role:l}=t;if(!r||!a)throw new Error("Employee name and phone are required");const{data:o,error:c}=await s.from("employees").select("*").eq("name",r).eq("phone",a).single();if(c&&c.code!=="PGRST116")throw c;if(o){if(o.department!==n||JSON.stringify(o.role)!==JSON.stringify(l)){const{data:f,error:C}=await s.from("employees").update({department:n,role:l,updated_at:new Date().toISOString()}).eq("id",o.id).select("*").single();if(C)throw C;return console.log("‚úÖ Employee updated:",f.name),f}return console.log("‚úÖ Employee found:",o.name),o}const{data:d,error:h}=await s.from("employees").insert({name:r,phone:a,email:`${a}@company.com`,department:n,role:l,status:"Active"}).select("*").single();if(h)throw h;return console.log("‚úÖ Employee created:",d.name),d}catch(r){return console.error("Error in getOrCreateEmployee:",r),t}}async function gr(s){if(!s)return console.log("No Supabase client available - running in local mode"),[];try{const{data:t,error:r}=await s.from("employees").select("*").eq("status","Active").order("name");if(r){if(r.code==="PGRST205")return console.log("Employees table does not exist"),[];throw r}return t||[]}catch(t){return console.error("Error fetching employees:",t),[]}}class hs{constructor(t,r){this.supabase=t,this.notify=r,this.tableChecks=new Map,this.retryAttempts=new Map}async handleError(t,r="database operation",a={}){const n=`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=new Date().toISOString();console.group(`üö® Database Error [${n}]`),console.error(`Operation: ${r}`),console.error(`Timestamp: ${l}`),console.error("Error:",t),console.error("Context:",a),console.groupEnd();const o=this.parseError(t);o.errorId=n,o.timestamp=l,o.operation=r,o.context=a;const c=a.retryAttempt||0,d=a.maxRetries||3,h=this.shouldRetry(t,r,c);this.logError(o);let m;switch(o.type){case"TABLE_NOT_FOUND":m=await this.handleTableNotFound(o,r,a);break;case"COLUMN_NOT_FOUND":m=await this.handleColumnNotFound(o,r,a);break;case"CONNECTION_ERROR":m=await this.handleConnectionError(o,r,a);break;case"VALIDATION_ERROR":m=await this.handleValidationError(o,r,a);break;case"PERMISSION_ERROR":m=await this.handlePermissionError(o,r,a);break;case"TIMEOUT_ERROR":m=await this.handleTimeoutError(o,r,a);break;case"RATE_LIMIT_ERROR":m=await this.handleRateLimitError(o,r,a);break;default:m=await this.handleGenericError(o,r,a)}if(h&&c<d&&m.retry){console.log(`üîÑ Retrying operation '${r}' (attempt ${c+1}/${d})`);const f=Math.min(1e3*Math.pow(2,c),1e4);return await new Promise(C=>setTimeout(C,f)),{...m,retry:!0,retryDelay:f,retryAttempt:c+1}}return m}parseError(t){const r=t==null?void 0:t.code,a=(t==null?void 0:t.message)||(t==null?void 0:t.toString())||"Unknown error";if(r==="PGRST205"||a.includes("relation")&&a.includes("does not exist")){const n=this.extractTableName(a);return{type:"TABLE_NOT_FOUND",code:r,message:a,tableName:n,userMessage:`Database table '${n}' is not set up yet.`}}if(r==="42703"||a.includes("column")&&a.includes("does not exist")){const n=this.extractColumnName(a);return{type:"COLUMN_NOT_FOUND",code:r,message:a,columnName:n,userMessage:`Database structure needs to be updated (missing column: ${n}).`}}return a.includes("network")||a.includes("connection")||a.includes("timeout")?{type:"CONNECTION_ERROR",code:r,message:a,userMessage:"Unable to connect to the database. Please check your internet connection."}:r==="23505"||a.includes("duplicate")||a.includes("unique constraint")?{type:"VALIDATION_ERROR",code:r,message:a,userMessage:"This record already exists or conflicts with existing data."}:r==="42501"||a.includes("permission")||a.includes("access")?{type:"PERMISSION_ERROR",code:r,message:a,userMessage:"You do not have permission to perform this action."}:a.includes("timeout")||a.includes("timed out")||t.name==="AbortError"?{type:"TIMEOUT_ERROR",code:r,message:a,userMessage:"The operation timed out. Please check your connection and try again."}:r==="429"||a.includes("rate limit")||a.includes("too many requests")?{type:"RATE_LIMIT_ERROR",code:r,message:a,userMessage:"Too many requests. Please wait a moment and try again."}:r>="500"&&r<"600"?{type:"SERVER_ERROR",code:r,message:a,userMessage:"Server error occurred. Please try again in a few moments."}:{type:"GENERIC_ERROR",code:r,message:a,userMessage:"An unexpected error occurred. Please try again."}}async handleTableNotFound(t,r,a){const{tableName:n}=t;return this.notify({type:"error",title:"Database Setup Required",message:`The ${n} table needs to be set up. Please contact your administrator or check the database setup guide.`,duration:8e3}),r.includes("fetch")||r.includes("load")?{data:[],error:null,fallback:!0}:{data:null,error:t,fallback:!0}}async handleColumnNotFound(t,r,a){const{columnName:n}=t;return this.notify({type:"warning",title:"Database Update Needed",message:`The database structure is outdated (missing: ${n}). Some features may not work properly.`,duration:6e3}),{data:null,error:t,fallback:!0}}async handleConnectionError(t,r,a){const n=`${r}_${Date.now()}`,l=this.retryAttempts.get(n)||0;return l<2?(this.retryAttempts.set(n,l+1),this.notify({type:"warning",title:"Connection Issue",message:`Retrying ${r}... (Attempt ${l+1}/3)`,duration:3e3}),await new Promise(o=>setTimeout(o,1e3*(l+1))),{retry:!0,attempt:l+1}):(this.notify({type:"error",title:"Connection Failed",message:"Unable to connect to the database after multiple attempts. Please check your internet connection and try again.",duration:8e3}),{data:null,error:t,fallback:!0})}async handleValidationError(t,r,a){return this.notify({type:"error",title:"Validation Error",message:t.userMessage,duration:5e3}),{data:null,error:t,fallback:!1}}async handlePermissionError(t,r,a){return this.notify({type:"error",title:"Access Denied",message:t.userMessage,duration:6e3}),{data:null,error:t,fallback:!1}}async handleTimeoutError(t,r,a){return this.notify({type:"warning",title:"Operation Timed Out",message:t.userMessage,duration:6e3}),{data:null,error:t,fallback:!0,retry:!0}}async handleRateLimitError(t,r,a){return this.notify({type:"warning",title:"Rate Limit Exceeded",message:t.userMessage,duration:8e3}),await new Promise(n=>setTimeout(n,5e3)),{data:null,error:t,fallback:!0,retry:!0}}async handleGenericError(t,r,a){return this.notify({type:"error",title:"Operation Failed",message:`${r} failed: ${t.userMessage}`,duration:5e3}),{data:null,error:t,fallback:!1}}extractTableName(t){const r=t.match(/relation "([^"]+)" does not exist/)||t.match(/table "([^"]+)" does not exist/)||t.match(/from "([^"]+)"/);return r?r[1]:"unknown"}extractColumnName(t){const r=t.match(/column "([^"]+)" does not exist/)||t.match(/column ([^\s]+) does not exist/);return r?r[1]:"unknown"}shouldRetry(t,r,a=0){const n=this.parseError(t);return n.type==="TABLE_NOT_FOUND"||n.type==="COLUMN_NOT_FOUND"||n.type==="VALIDATION_ERROR"||n.type==="PERMISSION_ERROR"?!1:n.type==="CONNECTION_ERROR"&&a<3||n.type==="TIMEOUT_ERROR"&&a<2||n.type==="RATE_LIMIT_ERROR"&&a<2}logError(t){try{const r=JSON.parse(localStorage.getItem("errorLog")||"[]");r.push({...t,userAgent:navigator.userAgent,url:window.location.href}),r.length>50&&r.splice(0,r.length-50),localStorage.setItem("errorLog",JSON.stringify(r))}catch(r){console.warn("Failed to log error:",r)}}}class fr{constructor(t,r,a){this.supabase=t,this.notify=r,this.openModal=a,this.errorHandler=new hs(t,r)}async submitForm(t,r={}){const{tableName:a="submissions",operation:n="insert",validationRules:l={},onSuccess:o=null,onError:c=null,showSuccessModal:d=!0}=r;try{const h=this.validateFormData(t,l);if(!h.isValid)return this.handleValidationFailure(h.errors),{success:!1,errors:h.errors};let m;if(n==="update"&&t.id?m=await this.supabase.from(a).update(t).eq("id",t.id).select().single():m=await this.supabase.from(a).insert([t]).select().single(),m.error)throw m.error;return d&&this.showSuccessModal(n,m.data),o&&await o(m.data),{success:!0,data:m.data}}catch(h){const m=await this.errorHandler.handleError(h,`form submission to ${a}`,{formData:t});return m.retry?this.submitForm(t,{...r,_retryAttempt:(r._retryAttempt||0)+1}):(c&&await c(m),{success:!1,error:m})}}validateFormData(t,r){const a=[];return r.required&&r.required.forEach(n=>{const l=this.getNestedValue(t,n);(!l||typeof l=="string"&&!l.trim())&&a.push(`${n} is required`)}),r.custom&&r.custom.forEach(n=>{const l=n(t);l!==!0&&a.push(l)}),{isValid:a.length===0,errors:a}}getNestedValue(t,r){return r.split(".").reduce((a,n)=>a==null?void 0:a[n],t)}handleValidationFailure(t){this.notify({type:"error",title:"Validation Failed",message:`Please fix the following issues:
${t.map((r,a)=>`${a+1}. ${r}`).join(`
`)}`,duration:8e3})}showSuccessModal(t,r){const a=t==="update"?"Updated Successfully":"Submitted Successfully",n=t==="update"?"Your changes have been saved.":"Your form has been submitted successfully.";this.openModal?this.openModal({title:a,content:n,actions:[{label:"OK",onClick:()=>{},variant:"primary"}]}):this.notify({type:"success",title:a,message:n,duration:5e3})}}function br(s,t,r=null){return{database:new hs(s,t),form:new fr(s,t,r)}}const xs=i.createContext(null),Tt=()=>{const s=i.useContext(xs);if(!s)throw new Error("useEmployeeSync must be used within an EmployeeSyncProvider");return s},ml=q.memo(({children:s})=>{const t=Ne(),{notify:r}=pe(),[a,n]=i.useState([]),[l,o]=i.useState(!0),[c,d]=i.useState(Date.now()),[h,m]=i.useState(null);i.useEffect(()=>{t&&r&&m(br(t,r))},[t,r]);const f=i.useCallback(async(p=!1,k=0)=>{if(!t)try{const $=localStorage.getItem("codex_employees")||"[]";let D=JSON.parse($);if(D.length===0){console.log("No employees found in localStorage, populating with test data...");const L=[{id:"emp_001",full_name:"Jessica Martinez",name:"Jessica Martinez",phone:"5551234567",email:"jessica.martinez@company.com",department:"Web",role:["Developer","Designer"],status:"Active",hire_date:"2023-01-15",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"emp_002",full_name:"David Thompson",name:"David Thompson",phone:"5551234568",email:"david.thompson@company.com",department:"Marketing",role:["Marketing Manager","Content Creator"],status:"Active",hire_date:"2023-02-20",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"emp_003",full_name:"Sarah Chen",name:"Sarah Chen",phone:"5551234569",email:"sarah.chen@company.com",department:"Sales",role:["Sales Executive","Client Manager"],status:"Active",hire_date:"2023-03-10",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"emp_004",full_name:"Michael Rodriguez",name:"Michael Rodriguez",phone:"5551234570",email:"michael.rodriguez@company.com",department:"HR",role:["HR Manager"],status:"Active",hire_date:"2023-04-05",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"emp_005",full_name:"Emily Johnson",name:"Emily Johnson",phone:"5551234571",email:"emily.johnson@company.com",department:"Web",role:["Full Stack Developer"],status:"Active",hire_date:"2023-05-12",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{id:"emp_006",full_name:"Alex Williams",name:"Alex Williams",phone:"5551234572",email:"alex.williams@company.com",department:"Marketing",role:["Digital Marketing Specialist"],status:"Active",hire_date:"2023-06-18",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];localStorage.setItem("codex_employees",JSON.stringify(L)),D=L,console.log("‚úÖ Populated localStorage with",L.length,"test employees")}return n(D),o(!1),D}catch($){return console.error("Error loading local employees:",$),n([]),o(!1),[]}try{p&&o(!0);const $=await xr(t);if(Array.isArray($))return n($),o(!1),$;const D=await gr(t);return n(D||[]),d(Date.now()),o(!1),D||[]}catch($){return console.error("Error fetching employees in sync context:",$),h?await h.database.handleError($,"fetch employees"):console.warn("Error handler not available, using fallback"),n([]),o(!1),[]}},[t]);i.useEffect(()=>{if(!t){f(!0);return}console.log("üë• Setting up real-time employee subscriptions...");const p=t.channel("employees_changes").on("postgres_changes",{event:"*",schema:"public",table:"employees"},k=>{console.log("üë• Real-time employees update:",k.eventType),f(!0)}).subscribe();return f(!0),()=>{console.log("üë• Cleaning up employee subscriptions..."),p.unsubscribe()}},[t,f]);const C=i.useCallback(async p=>{if(!t)try{const k=localStorage.getItem("codex_employees")||"[]",$=JSON.parse(k),D={id:`local_${Date.now()}`,...p,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},L=[D,...$];return localStorage.setItem("codex_employees",JSON.stringify(L)),n(L),D}catch(k){return console.error("Error saving employee to local storage:",k),null}try{const k=await pr(t,p);return n($=>$.find(L=>L.id===k.id)?$.map(L=>L.id===k.id?k:L):[k,...$]),k}catch(k){return console.error("Error adding employee:",k),h?await h.database.handleError(k,"add employee",{employeeData:p}):r({type:"error",title:"Failed to Add Employee",message:"Unable to add employee. Please try again.",duration:5e3}),null}},[t]),x=i.useCallback(async p=>{if(!t)try{const k=localStorage.getItem("codex_employees")||"[]",D=JSON.parse(k).map(L=>L.id===p.id?{...L,...p,updated_at:new Date().toISOString()}:L);return localStorage.setItem("codex_employees",JSON.stringify(D)),n(D),p}catch(k){return console.error("Error updating employee in local storage:",k),null}try{const{data:k,error:$}=await t.from("employees").update(p).eq("id",p.id).select("*").single();if($)throw $;return n(D=>D.map(L=>L.id===k.id?k:L)),k}catch(k){return console.error("Error updating employee:",k),h?await h.database.handleError(k,"update employee",{employeeData:p}):r({type:"error",title:"Failed to Update Employee",message:"Unable to update employee. Please try again.",duration:5e3}),null}},[t]),N=i.useCallback(async p=>{if(!t)try{const k=localStorage.getItem("codex_employees")||"[]",D=JSON.parse(k).filter(L=>L.id!==p);return localStorage.setItem("codex_employees",JSON.stringify(D)),n(D),!0}catch(k){return console.error("Error removing employee from local storage:",k),!1}try{const{error:k}=await t.from("employees").update({status:"Inactive"}).eq("id",p);if(k)throw k;return n($=>$.filter(D=>D.id!==p)),!0}catch(k){return console.error("Error removing employee:",k),!1}},[t]),M=i.useCallback(()=>f(!0),[f]),S=i.useCallback(p=>p==="All"?a:a.filter(k=>k.department===p),[a]),v=i.useCallback(p=>p==="All"?a:a.filter(k=>k.status===p),[a]),u=i.useCallback(()=>a.filter(p=>p.status==="Active"),[a]),b=i.useCallback(()=>u().map(k=>({value:`${k.name}|${k.phone}`,label:`${k.name} (${k.department})`,name:k.name,phone:k.phone,department:k.department,role:k.role,id:k.id})),[u]),E=i.useCallback((p,k)=>!p||!k?!1:a.some($=>$.name.trim().toLowerCase()===p.trim().toLowerCase()&&$.phone.trim()===k.trim()),[a]),y=i.useCallback((p,k)=>!p||!k?null:a.find($=>$.name.trim().toLowerCase()===p.trim().toLowerCase()&&$.phone.trim()===k.trim()),[a]),A=i.useCallback(async(p,k)=>{const $=y(p,k);if($)return $;if(t)try{const D=await A(t,p,k);return D&&n(L=>L.find(F=>F.id===D.id)?L:[D,...L]),D}catch(D){return console.error("Error fetching employee by identity:",D),null}return null},[t,y]),j=i.useMemo(()=>({employees:a,loading:l,lastRefresh:c,addEmployee:C,updateEmployee:x,removeEmployee:N,refreshEmployees:M,getEmployeesByDepartment:S,getEmployeesByStatus:v,getActiveEmployees:u,getEmployeeOptions:b,employeeExists:E,findEmployeeByIdentity:y,getEmployeeByIdentity:A}),[a,l,c,C,x,N,M,S,v,u,b,E,y,A]);return e.jsx(xs.Provider,{value:j,children:s})}),Et="https://igwgryykglsetfvomhdj.supabase.co",kt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlnd2dyeXlrZ2xzZXRmdm9taGRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3NTcxMDgsImV4cCI6MjA3MDMzMzEwOH0.yL1hK263qf9msp7K4vUtF4Lvb7x7yxPcyvgkPiLokqA",yr=Et.includes("placeholder")||kt.includes("placeholder");let Oe=null;if(!yr&&Et&&kt)try{Oe=os(Et,kt,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},db:{schema:"public"},global:{headers:{"x-client-info":"bptm-dashboard"}},realtime:{params:{eventsPerSecond:10}}})}catch(s){console.error("Failed to create Supabase client:",s),Oe=null}else console.log("üîß Running in LOCAL MODE - Supabase credentials not configured");const ps=i.createContext(null),He=()=>{const s=i.useContext(ps);if(!s)throw new Error("useUnifiedAuth must be used within a UnifiedAuthProvider");return s},Se={SEO:{category:"employee",department:"Marketing",dashboards:["seo_dashboard","employee_dashboard"]},Ads:{category:"employee",department:"Marketing",dashboards:["ads_dashboard","employee_dashboard"]},"Social Media":{category:"employee",department:"Marketing",dashboards:["social_dashboard","employee_dashboard"]},"YouTube SEO":{category:"employee",department:"Marketing",dashboards:["youtube_dashboard","employee_dashboard"]},"Web Developer":{category:"employee",department:"Technology",dashboards:["dev_dashboard","employee_dashboard"]},"Graphic Designer":{category:"employee",department:"Creative",dashboards:["design_dashboard","employee_dashboard"]},Freelancer:{category:"freelancer",department:null,dashboards:["freelancer_dashboard"]},Intern:{category:"intern",department:null,dashboards:["intern_dashboard"]},MASH:{category:"management",department:"Management",dashboards:["mash_dashboard","management_dashboard"]},"Operations Head":{category:"management",department:"Operations",dashboards:["operations_dashboard","management_dashboard"]},Accountant:{category:"admin",department:"Finance",dashboards:["accounting_dashboard","admin_dashboard"]},Sales:{category:"admin",department:"Sales",dashboards:["sales_dashboard","admin_dashboard"]},HR:{category:"admin",department:"Human Resources",dashboards:["hr_dashboard","admin_dashboard"]},"Super Admin":{category:"super_admin",department:"Administration",dashboards:["super_admin_dashboard","all_dashboards"]}},hl=({children:s})=>{const[t,r]=i.useState({isLoggedIn:!1,user:null,role:null,userCategory:null,permissions:{},dashboardAccess:[],sessionId:null,isLoading:!0,loginError:null}),[a,n]=i.useState({name:"",phone:"",selectedRole:""}),{notify:l}=pe(),o=i.useCallback(async(v,u,b)=>{var k,$;console.log("üß™ Using local fallback authentication");const y={"Super Admin":{name:"Admin Super",phone:"+91-9876543225",userId:"USR001"},Accountant:{name:"Michael Accountant",phone:"+91-9876543222",userId:"USR002"},Ads:{name:"Sarah Ads",phone:"+91-9876543211",userId:"USR003"},Freelancer:{name:"Alex Freelancer",phone:"+91-9876543216",userId:"USR004"},"Graphic Designer":{name:"Emma Design",phone:"+91-9876543215",userId:"USR005"},HR:{name:"Rachel HR",phone:"+91-9876543224",userId:"USR006"},SEO:{name:"John SEO",phone:"+91-9876543210",userId:"USR007"},"Social Media":{name:"Mike Social",phone:"+91-9876543212",userId:"USR008"},"Web Developer":{name:"David Dev",phone:"+91-9876543214",userId:"USR009"},"YouTube SEO":{name:"Lisa YouTube",phone:"+91-9876543213",userId:"USR010"},Intern:{name:"Priya Intern",phone:"+91-9876543218",userId:"USR011"},MASH:{name:"Robert MASH",phone:"+91-9876543220",userId:"USR012"},Sales:{name:"Amanda Sales",phone:"+91-9876543223",userId:"USR013"},"Operations Head":{name:"Jennifer Operations",phone:"+91-9876543221",userId:"USR014"}}[b];if(!y||y.name!==v.trim()||y.phone!==u.trim())throw new Error("Invalid credentials for selected role in test mode");const A={id:y.userId,user_id:y.userId,name:y.name,phone:y.phone,role:b,status:"active",email:`${y.userId.toLowerCase()}@bpagency.local`,user_category:(k=Se[b])==null?void 0:k.category,department:($=Se[b])==null?void 0:$.department},j={userId:A.id,sessionId:`session_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,expiresAt:new Date(Date.now()+24*60*60*1e3).toISOString()};localStorage.setItem("unified_auth_session",JSON.stringify(j));const p=Se[A.role];return r({isLoggedIn:!0,user:{id:A.id,name:A.name,phone:A.phone,email:A.email,role:A.role,user_category:A.user_category,department:A.department,permissions:{},dashboard_access:(p==null?void 0:p.dashboards)||[]},role:A.role,userCategory:A.user_category,permissions:{},dashboardAccess:(p==null?void 0:p.dashboards)||[],sessionId:j.sessionId,isLoading:!1,loginError:null}),n({name:"",phone:"",selectedRole:""}),l({title:`Welcome back, ${A.name}! (Local Mode)`,type:"success"}),{success:!0,user:A,isLocalFallback:!0}},[l]);i.useEffect(()=>{(async()=>{try{r(j=>({...j,isLoading:!0}));const u=localStorage.getItem("unified_auth_session");if(!u){r(j=>({...j,isLoading:!1}));return}const b=JSON.parse(u);if(new Date(b.expiresAt)<new Date){localStorage.removeItem("unified_auth_session"),r(j=>({...j,isLoading:!1}));return}const{data:E,error:y}=await Oe.from("unified_users").select("*").eq("id",b.userId).eq("status","active").single();if(y||!E){localStorage.removeItem("unified_auth_session"),r(j=>({...j,isLoading:!1}));return}const A=Se[E.role];r({isLoggedIn:!0,user:E,role:E.role,userCategory:E.user_category,permissions:E.permissions||{},dashboardAccess:E.dashboard_access||(A==null?void 0:A.dashboards)||[],sessionId:b.sessionId,isLoading:!1,loginError:null}),console.log("Session restored successfully for:",E.name)}catch(u){console.error("Session restoration failed:",u),localStorage.removeItem("unified_auth_session"),r(b=>({...b,isLoading:!1}))}})()},[]);const c=i.useCallback(async v=>{try{r($=>({...$,loginError:null}));const{name:u,phone:b,selectedRole:E}=v;if(console.log("üîê Login attempt:",{name:u,phone:b,selectedRole:E}),!u||!b||!E)throw new Error("Please fill in all required fields");if(!Se[E])throw new Error("Invalid role selected");if(!Oe)return console.log("‚ö†Ô∏è Supabase not available, using local fallback authentication"),await o(u,b,E);console.log("üîç Querying unified_users table...");const{data:y,error:A}=await Oe.from("unified_users").select("*").eq("name",u.trim()).eq("phone",b.trim()).eq("status","active").single();if(console.log("üìä Database query result:",{data:y,error:A}),A){if(console.error("‚ùå Database error:",A),A.code==="PGRST116")return console.log("üß™ User not found in database, trying local fallback..."),await o(u,b,E);throw new Error(`Database error: ${A.message}`)}if(!y)return console.log("üß™ No data returned from database, trying local fallback..."),await o(u,b,E);const j=y;if(j.role!==E)throw new Error(`Access denied. Your account role (${j.role}) does not match the selected role (${E})`);const p={userId:j.id,sessionId:`session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,expiresAt:new Date(Date.now()+24*60*60*1e3).toISOString()};localStorage.setItem("unified_auth_session",JSON.stringify(p));const k=Se[j.role];return r({isLoggedIn:!0,user:{id:j.id,name:j.name,phone:j.phone,email:j.email,role:j.role,user_category:j.user_category,department:j.department,permissions:j.permissions||{},dashboard_access:j.dashboard_access||(k==null?void 0:k.dashboards)||[]},role:j.role,userCategory:j.user_category,permissions:j.permissions||{},dashboardAccess:j.dashboard_access||(k==null?void 0:k.dashboards)||[],sessionId:p.sessionId,isLoading:!1,loginError:null}),n({name:"",phone:"",selectedRole:""}),l({title:`Welcome back, ${j.name}!`,type:"success"}),{success:!0,user:j}}catch(u){const b=u.message||"Login failed. Please try again.";return r(E=>({...E,loginError:b})),l({title:b,type:"error"}),{success:!1,error:b}}},[l]),d=i.useCallback(async()=>{try{localStorage.removeItem("unified_auth_session"),r({isLoggedIn:!1,user:null,role:null,userCategory:null,permissions:{},dashboardAccess:[],sessionId:null,isLoading:!1,loginError:null}),n({name:"",phone:"",selectedRole:""}),l({title:"Logged out successfully",type:"success"})}catch(v){console.error("Logout error:",v),l({title:"Logout failed",type:"error"})}},[l]),h=i.useCallback(v=>{n(u=>({...u,...v}))},[]),m=i.useCallback(()=>{r(v=>({...v,loginError:null}))},[]),f=i.useCallback((v,u)=>{if(!t.isLoggedIn||!t.role)return!1;if(t.role==="Super Admin")return!0;switch(t.userCategory){case"super_admin":return!0;case"management":case"admin":return["read","write","approve"].includes(u);case"employee":case"freelancer":case"intern":return["read","write"].includes(u)&&!v.includes("admin");default:return!1}},[t.isLoggedIn,t.role,t.userCategory]),C=i.useCallback(v=>t.isLoggedIn?t.role==="Super Admin"?!0:t.dashboardAccess.includes(v):!1,[t.isLoggedIn,t.role,t.dashboardAccess]),x=i.useCallback(async()=>{if(!t.isLoggedIn||!t.user)return!1;try{const v=new Date().toISOString().slice(0,7)+"-01",{data:u,error:b}=await Oe.from("monthly_form_submissions").select("id").eq("user_id",t.user.id).eq("submission_month",v).limit(1);return b?(console.error("Error checking monthly form submission:",b),!1):u.length===0}catch(v){return console.error("Error checking monthly form submission:",v),!1}},[t.isLoggedIn,t.user]),N=i.useCallback(()=>Object.keys(Se).sort(),[]),M=i.useCallback(v=>Se[v]||null,[]),S={authState:t,isLoggedIn:t.isLoggedIn,user:t.user,role:t.role,userCategory:t.userCategory,permissions:t.permissions,dashboardAccess:t.dashboardAccess,isLoading:t.isLoading,loginError:t.loginError,loginForm:a,updateLoginForm:h,login:c,logout:d,clearLoginError:m,hasPermission:f,hasDashboardAccess:C,needsMonthlyFormSubmission:x,getAvailableRoles:N,getRoleConfig:M,PREDEFINED_ROLES:Se};return e.jsx(ps.Provider,{value:S,children:s})},vr=q.createContext({toast:()=>{},showToast:()=>{},notify:()=>{}}),ut=()=>{const s=q.useContext(vr);return s||{toast:t=>{console.log("Toast:",t),t.title&&console.log(`${t.title}: ${t.description||""}`)},showToast:t=>{console.log("ShowToast:",t)},notify:t=>{console.log("Notify:",t)}}},gs=i.createContext(),xl=({children:s})=>{const[t,r]=i.useState({notifications:[],updates:[],lastSync:null}),{toast:a}=ut(),n=i.useCallback((h,m="info")=>{const f={id:Date.now(),message:h,type:m,timestamp:new Date().toISOString()};r(C=>({...C,notifications:[...C.notifications,f],lastSync:new Date().toISOString()})),a({title:h,variant:m==="error"?"destructive":"default"})},[a]),l=i.useCallback(h=>{r(m=>({...m,updates:[...m.updates,{id:Date.now(),data:h,timestamp:new Date().toISOString()}],lastSync:new Date().toISOString()}))},[]),o=i.useCallback(()=>{r(h=>({...h,notifications:[]}))},[]),c=i.useCallback((h=10)=>t.updates.sort((m,f)=>new Date(f.timestamp)-new Date(m.timestamp)).slice(0,h),[t.updates]),d={syncData:t,notify:n,syncUpdate:l,clearNotifications:o,getLatestUpdates:c};return e.jsx(gs.Provider,{value:d,children:s})},fs=()=>{const s=i.useContext(gs);if(!s)throw new Error("useCrossDashboardSync must be used within a CrossDashboardSyncProvider");return s},bs=i.createContext(),ys=()=>{const s=i.useContext(bs);if(!s)throw new Error("useRBAC must be used within an RBACProvider");return s},pl=({children:s})=>{const[t,r]=i.useState(null),[a,n]=i.useState(!0),[l,o]=i.useState({admin:{id:"admin",name:"Administrator",description:"Full system access and management capabilities",permissions:{manager:["read","write","delete","configure"],employee:["read","write","delete","configure"],agency:["read","write","delete","configure"],intern:["read","write","delete","configure"],system:["read","write","delete","configure","audit"]},dashboardAccess:["manager","employee","agency","intern"],features:{controlPanel:!0,analytics:!0,configuration:!0,reporting:!0,userManagement:!0,auditLogs:!0}},manager:{id:"manager",name:"Manager",description:"Management oversight and control capabilities",permissions:{manager:["read","write","configure"],employee:["read","write"],agency:["read","write"],intern:["read","write"],system:["read"]},dashboardAccess:["manager","employee","agency","intern"],features:{controlPanel:!0,analytics:!0,configuration:!0,reporting:!0,userManagement:!1,auditLogs:!1}},supervisor:{id:"supervisor",name:"Supervisor",description:"Team supervision and limited management access",permissions:{manager:["read"],employee:["read","write"],agency:["read"],intern:["read","write"],system:["read"]},dashboardAccess:["employee","intern"],features:{controlPanel:!1,analytics:!0,configuration:!1,reporting:!0,userManagement:!1,auditLogs:!1}},employee:{id:"employee",name:"Employee",description:"Standard employee access to personal dashboard",permissions:{manager:[],employee:["read","write"],agency:[],intern:[],system:[]},dashboardAccess:["employee"],features:{controlPanel:!1,analytics:!1,configuration:!1,reporting:!1,userManagement:!1,auditLogs:!1}},intern:{id:"intern",name:"Intern",description:"Intern access to learning and task management",permissions:{manager:[],employee:[],agency:[],intern:["read","write"],system:[]},dashboardAccess:["intern"],features:{controlPanel:!1,analytics:!1,configuration:!1,reporting:!1,userManagement:!1,auditLogs:!1}},agency:{id:"agency",name:"Agency User",description:"Agency dashboard access for client management",permissions:{manager:[],employee:["read"],agency:["read","write"],intern:[],system:[]},dashboardAccess:["agency"],features:{controlPanel:!1,analytics:!1,configuration:!1,reporting:!1,userManagement:!1,auditLogs:!1}}}),[c,d]=i.useState([{id:1,name:"John Manager",email:"john@company.com",role:"manager",active:!0},{id:2,name:"Jane Supervisor",email:"jane@company.com",role:"supervisor",active:!0},{id:3,name:"Bob Employee",email:"bob@company.com",role:"employee",active:!0},{id:4,name:"Alice Intern",email:"alice@company.com",role:"intern",active:!0},{id:5,name:"Carol Agency",email:"carol@agency.com",role:"agency",active:!0}]),{isLoggedIn:h,user:m,role:f}=He();i.useEffect(()=>{const y=setTimeout(()=>{if(h&&m){const A={id:m.user_id||Date.now(),name:m.name||"Unknown User",email:m.email||`${m.name}@company.com`,role:f||"employee",active:!0};r(A),localStorage.setItem("currentUser",JSON.stringify(A)),n(!1)}else a||(r(null),localStorage.removeItem("currentUser"))},a?1e3:0);return()=>clearTimeout(y)},[h,m,f,a]),i.useEffect(()=>{if(!h&&!t&&a){const y=localStorage.getItem("currentUser");if(y)try{r(JSON.parse(y)),n(!1)}catch(A){console.warn("Failed to parse saved user from localStorage:",A),localStorage.removeItem("currentUser"),n(!1)}else setTimeout(()=>n(!1),1e3)}},[h,t,a]);const E={currentUser:t,setCurrentUser:r,isInitializing:a,roles:l,users:c,hasPermission:(y,A)=>{var p;return!t||!l[t.role]?!1:((p=l[t.role].permissions[y])==null?void 0:p.includes(A))||!1},hasDashboardAccess:y=>!t||!l[t.role]?!1:l[t.role].dashboardAccess.includes(y),hasFeatureAccess:y=>!t||!l[t.role]?!1:l[t.role].features[y]||!1,updateUserRole:(y,A)=>{d(j=>j.map(p=>p.id===y?{...p,role:A}:p))},toggleUserStatus:y=>{d(A=>A.map(j=>j.id===y?{...j,active:!j.active}:j))},addUser:y=>{const A={id:Date.now(),...y,active:!0};d(j=>[...j,A])},removeUser:y=>{d(A=>A.filter(j=>j.id!==y))},updateRole:(y,A)=>{o(j=>({...j,[y]:{...j[y],...A}}))}};return e.jsx(bs.Provider,{value:E,children:s})},jr=()=>{const{roles:s,users:t,updateUserRole:r,toggleUserStatus:a,addUser:n,removeUser:l,updateRole:o}=ys(),{notify:c}=fs(),{showToast:d}=pe(),[h,m]=i.useState("users"),[f,C]=i.useState(null),[x,N]=i.useState(null),[M,S]=i.useState(!1),[v,u]=i.useState({name:"",email:"",role:"employee"}),b=(D,L)=>{r(D,L),c("User role updated",`User role has been changed to ${L}`,"info"),d("User role updated successfully","success")},E=D=>{a(D);const L=t.find(R=>R.id===D);c("User status changed",`${L.name} has been ${L.active?"deactivated":"activated"}`,"info"),d("User status updated successfully","success")},y=()=>{if(!v.name||!v.email){d("Please fill in all required fields","error");return}n(v),u({name:"",email:"",role:"employee"}),S(!1),c("New user added",`${v.name} has been added to the system`,"success"),d("User added successfully","success")},A=D=>{const L=t.find(R=>R.id===D);window.confirm(`Are you sure you want to remove ${L.name}?`)&&(l(D),c("User removed",`${L.name} has been removed from the system`,"warning"),d("User removed successfully","success"))},j=[{id:"users",label:"User Management",icon:"üë•"},{id:"roles",label:"Role Management",icon:"üîê"},{id:"permissions",label:"Permissions",icon:"‚ö°"}],p=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Users"}),e.jsx("button",{onClick:()=>S(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add New User"})]}),M&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 border",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New User"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",value:v.name,onChange:D=>u(L=>({...L,name:D.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("input",{type:"email",placeholder:"Email Address",value:v.email,onChange:D=>u(L=>({...L,email:D.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("select",{value:v.role,onChange:D=>u(L=>({...L,role:D.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(s).map(([D,L])=>e.jsx("option",{value:D,children:L.name},D))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add User"}),e.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"bg-white rounded-lg border overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(D=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:D.name}),e.jsx("div",{className:"text-sm text-gray-500",children:D.email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("select",{value:D.role,onChange:L=>b(D.id,L.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(s).map(([L,R])=>e.jsx("option",{value:L,children:R.name},L))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${D.active,"bg-gray-100 text-gray-800"}`,children:D.active?"Active":"Inactive"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>E(D.id),className:`px-3 py-1 rounded text-xs ${D.active,"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:D.active?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>A(D.id),className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200",children:"Remove"})]})]},D.id))})]})})]}),k=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Role Definitions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(s).map(([D,L])=>e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:L.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",t.filter(R=>R.role===D).length," users)"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:L.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Dashboard Access"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:L.dashboardAccess.map(R=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded",children:R},R))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Features"}),e.jsx("div",{className:"space-y-1",children:Object.entries(L.features).map(([R,F])=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600 capitalize",children:R.replace(/([A-Z])/g," $1").trim()}),e.jsx("span",{className:F?"text-green-600":"text-red-600",children:F?"‚úì":"‚úó"})]},R))})]})]})]},D))})]}),$=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Permission Matrix"}),e.jsxs("div",{className:"bg-white rounded-lg border overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Manager"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agency"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Intern"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"System"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Object.entries(s).map(([D,L])=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:L.name}),["manager","employee","agency","intern","system"].map(R=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("div",{className:"flex justify-center space-x-1",children:["read","write","delete","configure"].map(F=>{var Z,G;return e.jsx("span",{className:`w-2 h-2 rounded-full ${(Z=L.permissions[R])!=null&&Z.includes(F)?"bg-blue-500":"bg-gray-200"}`,title:`${F} ${(G=L.permissions[R])!=null&&G.includes(F)?"allowed":"denied"}`},F)})})},R))]},D))})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-50 text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Allowed"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-200 rounded-full"}),e.jsx("span",{children:"Denied"})]}),e.jsx("span",{children:"Permissions: Read ‚Ä¢ Write ‚Ä¢ Delete ‚Ä¢ Configure"})]})})]})]});return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border",children:[e.jsx("div",{className:"border-b border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:"üîê Role-Based Access Control"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage user roles, permissions, and dashboard access"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[t.filter(D=>D.active).length," active users"]})})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:j.map(D=>e.jsx("button",{onClick:()=>m(D.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${h===D.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[D.icon," ",D.label]})},D.id))})}),e.jsxs("div",{className:"p-6",children:[h==="users"&&p(),h==="roles"&&k(),h==="permissions"&&$()]})]})},vs=i.createContext(),gl=({children:s})=>{const t=Ne(),[r,a]=i.useState([]),[n,l]=i.useState([]),[o,c]=i.useState(!1),x={systemNotifications:r,userNotifications:n,loading:o,addSystemNotification:async N=>{try{const M={...N,id:Date.now().toString(),timestamp:new Date().toISOString(),read:!1};a(S=>[M,...S]),t&&await t.from("system_notifications").insert([M])}catch(M){console.error("Error adding system notification:",M)}},addUserNotification:async N=>{try{const M={...N,id:Date.now().toString(),timestamp:new Date().toISOString(),read:!1};l(S=>[M,...S]),t&&await t.from("user_notifications").insert([M])}catch(M){console.error("Error adding user notification:",M)}},markAsRead:(N,M=!1)=>{M?a(S=>S.map(v=>v.id===N?{...v,read:!0}:v)):l(S=>S.map(v=>v.id===N?{...v,read:!0}:v))},clearNotifications:(N=!1)=>{N?a([]):l([])},getUnreadCount:(N=!1)=>(N?r:n).filter(S=>!S.read).length};return e.jsx(vs.Provider,{value:x,children:s})},js=()=>{const s=i.useContext(vs);if(!s)throw new Error("useNotificationSystem must be used within a NotificationProvider");return s},wr=({className:s=""})=>{const{systemNotifications:t,markAsRead:r,clearNotifications:a}=js(),[n,l]=i.useState(!1),o=t.filter(c=>!c.read).length;return e.jsxs("div",{className:`relative ${s}`,children:[e.jsxs("button",{onClick:()=>l(!n),className:"relative p-2 text-gray-600 hover:text-gray-900 transition-colors",children:["üîî",o>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:o})]}),n&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"}),e.jsx("button",{onClick:()=>a(!0),className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear All"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:t.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No notifications"}):t.map(c=>e.jsx("div",{className:`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${c.read?"":"bg-blue-50"}`,onClick:()=>r(c.id,!0),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:c.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c.message}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(c.timestamp).toLocaleString()})]}),!c.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full ml-2 mt-1"})]})},c.id))})]})]})},ws=i.createContext(),fl=({children:s})=>{const[t,r]=i.useState([]),{toast:a}=ut(),n=i.useCallback((d,h={})=>{const m={id:Date.now(),action:d,details:h,timestamp:new Date().toISOString(),user:h.user||"Unknown User"};r(f=>[m,...f].slice(0,1e3))},[]),l=i.useCallback((d={})=>{let h=t;return d.action&&(h=h.filter(m=>m.action.toLowerCase().includes(d.action.toLowerCase()))),d.user&&(h=h.filter(m=>m.user.toLowerCase().includes(d.user.toLowerCase()))),d.dateFrom&&(h=h.filter(m=>new Date(m.timestamp)>=new Date(d.dateFrom))),d.dateTo&&(h=h.filter(m=>new Date(m.timestamp)<=new Date(d.dateTo))),h},[t]),o=i.useCallback(()=>{r([]),a({title:"Audit logs cleared",variant:"default"})},[a]),c={auditLogs:t,logUserAction:n,getAuditLogs:l,clearAuditLogs:o};return e.jsx(ws.Provider,{value:c,children:s})},Ns=()=>{const s=i.useContext(ws);if(!s)throw new Error("useAuditLogging must be used within an AuditProvider");return s},Nr=()=>{const{auditLogs:s,getAuditLogs:t,clearAuditLogs:r}=Ns(),[a,n]=i.useState(""),l=t({action:a});return e.jsxs("div",{className:"card-brand p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text",children:"Audit Logs"}),e.jsx("button",{onClick:r,className:"btn-brand-secondary text-sm",children:"Clear Logs"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Filter by action...",value:a,onChange:o=>n(o.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:l.length===0?e.jsx("p",{className:"text-brand-text-secondary text-center py-8",children:"No audit logs found"}):e.jsx("div",{className:"space-y-2",children:l.map(o=>e.jsx("div",{className:"bg-slate-50 dark:bg-slate-700 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-brand-text",children:o.action}),e.jsxs("p",{className:"text-sm text-brand-text-secondary",children:["User: ",o.user]}),o.details&&Object.keys(o.details).length>0&&e.jsxs("p",{className:"text-xs text-brand-text-secondary mt-1",children:["Details: ",JSON.stringify(o.details,null,2)]})]}),e.jsx("span",{className:"text-xs text-brand-text-secondary",children:new Date(o.timestamp).toLocaleString()})]})},o.id))})})]})};var Sr=Object.defineProperty,Cr=(s,t,r)=>t in s?Sr(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,bt=(s,t,r)=>(Cr(s,typeof t!="symbol"?t+"":t,r),r);let Er=class{constructor(){bt(this,"current",this.detect()),bt(this,"handoffState","pending"),bt(this,"currentId",0)}set(t){this.current!==t&&(this.handoffState="pending",this.currentId=0,this.current=t)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Ce=new Er,ye=(s,t)=>{Ce.isServer?i.useEffect(s,t):i.useLayoutEffect(s,t)};function Ee(s){let t=i.useRef(s);return ye(()=>{t.current=s},[s]),t}let se=function(s){let t=Ee(s);return q.useCallback((...r)=>t.current(...r),[t])};function mt(s){typeof queueMicrotask=="function"?queueMicrotask(s):Promise.resolve().then(s).catch(t=>setTimeout(()=>{throw t}))}function $e(){let s=[],t={addEventListener(r,a,n,l){return r.addEventListener(a,n,l),t.add(()=>r.removeEventListener(a,n,l))},requestAnimationFrame(...r){let a=requestAnimationFrame(...r);return t.add(()=>cancelAnimationFrame(a))},nextFrame(...r){return t.requestAnimationFrame(()=>t.requestAnimationFrame(...r))},setTimeout(...r){let a=setTimeout(...r);return t.add(()=>clearTimeout(a))},microTask(...r){let a={current:!0};return mt(()=>{a.current&&r[0]()}),t.add(()=>{a.current=!1})},style(r,a,n){let l=r.style.getPropertyValue(a);return Object.assign(r.style,{[a]:n}),this.add(()=>{Object.assign(r.style,{[a]:l})})},group(r){let a=$e();return r(a),this.add(()=>a.dispose())},add(r){return s.push(r),()=>{let a=s.indexOf(r);if(a>=0)for(let n of s.splice(a,1))n()}},dispose(){for(let r of s.splice(0))r()}};return t}function It(){let[s]=i.useState($e);return i.useEffect(()=>()=>s.dispose(),[s]),s}function kr(){let s=typeof document>"u";return(t=>t.useSyncExternalStore)(ns)(()=>()=>{},()=>!1,()=>!s)}function ze(){let s=kr(),[t,r]=i.useState(Ce.isHandoffComplete);return t&&Ce.isHandoffComplete===!1&&r(!1),i.useEffect(()=>{t!==!0&&r(!0)},[t]),i.useEffect(()=>Ce.handoff(),[]),s?!1:t}var Xt;let Ve=(Xt=q.useId)!=null?Xt:function(){let s=ze(),[t,r]=q.useState(s?()=>Ce.nextId():null);return ye(()=>{t===null&&r(Ce.nextId())},[t]),t!=null?""+t:void 0};function me(s,t,...r){if(s in t){let n=t[s];return typeof n=="function"?n(...r):n}let a=new Error(`Tried to handle "${s}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(n=>`"${n}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,me),a}function Ss(s){return Ce.isServer?null:s instanceof Node?s.ownerDocument:s!=null&&s.hasOwnProperty("current")&&s.current instanceof Node?s.current.ownerDocument:document}let Mt=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(s=>`${s}:not([tabindex='-1'])`).join(",");var _e=(s=>(s[s.First=1]="First",s[s.Previous=2]="Previous",s[s.Next=4]="Next",s[s.Last=8]="Last",s[s.WrapAround=16]="WrapAround",s[s.NoScroll=32]="NoScroll",s))(_e||{}),Cs=(s=>(s[s.Error=0]="Error",s[s.Overflow=1]="Overflow",s[s.Success=2]="Success",s[s.Underflow=3]="Underflow",s))(Cs||{}),Mr=(s=>(s[s.Previous=-1]="Previous",s[s.Next=1]="Next",s))(Mr||{});function Ar(s=document.body){return s==null?[]:Array.from(s.querySelectorAll(Mt)).sort((t,r)=>Math.sign((t.tabIndex||Number.MAX_SAFE_INTEGER)-(r.tabIndex||Number.MAX_SAFE_INTEGER)))}var Es=(s=>(s[s.Strict=0]="Strict",s[s.Loose=1]="Loose",s))(Es||{});function Dr(s,t=0){var r;return s===((r=Ss(s))==null?void 0:r.body)?!1:me(t,{0(){return s.matches(Mt)},1(){let a=s;for(;a!==null;){if(a.matches(Mt))return!0;a=a.parentElement}return!1}})}var Rr=(s=>(s[s.Keyboard=0]="Keyboard",s[s.Mouse=1]="Mouse",s))(Rr||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",s=>{s.metaKey||s.altKey||s.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",s=>{s.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:s.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function Ie(s){s==null||s.focus({preventScroll:!0})}let Lr=["textarea","input"].join(",");function _r(s){var t,r;return(r=(t=s==null?void 0:s.matches)==null?void 0:t.call(s,Lr))!=null?r:!1}function Pr(s,t=r=>r){return s.slice().sort((r,a)=>{let n=t(r),l=t(a);if(n===null||l===null)return 0;let o=n.compareDocumentPosition(l);return o&Node.DOCUMENT_POSITION_FOLLOWING?-1:o&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function at(s,t,{sorted:r=!0,relativeTo:a=null,skipElements:n=[]}={}){let l=Array.isArray(s)?s.length>0?s[0].ownerDocument:document:s.ownerDocument,o=Array.isArray(s)?r?Pr(s):s:Ar(s);n.length>0&&o.length>1&&(o=o.filter(x=>!n.includes(x))),a=a??l.activeElement;let c=(()=>{if(t&5)return 1;if(t&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),d=(()=>{if(t&1)return 0;if(t&2)return Math.max(0,o.indexOf(a))-1;if(t&4)return Math.max(0,o.indexOf(a))+1;if(t&8)return o.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),h=t&32?{preventScroll:!0}:{},m=0,f=o.length,C;do{if(m>=f||m+f<=0)return 0;let x=d+m;if(t&16)x=(x+f)%f;else{if(x<0)return 3;if(x>=f)return 1}C=o[x],C==null||C.focus(h),m+=c}while(C!==l.activeElement);return t&6&&_r(C)&&C.select(),2}function ks(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function Tr(){return/Android/gi.test(window.navigator.userAgent)}function Ir(){return ks()||Tr()}function et(s,t,r){let a=Ee(t);i.useEffect(()=>{function n(l){a.current(l)}return document.addEventListener(s,n,r),()=>document.removeEventListener(s,n,r)},[s,r])}function Ms(s,t,r){let a=Ee(t);i.useEffect(()=>{function n(l){a.current(l)}return window.addEventListener(s,n,r),()=>window.removeEventListener(s,n,r)},[s,r])}function $r(s,t,r=!0){let a=i.useRef(!1);i.useEffect(()=>{requestAnimationFrame(()=>{a.current=r})},[r]);function n(o,c){if(!a.current||o.defaultPrevented)return;let d=c(o);if(d===null||!d.getRootNode().contains(d)||!d.isConnected)return;let h=function m(f){return typeof f=="function"?m(f()):Array.isArray(f)||f instanceof Set?f:[f]}(s);for(let m of h){if(m===null)continue;let f=m instanceof HTMLElement?m:m.current;if(f!=null&&f.contains(d)||o.composed&&o.composedPath().includes(f))return}return!Dr(d,Es.Loose)&&d.tabIndex!==-1&&o.preventDefault(),t(o,d)}let l=i.useRef(null);et("pointerdown",o=>{var c,d;a.current&&(l.current=((d=(c=o.composedPath)==null?void 0:c.call(o))==null?void 0:d[0])||o.target)},!0),et("mousedown",o=>{var c,d;a.current&&(l.current=((d=(c=o.composedPath)==null?void 0:c.call(o))==null?void 0:d[0])||o.target)},!0),et("click",o=>{Ir()||l.current&&(n(o,()=>l.current),l.current=null)},!0),et("touchend",o=>n(o,()=>o.target instanceof HTMLElement?o.target:null),!0),Ms("blur",o=>n(o,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function Ye(...s){return i.useMemo(()=>Ss(...s),[...s])}let As=Symbol();function Or(s,t=!0){return Object.assign(s,{[As]:t})}function je(...s){let t=i.useRef(s);i.useEffect(()=>{t.current=s},[s]);let r=se(a=>{for(let n of t.current)n!=null&&(typeof n=="function"?n(a):n.current=a)});return s.every(a=>a==null||(a==null?void 0:a[As]))?void 0:r}function $t(s,t){let r=i.useRef([]),a=se(s);i.useEffect(()=>{let n=[...r.current];for(let[l,o]of t.entries())if(r.current[l]!==o){let c=a(t,n);return r.current=t,c}},[a,...t])}function lt(...s){return Array.from(new Set(s.flatMap(t=>typeof t=="string"?t.split(" "):[]))).filter(Boolean).join(" ")}var ot=(s=>(s[s.None=0]="None",s[s.RenderStrategy=1]="RenderStrategy",s[s.Static=2]="Static",s))(ot||{}),De=(s=>(s[s.Unmount=0]="Unmount",s[s.Hidden=1]="Hidden",s))(De||{});function ve({ourProps:s,theirProps:t,slot:r,defaultTag:a,features:n,visible:l=!0,name:o,mergeRefs:c}){c=c??Ur;let d=Ds(t,s);if(l)return tt(d,r,a,o,c);let h=n??0;if(h&2){let{static:m=!1,...f}=d;if(m)return tt(f,r,a,o,c)}if(h&1){let{unmount:m=!0,...f}=d;return me(m?0:1,{0(){return null},1(){return tt({...f,hidden:!0,style:{display:"none"}},r,a,o,c)}})}return tt(d,r,a,o,c)}function tt(s,t={},r,a,n){let{as:l=r,children:o,refName:c="ref",...d}=yt(s,["unmount","static"]),h=s.ref!==void 0?{[c]:s.ref}:{},m=typeof o=="function"?o(t):o;"className"in d&&d.className&&typeof d.className=="function"&&(d.className=d.className(t));let f={};if(t){let C=!1,x=[];for(let[N,M]of Object.entries(t))typeof M=="boolean"&&(C=!0),M===!0&&x.push(N);C&&(f["data-headlessui-state"]=x.join(" "))}if(l===i.Fragment&&Object.keys(Zt(d)).length>0){if(!i.isValidElement(m)||Array.isArray(m)&&m.length>1)throw new Error(['Passing props on "Fragment"!',"",`The current component <${a} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(d).map(M=>`  - ${M}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(M=>`  - ${M}`).join(`
`)].join(`
`));let C=m.props,x=typeof(C==null?void 0:C.className)=="function"?(...M)=>lt(C==null?void 0:C.className(...M),d.className):lt(C==null?void 0:C.className,d.className),N=x?{className:x}:{};return i.cloneElement(m,Object.assign({},Ds(m.props,Zt(yt(d,["ref"]))),f,h,{ref:n(m.ref,h.ref)},N))}return i.createElement(l,Object.assign({},yt(d,["ref"]),l!==i.Fragment&&h,l!==i.Fragment&&f),m)}function Ur(...s){return s.every(t=>t==null)?void 0:t=>{for(let r of s)r!=null&&(typeof r=="function"?r(t):r.current=t)}}function Ds(...s){if(s.length===0)return{};if(s.length===1)return s[0];let t={},r={};for(let a of s)for(let n in a)n.startsWith("on")&&typeof a[n]=="function"?(r[n]!=null||(r[n]=[]),r[n].push(a[n])):t[n]=a[n];if(t.disabled||t["aria-disabled"])return Object.assign(t,Object.fromEntries(Object.keys(r).map(a=>[a,void 0])));for(let a in r)Object.assign(t,{[a](n,...l){let o=r[a];for(let c of o){if((n instanceof Event||(n==null?void 0:n.nativeEvent)instanceof Event)&&n.defaultPrevented)return;c(n,...l)}}});return t}function fe(s){var t;return Object.assign(i.forwardRef(s),{displayName:(t=s.displayName)!=null?t:s.name})}function Zt(s){let t=Object.assign({},s);for(let r in t)t[r]===void 0&&delete t[r];return t}function yt(s,t=[]){let r=Object.assign({},s);for(let a of t)a in r&&delete r[a];return r}let Fr="div";var it=(s=>(s[s.None=1]="None",s[s.Focusable=2]="Focusable",s[s.Hidden=4]="Hidden",s))(it||{});function Hr(s,t){var r;let{features:a=1,...n}=s,l={ref:t,"aria-hidden":(a&2)===2?!0:(r=n["aria-hidden"])!=null?r:void 0,hidden:(a&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(a&4)===4&&(a&2)!==2&&{display:"none"}}};return ve({ourProps:l,theirProps:n,slot:{},defaultTag:Fr,name:"Hidden"})}let At=fe(Hr),Ot=i.createContext(null);Ot.displayName="OpenClosedContext";var ge=(s=>(s[s.Open=1]="Open",s[s.Closed=2]="Closed",s[s.Closing=4]="Closing",s[s.Opening=8]="Opening",s))(ge||{});function Ut(){return i.useContext(Ot)}function zr({value:s,children:t}){return q.createElement(Ot.Provider,{value:s},t)}function Vr(s){function t(){document.readyState!=="loading"&&(s(),document.removeEventListener("DOMContentLoaded",t))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",t),t())}let Ae=[];Vr(()=>{function s(t){t.target instanceof HTMLElement&&t.target!==document.body&&Ae[0]!==t.target&&(Ae.unshift(t.target),Ae=Ae.filter(r=>r!=null&&r.isConnected),Ae.splice(10))}window.addEventListener("click",s,{capture:!0}),window.addEventListener("mousedown",s,{capture:!0}),window.addEventListener("focus",s,{capture:!0}),document.body.addEventListener("click",s,{capture:!0}),document.body.addEventListener("mousedown",s,{capture:!0}),document.body.addEventListener("focus",s,{capture:!0})});function qr(s){let t=s.parentElement,r=null;for(;t&&!(t instanceof HTMLFieldSetElement);)t instanceof HTMLLegendElement&&(r=t),t=t.parentElement;let a=(t==null?void 0:t.getAttribute("disabled"))==="";return a&&Br(r)?!1:a}function Br(s){if(!s)return!1;let t=s.previousElementSibling;for(;t!==null;){if(t instanceof HTMLLegendElement)return!1;t=t.previousElementSibling}return!0}var Rs=(s=>(s.Space=" ",s.Enter="Enter",s.Escape="Escape",s.Backspace="Backspace",s.Delete="Delete",s.ArrowLeft="ArrowLeft",s.ArrowUp="ArrowUp",s.ArrowRight="ArrowRight",s.ArrowDown="ArrowDown",s.Home="Home",s.End="End",s.PageUp="PageUp",s.PageDown="PageDown",s.Tab="Tab",s))(Rs||{});function Ls(s,t,r,a){let n=Ee(r);i.useEffect(()=>{s=s??window;function l(o){n.current(o)}return s.addEventListener(t,l,a),()=>s.removeEventListener(t,l,a)},[s,t,a])}function Qe(){let s=i.useRef(!1);return ye(()=>(s.current=!0,()=>{s.current=!1}),[]),s}function _s(s){let t=se(s),r=i.useRef(!1);i.useEffect(()=>(r.current=!1,()=>{r.current=!0,mt(()=>{r.current&&t()})}),[t])}var Ge=(s=>(s[s.Forwards=0]="Forwards",s[s.Backwards=1]="Backwards",s))(Ge||{});function Wr(){let s=i.useRef(0);return Ms("keydown",t=>{t.key==="Tab"&&(s.current=t.shiftKey?1:0)},!0),s}function Ps(s){if(!s)return new Set;if(typeof s=="function")return new Set(s());let t=new Set;for(let r of s.current)r.current instanceof HTMLElement&&t.add(r.current);return t}let Kr="div";var Ts=(s=>(s[s.None=1]="None",s[s.InitialFocus=2]="InitialFocus",s[s.TabLock=4]="TabLock",s[s.FocusLock=8]="FocusLock",s[s.RestoreFocus=16]="RestoreFocus",s[s.All=30]="All",s))(Ts||{});function Jr(s,t){let r=i.useRef(null),a=je(r,t),{initialFocus:n,containers:l,features:o=30,...c}=s;ze()||(o=1);let d=Ye(r);Qr({ownerDocument:d},!!(o&16));let h=Xr({ownerDocument:d,container:r,initialFocus:n},!!(o&2));Zr({ownerDocument:d,container:r,containers:l,previousActiveElement:h},!!(o&8));let m=Wr(),f=se(M=>{let S=r.current;S&&(v=>v())(()=>{me(m.current,{[Ge.Forwards]:()=>{at(S,_e.First,{skipElements:[M.relatedTarget]})},[Ge.Backwards]:()=>{at(S,_e.Last,{skipElements:[M.relatedTarget]})}})})}),C=It(),x=i.useRef(!1),N={ref:a,onKeyDown(M){M.key=="Tab"&&(x.current=!0,C.requestAnimationFrame(()=>{x.current=!1}))},onBlur(M){let S=Ps(l);r.current instanceof HTMLElement&&S.add(r.current);let v=M.relatedTarget;v instanceof HTMLElement&&v.dataset.headlessuiFocusGuard!=="true"&&(Is(S,v)||(x.current?at(r.current,me(m.current,{[Ge.Forwards]:()=>_e.Next,[Ge.Backwards]:()=>_e.Previous})|_e.WrapAround,{relativeTo:M.target}):M.target instanceof HTMLElement&&Ie(M.target)))}};return q.createElement(q.Fragment,null,!!(o&4)&&q.createElement(At,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:f,features:it.Focusable}),ve({ourProps:N,theirProps:c,defaultTag:Kr,name:"FocusTrap"}),!!(o&4)&&q.createElement(At,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:f,features:it.Focusable}))}let Gr=fe(Jr),We=Object.assign(Gr,{features:Ts});function Yr(s=!0){let t=i.useRef(Ae.slice());return $t(([r],[a])=>{a===!0&&r===!1&&mt(()=>{t.current.splice(0)}),a===!1&&r===!0&&(t.current=Ae.slice())},[s,Ae,t]),se(()=>{var r;return(r=t.current.find(a=>a!=null&&a.isConnected))!=null?r:null})}function Qr({ownerDocument:s},t){let r=Yr(t);$t(()=>{t||(s==null?void 0:s.activeElement)===(s==null?void 0:s.body)&&Ie(r())},[t]),_s(()=>{t&&Ie(r())})}function Xr({ownerDocument:s,container:t,initialFocus:r},a){let n=i.useRef(null),l=Qe();return $t(()=>{if(!a)return;let o=t.current;o&&mt(()=>{if(!l.current)return;let c=s==null?void 0:s.activeElement;if(r!=null&&r.current){if((r==null?void 0:r.current)===c){n.current=c;return}}else if(o.contains(c)){n.current=c;return}r!=null&&r.current?Ie(r.current):at(o,_e.First)===Cs.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),n.current=s==null?void 0:s.activeElement})},[a]),n}function Zr({ownerDocument:s,container:t,containers:r,previousActiveElement:a},n){let l=Qe();Ls(s==null?void 0:s.defaultView,"focus",o=>{if(!n||!l.current)return;let c=Ps(r);t.current instanceof HTMLElement&&c.add(t.current);let d=a.current;if(!d)return;let h=o.target;h&&h instanceof HTMLElement?Is(c,h)?(a.current=h,Ie(h)):(o.preventDefault(),o.stopPropagation(),Ie(d)):Ie(a.current)},!0)}function Is(s,t){for(let r of s)if(r.contains(t))return!0;return!1}let $s=i.createContext(!1);function ea(){return i.useContext($s)}function Dt(s){return q.createElement($s.Provider,{value:s.force},s.children)}function ta(s){let t=ea(),r=i.useContext(Os),a=Ye(s),[n,l]=i.useState(()=>{if(!t&&r!==null||Ce.isServer)return null;let o=a==null?void 0:a.getElementById("headlessui-portal-root");if(o)return o;if(a===null)return null;let c=a.createElement("div");return c.setAttribute("id","headlessui-portal-root"),a.body.appendChild(c)});return i.useEffect(()=>{n!==null&&(a!=null&&a.body.contains(n)||a==null||a.body.appendChild(n))},[n,a]),i.useEffect(()=>{t||r!==null&&l(r.current)},[r,l,t]),n}let sa=i.Fragment;function ra(s,t){let r=s,a=i.useRef(null),n=je(Or(m=>{a.current=m}),t),l=Ye(a),o=ta(a),[c]=i.useState(()=>{var m;return Ce.isServer?null:(m=l==null?void 0:l.createElement("div"))!=null?m:null}),d=i.useContext(Rt),h=ze();return ye(()=>{!o||!c||o.contains(c)||(c.setAttribute("data-headlessui-portal",""),o.appendChild(c))},[o,c]),ye(()=>{if(c&&d)return d.register(c)},[d,c]),_s(()=>{var m;!o||!c||(c instanceof Node&&o.contains(c)&&o.removeChild(c),o.childNodes.length<=0&&((m=o.parentElement)==null||m.removeChild(o)))}),h?!o||!c?null:Zs.createPortal(ve({ourProps:{ref:n},theirProps:r,defaultTag:sa,name:"Portal"}),c):null}let aa=i.Fragment,Os=i.createContext(null);function na(s,t){let{target:r,...a}=s,n={ref:je(t)};return q.createElement(Os.Provider,{value:r},ve({ourProps:n,theirProps:a,defaultTag:aa,name:"Popover.Group"}))}let Rt=i.createContext(null);function la(){let s=i.useContext(Rt),t=i.useRef([]),r=se(l=>(t.current.push(l),s&&s.register(l),()=>a(l))),a=se(l=>{let o=t.current.indexOf(l);o!==-1&&t.current.splice(o,1),s&&s.unregister(l)}),n=i.useMemo(()=>({register:r,unregister:a,portals:t}),[r,a,t]);return[t,i.useMemo(()=>function({children:l}){return q.createElement(Rt.Provider,{value:n},l)},[n])]}let oa=fe(ra),ia=fe(na),Lt=Object.assign(oa,{Group:ia});const ca=(s=>s.useSyncExternalStore)(ns);function da(s){return ca(s.subscribe,s.getSnapshot,s.getSnapshot)}function ua(s,t){let r=s(),a=new Set;return{getSnapshot(){return r},subscribe(n){return a.add(n),()=>a.delete(n)},dispatch(n,...l){let o=t[n].call(r,...l);o&&(r=o,a.forEach(c=>c()))}}}function ma(){let s;return{before({doc:t}){var r;let a=t.documentElement;s=((r=t.defaultView)!=null?r:window).innerWidth-a.clientWidth},after({doc:t,d:r}){let a=t.documentElement,n=a.clientWidth-a.offsetWidth,l=s-n;r.style(a,"paddingRight",`${l}px`)}}}function ha(){return ks()?{before({doc:s,d:t,meta:r}){function a(n){return r.containers.flatMap(l=>l()).some(l=>l.contains(n))}t.microTask(()=>{var n;if(window.getComputedStyle(s.documentElement).scrollBehavior!=="auto"){let c=$e();c.style(s.documentElement,"scrollBehavior","auto"),t.add(()=>t.microTask(()=>c.dispose()))}let l=(n=window.scrollY)!=null?n:window.pageYOffset,o=null;t.addEventListener(s,"click",c=>{if(c.target instanceof HTMLElement)try{let d=c.target.closest("a");if(!d)return;let{hash:h}=new URL(d.href),m=s.querySelector(h);m&&!a(m)&&(o=m)}catch{}},!0),t.addEventListener(s,"touchstart",c=>{if(c.target instanceof HTMLElement)if(a(c.target)){let d=c.target;for(;d.parentElement&&a(d.parentElement);)d=d.parentElement;t.style(d,"overscrollBehavior","contain")}else t.style(c.target,"touchAction","none")}),t.addEventListener(s,"touchmove",c=>{if(c.target instanceof HTMLElement)if(a(c.target)){let d=c.target;for(;d.parentElement&&d.dataset.headlessuiPortal!==""&&!(d.scrollHeight>d.clientHeight||d.scrollWidth>d.clientWidth);)d=d.parentElement;d.dataset.headlessuiPortal===""&&c.preventDefault()}else c.preventDefault()},{passive:!1}),t.add(()=>{var c;let d=(c=window.scrollY)!=null?c:window.pageYOffset;l!==d&&window.scrollTo(0,l),o&&o.isConnected&&(o.scrollIntoView({block:"nearest"}),o=null)})})}}:{}}function xa(){return{before({doc:s,d:t}){t.style(s.documentElement,"overflow","hidden")}}}function pa(s){let t={};for(let r of s)Object.assign(t,r(t));return t}let Pe=ua(()=>new Map,{PUSH(s,t){var r;let a=(r=this.get(s))!=null?r:{doc:s,count:0,d:$e(),meta:new Set};return a.count++,a.meta.add(t),this.set(s,a),this},POP(s,t){let r=this.get(s);return r&&(r.count--,r.meta.delete(t)),this},SCROLL_PREVENT({doc:s,d:t,meta:r}){let a={doc:s,d:t,meta:pa(r)},n=[ha(),ma(),xa()];n.forEach(({before:l})=>l==null?void 0:l(a)),n.forEach(({after:l})=>l==null?void 0:l(a))},SCROLL_ALLOW({d:s}){s.dispose()},TEARDOWN({doc:s}){this.delete(s)}});Pe.subscribe(()=>{let s=Pe.getSnapshot(),t=new Map;for(let[r]of s)t.set(r,r.documentElement.style.overflow);for(let r of s.values()){let a=t.get(r.doc)==="hidden",n=r.count!==0;(n&&!a||!n&&a)&&Pe.dispatch(r.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",r),r.count===0&&Pe.dispatch("TEARDOWN",r)}});function ga(s,t,r){let a=da(Pe),n=s?a.get(s):void 0,l=n?n.count>0:!1;return ye(()=>{if(!(!s||!t))return Pe.dispatch("PUSH",s,r),()=>Pe.dispatch("POP",s,r)},[t,s]),l}let vt=new Map,Ke=new Map;function es(s,t=!0){ye(()=>{var r;if(!t)return;let a=typeof s=="function"?s():s.current;if(!a)return;function n(){var o;if(!a)return;let c=(o=Ke.get(a))!=null?o:1;if(c===1?Ke.delete(a):Ke.set(a,c-1),c!==1)return;let d=vt.get(a);d&&(d["aria-hidden"]===null?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden",d["aria-hidden"]),a.inert=d.inert,vt.delete(a))}let l=(r=Ke.get(a))!=null?r:0;return Ke.set(a,l+1),l!==0||(vt.set(a,{"aria-hidden":a.getAttribute("aria-hidden"),inert:a.inert}),a.setAttribute("aria-hidden","true"),a.inert=!0),n},[s,t])}function fa({defaultContainers:s=[],portals:t,mainTreeNodeRef:r}={}){var a;let n=i.useRef((a=r==null?void 0:r.current)!=null?a:null),l=Ye(n),o=se(()=>{var c,d,h;let m=[];for(let f of s)f!==null&&(f instanceof HTMLElement?m.push(f):"current"in f&&f.current instanceof HTMLElement&&m.push(f.current));if(t!=null&&t.current)for(let f of t.current)m.push(f);for(let f of(c=l==null?void 0:l.querySelectorAll("html > *, body > *"))!=null?c:[])f!==document.body&&f!==document.head&&f instanceof HTMLElement&&f.id!=="headlessui-portal-root"&&(f.contains(n.current)||f.contains((h=(d=n.current)==null?void 0:d.getRootNode())==null?void 0:h.host)||m.some(C=>f.contains(C))||m.push(f));return m});return{resolveContainers:o,contains:se(c=>o().some(d=>d.contains(c))),mainTreeNodeRef:n,MainTreeNode:i.useMemo(()=>function(){return r!=null?null:q.createElement(At,{features:it.Hidden,ref:n})},[n,r])}}let Ft=i.createContext(()=>{});Ft.displayName="StackContext";var _t=(s=>(s[s.Add=0]="Add",s[s.Remove=1]="Remove",s))(_t||{});function ba(){return i.useContext(Ft)}function ya({children:s,onUpdate:t,type:r,element:a,enabled:n}){let l=ba(),o=se((...c)=>{t==null||t(...c),l(...c)});return ye(()=>{let c=n===void 0||n===!0;return c&&o(0,r,a),()=>{c&&o(1,r,a)}},[o,r,a,n]),q.createElement(Ft.Provider,{value:o},s)}let Us=i.createContext(null);function Fs(){let s=i.useContext(Us);if(s===null){let t=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,Fs),t}return s}function va(){let[s,t]=i.useState([]);return[s.length>0?s.join(" "):void 0,i.useMemo(()=>function(r){let a=se(l=>(t(o=>[...o,l]),()=>t(o=>{let c=o.slice(),d=c.indexOf(l);return d!==-1&&c.splice(d,1),c}))),n=i.useMemo(()=>({register:a,slot:r.slot,name:r.name,props:r.props}),[a,r.slot,r.name,r.props]);return q.createElement(Us.Provider,{value:n},r.children)},[t])]}let ja="p";function wa(s,t){let r=Ve(),{id:a=`headlessui-description-${r}`,...n}=s,l=Fs(),o=je(t);ye(()=>l.register(a),[a,l.register]);let c={ref:o,...l.props,id:a};return ve({ourProps:c,theirProps:n,slot:l.slot||{},defaultTag:ja,name:l.name||"Description"})}let Na=fe(wa),Sa=Object.assign(Na,{});var Ca=(s=>(s[s.Open=0]="Open",s[s.Closed=1]="Closed",s))(Ca||{}),Ea=(s=>(s[s.SetTitleId=0]="SetTitleId",s))(Ea||{});let ka={0(s,t){return s.titleId===t.id?s:{...s,titleId:t.id}}},ct=i.createContext(null);ct.displayName="DialogContext";function Xe(s){let t=i.useContext(ct);if(t===null){let r=new Error(`<${s} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Xe),r}return t}function Ma(s,t,r=()=>[document.body]){ga(s,t,a=>{var n;return{containers:[...(n=a.containers)!=null?n:[],r]}})}function Aa(s,t){return me(t.type,ka,s,t)}let Da="div",Ra=ot.RenderStrategy|ot.Static;function La(s,t){let r=Ve(),{id:a=`headlessui-dialog-${r}`,open:n,onClose:l,initialFocus:o,role:c="dialog",__demoMode:d=!1,...h}=s,[m,f]=i.useState(0),C=i.useRef(!1);c=function(){return c==="dialog"||c==="alertdialog"?c:(C.current||(C.current=!0,console.warn(`Invalid role [${c}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")}();let x=Ut();n===void 0&&x!==null&&(n=(x&ge.Open)===ge.Open);let N=i.useRef(null),M=je(N,t),S=Ye(N),v=s.hasOwnProperty("open")||x!==null,u=s.hasOwnProperty("onClose");if(!v&&!u)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!v)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!u)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof n!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${n}`);if(typeof l!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${l}`);let b=n?0:1,[E,y]=i.useReducer(Aa,{titleId:null,descriptionId:null,panelRef:i.createRef()}),A=se(()=>l(!1)),j=se(_=>y({type:0,id:_})),p=ze()?d?!1:b===0:!1,k=m>1,$=i.useContext(ct)!==null,[D,L]=la(),R={get current(){var _;return(_=E.panelRef.current)!=null?_:N.current}},{resolveContainers:F,mainTreeNodeRef:Z,MainTreeNode:G}=fa({portals:D,defaultContainers:[R]}),ee=k?"parent":"leaf",ie=x!==null?(x&ge.Closing)===ge.Closing:!1,he=$||ie?!1:p,de=i.useCallback(()=>{var _,U;return(U=Array.from((_=S==null?void 0:S.querySelectorAll("body > *"))!=null?_:[]).find(K=>K.id==="headlessui-portal-root"?!1:K.contains(Z.current)&&K instanceof HTMLElement))!=null?U:null},[Z]);es(de,he);let ne=k?!0:p,re=i.useCallback(()=>{var _,U;return(U=Array.from((_=S==null?void 0:S.querySelectorAll("[data-headlessui-portal]"))!=null?_:[]).find(K=>K.contains(Z.current)&&K instanceof HTMLElement))!=null?U:null},[Z]);es(re,ne),$r(F,_=>{_.preventDefault(),A()},!(!p||k));let W=!(k||b!==0);Ls(S==null?void 0:S.defaultView,"keydown",_=>{W&&(_.defaultPrevented||_.key===Rs.Escape&&(_.preventDefault(),_.stopPropagation(),A()))}),Ma(S,!(ie||b!==0||$),F),i.useEffect(()=>{if(b!==0||!N.current)return;let _=new ResizeObserver(U=>{for(let K of U){let xe=K.target.getBoundingClientRect();xe.x===0&&xe.y===0&&xe.width===0&&xe.height===0&&A()}});return _.observe(N.current),()=>_.disconnect()},[b,N,A]);let[Q,Y]=va(),X=i.useMemo(()=>[{dialogState:b,close:A,setTitleId:j},E],[b,E,A,j]),we=i.useMemo(()=>({open:b===0}),[b]),w={ref:M,id:a,role:c,"aria-modal":b===0?!0:void 0,"aria-labelledby":E.titleId,"aria-describedby":Q};return q.createElement(ya,{type:"Dialog",enabled:b===0,element:N,onUpdate:se((_,U)=>{U==="Dialog"&&me(_,{[_t.Add]:()=>f(K=>K+1),[_t.Remove]:()=>f(K=>K-1)})})},q.createElement(Dt,{force:!0},q.createElement(Lt,null,q.createElement(ct.Provider,{value:X},q.createElement(Lt.Group,{target:N},q.createElement(Dt,{force:!1},q.createElement(Y,{slot:we,name:"Dialog.Description"},q.createElement(We,{initialFocus:o,containers:F,features:p?me(ee,{parent:We.features.RestoreFocus,leaf:We.features.All&~We.features.FocusLock}):We.features.None},q.createElement(L,null,ve({ourProps:w,theirProps:h,slot:we,defaultTag:Da,features:Ra,visible:b===0,name:"Dialog"}))))))))),q.createElement(G,null))}let _a="div";function Pa(s,t){let r=Ve(),{id:a=`headlessui-dialog-overlay-${r}`,...n}=s,[{dialogState:l,close:o}]=Xe("Dialog.Overlay"),c=je(t),d=se(m=>{if(m.target===m.currentTarget){if(qr(m.currentTarget))return m.preventDefault();m.preventDefault(),m.stopPropagation(),o()}}),h=i.useMemo(()=>({open:l===0}),[l]);return ve({ourProps:{ref:c,id:a,"aria-hidden":!0,onClick:d},theirProps:n,slot:h,defaultTag:_a,name:"Dialog.Overlay"})}let Ta="div";function Ia(s,t){let r=Ve(),{id:a=`headlessui-dialog-backdrop-${r}`,...n}=s,[{dialogState:l},o]=Xe("Dialog.Backdrop"),c=je(t);i.useEffect(()=>{if(o.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[o.panelRef]);let d=i.useMemo(()=>({open:l===0}),[l]);return q.createElement(Dt,{force:!0},q.createElement(Lt,null,ve({ourProps:{ref:c,id:a,"aria-hidden":!0},theirProps:n,slot:d,defaultTag:Ta,name:"Dialog.Backdrop"})))}let $a="div";function Oa(s,t){let r=Ve(),{id:a=`headlessui-dialog-panel-${r}`,...n}=s,[{dialogState:l},o]=Xe("Dialog.Panel"),c=je(t,o.panelRef),d=i.useMemo(()=>({open:l===0}),[l]),h=se(m=>{m.stopPropagation()});return ve({ourProps:{ref:c,id:a,onClick:h},theirProps:n,slot:d,defaultTag:$a,name:"Dialog.Panel"})}let Ua="h2";function Fa(s,t){let r=Ve(),{id:a=`headlessui-dialog-title-${r}`,...n}=s,[{dialogState:l,setTitleId:o}]=Xe("Dialog.Title"),c=je(t);i.useEffect(()=>(o(a),()=>o(null)),[a,o]);let d=i.useMemo(()=>({open:l===0}),[l]);return ve({ourProps:{ref:c,id:a},theirProps:n,slot:d,defaultTag:Ua,name:"Dialog.Title"})}let Ha=fe(La),za=fe(Ia),Va=fe(Oa),qa=fe(Pa),Ba=fe(Fa),yl=Object.assign(Ha,{Backdrop:za,Panel:Va,Overlay:qa,Title:Ba,Description:Sa});function Wa(s=0){let[t,r]=i.useState(s),a=Qe(),n=i.useCallback(d=>{a.current&&r(h=>h|d)},[t,a]),l=i.useCallback(d=>!!(t&d),[t]),o=i.useCallback(d=>{a.current&&r(h=>h&~d)},[r,a]),c=i.useCallback(d=>{a.current&&r(h=>h^d)},[r]);return{flags:t,addFlag:n,hasFlag:l,removeFlag:o,toggleFlag:c}}function Ka(s){let t={called:!1};return(...r)=>{if(!t.called)return t.called=!0,s(...r)}}function jt(s,...t){s&&t.length>0&&s.classList.add(...t)}function wt(s,...t){s&&t.length>0&&s.classList.remove(...t)}function Ja(s,t){let r=$e();if(!s)return r.dispose;let{transitionDuration:a,transitionDelay:n}=getComputedStyle(s),[l,o]=[a,n].map(d=>{let[h=0]=d.split(",").filter(Boolean).map(m=>m.includes("ms")?parseFloat(m):parseFloat(m)*1e3).sort((m,f)=>f-m);return h}),c=l+o;if(c!==0){r.group(h=>{h.setTimeout(()=>{t(),h.dispose()},c),h.addEventListener(s,"transitionrun",m=>{m.target===m.currentTarget&&h.dispose()})});let d=r.addEventListener(s,"transitionend",h=>{h.target===h.currentTarget&&(t(),d())})}else t();return r.add(()=>t()),r.dispose}function Ga(s,t,r,a){let n=r?"enter":"leave",l=$e(),o=a!==void 0?Ka(a):()=>{};n==="enter"&&(s.removeAttribute("hidden"),s.style.display="");let c=me(n,{enter:()=>t.enter,leave:()=>t.leave}),d=me(n,{enter:()=>t.enterTo,leave:()=>t.leaveTo}),h=me(n,{enter:()=>t.enterFrom,leave:()=>t.leaveFrom});return wt(s,...t.base,...t.enter,...t.enterTo,...t.enterFrom,...t.leave,...t.leaveFrom,...t.leaveTo,...t.entered),jt(s,...t.base,...c,...h),l.nextFrame(()=>{wt(s,...t.base,...c,...h),jt(s,...t.base,...c,...d),Ja(s,()=>(wt(s,...t.base,...c),jt(s,...t.base,...t.entered),o()))}),l.dispose}function Ya({immediate:s,container:t,direction:r,classes:a,onStart:n,onStop:l}){let o=Qe(),c=It(),d=Ee(r);ye(()=>{s&&(d.current="enter")},[s]),ye(()=>{let h=$e();c.add(h.dispose);let m=t.current;if(m&&d.current!=="idle"&&o.current)return h.dispose(),n.current(d.current),h.add(Ga(m,a.current,d.current==="enter",()=>{h.dispose(),l.current(d.current)})),h.dispose},[r])}function ke(s=""){return s.split(/\s+/).filter(t=>t.length>1)}let ht=i.createContext(null);ht.displayName="TransitionContext";var Qa=(s=>(s.Visible="visible",s.Hidden="hidden",s))(Qa||{});function Xa(){let s=i.useContext(ht);if(s===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return s}function Za(){let s=i.useContext(xt);if(s===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return s}let xt=i.createContext(null);xt.displayName="NestingContext";function pt(s){return"children"in s?pt(s.children):s.current.filter(({el:t})=>t.current!==null).filter(({state:t})=>t==="visible").length>0}function Hs(s,t){let r=Ee(s),a=i.useRef([]),n=Qe(),l=It(),o=se((x,N=De.Hidden)=>{let M=a.current.findIndex(({el:S})=>S===x);M!==-1&&(me(N,{[De.Unmount](){a.current.splice(M,1)},[De.Hidden](){a.current[M].state="hidden"}}),l.microTask(()=>{var S;!pt(a)&&n.current&&((S=r.current)==null||S.call(r))}))}),c=se(x=>{let N=a.current.find(({el:M})=>M===x);return N?N.state!=="visible"&&(N.state="visible"):a.current.push({el:x,state:"visible"}),()=>o(x,De.Unmount)}),d=i.useRef([]),h=i.useRef(Promise.resolve()),m=i.useRef({enter:[],leave:[],idle:[]}),f=se((x,N,M)=>{d.current.splice(0),t&&(t.chains.current[N]=t.chains.current[N].filter(([S])=>S!==x)),t==null||t.chains.current[N].push([x,new Promise(S=>{d.current.push(S)})]),t==null||t.chains.current[N].push([x,new Promise(S=>{Promise.all(m.current[N].map(([v,u])=>u)).then(()=>S())})]),N==="enter"?h.current=h.current.then(()=>t==null?void 0:t.wait.current).then(()=>M(N)):M(N)}),C=se((x,N,M)=>{Promise.all(m.current[N].splice(0).map(([S,v])=>v)).then(()=>{var S;(S=d.current.shift())==null||S()}).then(()=>M(N))});return i.useMemo(()=>({children:a,register:c,unregister:o,onStart:f,onStop:C,wait:h,chains:m}),[c,o,a,f,C,m,h])}function en(){}let tn=["beforeEnter","afterEnter","beforeLeave","afterLeave"];function ts(s){var t;let r={};for(let a of tn)r[a]=(t=s[a])!=null?t:en;return r}function sn(s){let t=i.useRef(ts(s));return i.useEffect(()=>{t.current=ts(s)},[s]),t}let rn="div",zs=ot.RenderStrategy;function an(s,t){var r,a;let{beforeEnter:n,afterEnter:l,beforeLeave:o,afterLeave:c,enter:d,enterFrom:h,enterTo:m,entered:f,leave:C,leaveFrom:x,leaveTo:N,...M}=s,S=i.useRef(null),v=je(S,t),u=(r=M.unmount)==null||r?De.Unmount:De.Hidden,{show:b,appear:E,initial:y}=Xa(),[A,j]=i.useState(b?"visible":"hidden"),p=Za(),{register:k,unregister:$}=p;i.useEffect(()=>k(S),[k,S]),i.useEffect(()=>{if(u===De.Hidden&&S.current){if(b&&A!=="visible"){j("visible");return}return me(A,{hidden:()=>$(S),visible:()=>k(S)})}},[A,S,k,$,b,u]);let D=Ee({base:ke(M.className),enter:ke(d),enterFrom:ke(h),enterTo:ke(m),entered:ke(f),leave:ke(C),leaveFrom:ke(x),leaveTo:ke(N)}),L=sn({beforeEnter:n,afterEnter:l,beforeLeave:o,afterLeave:c}),R=ze();i.useEffect(()=>{if(R&&A==="visible"&&S.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[S,A,R]);let F=y&&!E,Z=E&&b&&y,G=!R||F?"idle":b?"enter":"leave",ee=Wa(0),ie=se(W=>me(W,{enter:()=>{ee.addFlag(ge.Opening),L.current.beforeEnter()},leave:()=>{ee.addFlag(ge.Closing),L.current.beforeLeave()},idle:()=>{}})),he=se(W=>me(W,{enter:()=>{ee.removeFlag(ge.Opening),L.current.afterEnter()},leave:()=>{ee.removeFlag(ge.Closing),L.current.afterLeave()},idle:()=>{}})),de=Hs(()=>{j("hidden"),$(S)},p),ne=i.useRef(!1);Ya({immediate:Z,container:S,classes:D,direction:G,onStart:Ee(W=>{ne.current=!0,de.onStart(S,W,ie)}),onStop:Ee(W=>{ne.current=!1,de.onStop(S,W,he),W==="leave"&&!pt(de)&&(j("hidden"),$(S))})});let re=M,le={ref:v};return Z?re={...re,className:lt(M.className,...D.current.enter,...D.current.enterFrom)}:ne.current&&(re.className=lt(M.className,(a=S.current)==null?void 0:a.className),re.className===""&&delete re.className),q.createElement(xt.Provider,{value:de},q.createElement(zr,{value:me(A,{visible:ge.Open,hidden:ge.Closed})|ee.flags},ve({ourProps:le,theirProps:re,defaultTag:rn,features:zs,visible:A==="visible",name:"Transition.Child"})))}function nn(s,t){let{show:r,appear:a=!1,unmount:n=!0,...l}=s,o=i.useRef(null),c=je(o,t);ze();let d=Ut();if(r===void 0&&d!==null&&(r=(d&ge.Open)===ge.Open),![!0,!1].includes(r))throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[h,m]=i.useState(r?"visible":"hidden"),f=Hs(()=>{m("hidden")}),[C,x]=i.useState(!0),N=i.useRef([r]);ye(()=>{C!==!1&&N.current[N.current.length-1]!==r&&(N.current.push(r),x(!1))},[N,r]);let M=i.useMemo(()=>({show:r,appear:a,initial:C}),[r,a,C]);i.useEffect(()=>{if(r)m("visible");else if(!pt(f))m("hidden");else{let b=o.current;if(!b)return;let E=b.getBoundingClientRect();E.x===0&&E.y===0&&E.width===0&&E.height===0&&m("hidden")}},[r,f]);let S={unmount:n},v=se(()=>{var b;C&&x(!1),(b=s.beforeEnter)==null||b.call(s)}),u=se(()=>{var b;C&&x(!1),(b=s.beforeLeave)==null||b.call(s)});return q.createElement(xt.Provider,{value:f},q.createElement(ht.Provider,{value:M},ve({ourProps:{...S,as:i.Fragment,children:q.createElement(Vs,{ref:c,...S,...l,beforeEnter:v,beforeLeave:u})},theirProps:{},defaultTag:i.Fragment,features:zs,visible:h==="visible",name:"Transition"})))}function ln(s,t){let r=i.useContext(ht)!==null,a=Ut()!==null;return q.createElement(q.Fragment,null,!r&&a?q.createElement(Pt,{ref:t,...s}):q.createElement(Vs,{ref:t,...s}))}let Pt=fe(nn),Vs=fe(an),on=fe(ln),cn=Object.assign(Pt,{Child:on,Root:Pt});const ss=({show:s,children:t,duration:r="duration-200",className:a=""})=>e.jsx(cn,{show:s,enter:`ease-out ${r}`,enterFrom:"opacity-0",enterTo:"opacity-100",leave:`ease-in ${r}`,leaveFrom:"opacity-100",leaveTo:"opacity-0",className:a,children:t}),dn=({children:s,onClick:t,variant:r="primary",size:a="medium",disabled:n=!1,loading:l=!1,className:o="",...c})=>{const[d,h]=i.useState(!1),[m,f]=i.useState(!1),C={primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",success:"bg-green-600 text-white hover:bg-green-700 focus:ring-green-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500",outline:"border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 focus:ring-gray-500"},x={small:"px-3 py-1.5 text-sm",medium:"px-4 py-2 text-sm",large:"px-6 py-3 text-base"},N="inline-flex items-center justify-center gap-2 font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",M=C[r]||C.primary,S=x[a]||x.medium,v=()=>h(!0),u=()=>h(!1),b=()=>f(!0),E=()=>{f(!1),h(!1)};return e.jsxs("button",{...c,onClick:t,disabled:n||l,onMouseDown:v,onMouseUp:u,onMouseEnter:b,onMouseLeave:E,className:`
        ${N} 
        ${M} 
        ${S} 
        ${o}
        transform transition-transform duration-150 ease-in-out
        ${d?"scale-95":m?"scale-105":"scale-100"}
        ${l?"animate-pulse":""}
      `,children:[l&&e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-current border-t-transparent rounded-full"}),s]})};class un{static sanitizeHtml(t){return typeof t!="string"?t:t.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/data:/gi,"").replace(/vbscript:/gi,"").trim()}static sanitizeInput(t){return typeof t!="string"?t:t.replace(/[';"\\]/g,"").replace(/--/g,"").replace(/\/\*/g,"").replace(/\*\//g,"").trim()}static sanitizePhone(t){if(!t)return"";const r=t.replace(/\D/g,"");if(r.length===10)return r;throw new Error("Invalid phone number format")}static sanitizeEmail(t){if(!t)return"";const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,a=t.toLowerCase().trim();if(!r.test(a))throw new Error("Invalid email format");return a}static sanitizeUrl(t){if(!t)return"";try{const r=new URL(t);if(!["http:","https:"].includes(r.protocol))throw new Error("Invalid URL protocol");return r.toString()}catch{throw new Error("Invalid URL format")}}}class mn{static generateSecureToken(t=32){const r=new Uint8Array(t);return crypto.getRandomValues(r),Array.from(r,a=>a.toString(16).padStart(2,"0")).join("")}static async hashData(t){const a=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}static validatePasswordStrength(t){const a=/[A-Z]/.test(t),n=/[a-z]/.test(t),l=/\d/.test(t),o=/[!@#$%^&*(),.?":{}|<>]/.test(t),c=[];return t.length<8&&c.push("Password must be at least 8 characters long"),a||c.push("Password must contain at least one uppercase letter"),n||c.push("Password must contain at least one lowercase letter"),l||c.push("Password must contain at least one number"),o||c.push("Password must contain at least one special character"),{isValid:c.length===0,errors:c,strength:this.calculatePasswordStrength(t)}}static calculatePasswordStrength(t){let r=0;return r+=Math.min(t.length*2,20),/[a-z]/.test(t)&&(r+=5),/[A-Z]/.test(t)&&(r+=5),/\d/.test(t)&&(r+=5),/[!@#$%^&*(),.?":{}|<>]/.test(t)&&(r+=10),/123|abc|qwe/i.test(t)&&(r-=10),/password|admin|user/i.test(t)&&(r-=20),Math.max(0,Math.min(100,r))}}const hn={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ADMIN_ACCESS_TOKEN:"admin123456789secure",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlnd2dyeXlrZ2xzZXRmdm9taGRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3NTcxMDgsImV4cCI6MjA3MDMzMzEwOH0.yL1hK263qf9msp7K4vUtF4Lvb7x7yxPcyvgkPiLokqA",VITE_SUPABASE_URL:"https://igwgryykglsetfvomhdj.supabase.co"};class xn{constructor(){this.config=new Map,this.initialized=!1,this.initializeConfig()}initializeConfig(){try{this.validateEnvironment(),this.setupSecureConfig(),this.initialized=!0}catch(t){console.error("Failed to initialize secure configuration:",t),this.initialized=!1}}validateEnvironment(){const r=["VITE_SUPABASE_URL","VITE_SUPABASE_ANON_KEY"].filter(a=>!hn[a]);if(r.length>0)throw new Error(`Missing required environment variables: ${r.join(", ")}`);try{new URL("https://igwgryykglsetfvomhdj.supabase.co")}catch{throw new Error("Invalid VITE_SUPABASE_URL format")}}setupSecureConfig(){this.config.set("supabase",{url:"https://igwgryykglsetfvomhdj.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlnd2dyeXlrZ2xzZXRmdm9taGRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3NTcxMDgsImV4cCI6MjA3MDMzMzEwOH0.yL1hK263qf9msp7K4vUtF4Lvb7x7yxPcyvgkPiLokqA"}),this.config.set("security",{maxLoginAttempts:5,loginCooldownMs:15*60*1e3,sessionTimeoutMs:24*60*60*1e3,tokenExpiryMs:60*60*1e3,passwordPolicy:{minLength:8,requireUppercase:!0,requireLowercase:!0,requireNumbers:!0,requireSpecialChars:!0}}),this.config.set("admin",{token:this.getSecureAdminToken(),permissions:["read","write","delete","manage_users"],sessionDuration:8*60*60*1e3}),this.config.set("api",{timeout:3e4,retryAttempts:3,rateLimitWindow:60*1e3,rateLimitMax:100}),this.config.set("csp",{allowedDomains:["supabase.co","supabase.com","googleapis.com","gstatic.com","google.com","genspark.ai"],allowedProtocols:["https:","http:"],blockInlineScripts:!0,blockInlineStyles:!1})}getSecureAdminToken(){const t="admin123456789secure";return t.length>=16?t:(console.warn("No secure admin token found in environment. Using generated token."),console.warn("Please set VITE_ADMIN_ACCESS_TOKEN to a secure value in production."),mn.generateSecureToken(32))}get(t,r=null){if(!this.initialized)throw new Error("Configuration not initialized");const a=this.config.get(t);if(!a)throw new Error(`Configuration key '${t}' not found`);if(r){if(!(r in a))throw new Error(`Configuration subkey '${t}.${r}' not found`);return a[r]}return a}isInitialized(){return this.initialized}getSanitizedConfig(){const t={};for(const[r,a]of this.config.entries())r==="supabase"?t[r]={url:a.url,anonKey:"***REDACTED***"}:r==="admin"?t[r]={token:"***REDACTED***",permissions:a.permissions,sessionDuration:a.sessionDuration}:t[r]=a;return t}validateAdminToken(t){if(!t||typeof t!="string")return!1;const r=this.get("admin");return t===r.token}getSecurityHeaders(){return{"Content-Type":"application/json","X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","X-XSS-Protection":"1; mode=block","Referrer-Policy":"strict-origin-when-cross-origin"}}}const pn=new xn;pn.get("admin","token");const vl=["Web","Social Media","Ads","SEO","HR","Accounts","Sales","Blended (HR + Sales)","Operations Head","Web Head"],jl={Web:["Web Designer/Developer","Graphic Designer (Web)"],"Social Media":["Client Servicing","Graphic Designer","YouTube Manager","LinkedIn Manager","Meta (Facebook/Instagram) Manager"],Ads:["Google Ads","Meta Ads"],SEO:["SEO Executive/Manager"],HR:["HR"],Accounts:["Accounts"],Sales:["Sales"],"Blended (HR + Sales)":["HR (80%) + Sales (20%)"],"Operations Head":["Operations Head"],"Web Head":["Web Head"]},qs=()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`},gn=s=>{if(!s)return"";const[t,r]=s.split("-").map(Number),a=new Date(t,r-2,1);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`},Nt=s=>{if(!s)return"";const[t,r]=s.split("-").map(Number);return new Date(t,r-1,1).toLocaleString(void 0,{month:"short",year:"numeric"})},Re=s=>Math.round(s*10)/10,fn=s=>/https?:\/\/(drive|docs)\.google\.com\//i.test(s||"");function Bs(s){const[t,r]=(s||"").split("-").map(Number);return!t||!r?31:new Date(t,r,0).getDate()}const bn={"01-26":"Republic Day","08-15":"Independence Day","10-02":"Gandhi Jayanti","12-25":"Christmas Day","01-14":"Makar Sankranti","03-08":"Holi (approx)","04-14":"Ram Navami (approx)","05-01":"Labour Day","08-19":"Janmashtami (approx)","09-02":"Ganesh Chaturthi (approx)","10-24":"Dussehra (approx)","11-12":"Diwali (approx)","11-19":"Guru Nanak Jayanti (approx)"};function yn(s){const[t,r]=(s||"").split("-").map(Number);if(!t||!r)return 22;const a=new Date(t,r,0).getDate();let n=0,l=0;for(let o=1;o<=a;o++){const d=new Date(t,r-1,o).getDay();if(d===0||d===6&&(l++,l===2||l===4))continue;const h=`${String(r).padStart(2,"0")}-${String(o).padStart(2,"0")}`;bn[h]||n++}return n}gn(qs());const gt=()=>{const[s,t]=i.useState([]),[r,a]=i.useState([]),[n,l]=i.useState(!0),[o,c]=i.useState(null),{supabase:d}=Ne(),{notify:h}=pe(),m=i.useCallback(async()=>{if(d)try{l(!0),c(null);const{data:S,error:v}=await d.from("submissions").select(`
          *,
          employees (
            id,
            name,
            email,
            role,
            department
          )
        `).order("created_at",{ascending:!1});if(v)throw v;t(S||[]),a(S||[])}catch(S){console.error("Error fetching submissions:",S),c(S.message),h({title:"Error fetching submissions",message:S.message,type:"error"})}finally{l(!1)}},[d,h]),f=i.useCallback(()=>{m()},[m]),C=i.useCallback(async S=>{if(!d)return null;try{const{data:v,error:u}=await d.from("submissions").insert([S]).select(`
          *,
          employees (
            id,
            name,
            email,
            role,
            department
          )
        `).single();if(u)throw u;return t(b=>[v,...b]),a(b=>[v,...b]),h({title:"Submission added successfully",variant:"default"}),v}catch(v){throw console.error("Error adding submission:",v),h({title:"Error adding submission",description:v.message,variant:"destructive"}),v}},[d,h]),x=i.useCallback(async(S,v)=>{if(!d)return null;try{const{data:u,error:b}=await d.from("submissions").update(v).eq("id",S).select(`
          *,
          employees (
            id,
            name,
            email,
            role,
            department
          )
        `).single();if(b)throw b;return t(E=>E.map(y=>y.id===S?u:y)),a(E=>E.map(y=>y.id===S?u:y)),h({title:"Submission updated successfully",variant:"default"}),u}catch(u){throw console.error("Error updating submission:",u),h({title:"Error updating submission",description:u.message,variant:"destructive"}),u}},[d,h]),N=i.useCallback(async S=>{if(d)try{const{error:v}=await d.from("submissions").delete().eq("id",S);if(v)throw v;t(u=>u.filter(b=>b.id!==S)),a(u=>u.filter(b=>b.id!==S)),h({title:"Submission deleted successfully",variant:"default"})}catch(v){throw console.error("Error deleting submission:",v),h({title:"Error deleting submission",description:v.message,variant:"destructive"}),v}},[d,h]),M=i.useCallback(S=>{let v=s;S.employeeId&&(v=v.filter(u=>u.employee_id===S.employeeId)),S.status&&(v=v.filter(u=>u.status===S.status)),S.dateFrom&&(v=v.filter(u=>new Date(u.created_at)>=new Date(S.dateFrom))),S.dateTo&&(v=v.filter(u=>new Date(u.created_at)<=new Date(S.dateTo))),a(v)},[s]);return i.useEffect(()=>{m()},[m]),{allSubmissions:s,submissions:r,loading:n,error:o,refreshSubmissions:f,addSubmission:C,updateSubmission:x,deleteSubmission:N,filterSubmissions:M}},vn=({size:s="medium",color:t="blue",className:r="",showText:a=!1,text:n="Loading..."})=>{const l={small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12",xl:"w-16 h-16"},o={blue:"border-blue-600",green:"border-green-600",red:"border-red-600",gray:"border-gray-600",purple:"border-purple-600"},c=l[s]||l.medium,d=o[t]||o.blue;return e.jsxs("div",{className:`flex items-center gap-3 ${r}`,children:[e.jsx("div",{className:`${c} ${d} border-2 border-t-transparent rounded-full animate-spin`,role:"status","aria-label":"Loading"}),a&&e.jsx("span",{className:"text-gray-600 text-sm animate-pulse",children:n})]})},st=({className:s=""})=>e.jsx("div",{className:`bg-white rounded-lg border p-6 ${s}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-5/6"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-4/6"})]})]})}),jn=({rows:s=5,columns:t=4,className:r=""})=>e.jsx("div",{className:`bg-white rounded-lg border overflow-hidden ${r}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b",children:e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${t}, 1fr)`},children:Array.from({length:t}).map((a,n)=>e.jsx("div",{className:"h-4 bg-gray-200 rounded"},n))})}),Array.from({length:s}).map((a,n)=>e.jsx("div",{className:"px-6 py-4 border-b border-gray-100",children:e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${t}, 1fr)`},children:Array.from({length:t}).map((l,o)=>e.jsx("div",{className:`h-4 bg-gray-200 rounded ${o===0?"w-3/4":"w-full"}`},o))})},n))]})});class Fe{constructor(t=!0,r=null,a=null,n="info"){this.isValid=t,this.error=r,this.warning=a,this.severity=n,this.timestamp=Date.now()}static success(t=null){return new Fe(!0,null,t,"info")}static error(t,r="error"){return new Fe(!1,t,null,r)}static warning(t){return new Fe(!0,null,t,"warning")}}class wn{constructor(){this.rules=new Map,this.setupDefaultRules()}setupDefaultRules(){this.addRule("employee.name",{required:!0,minLength:2,maxLength:100,pattern:/^[a-zA-Z\s\-\.]+$/,sanitize:!0,errorMessages:{required:"Full name is required for identification and reporting",minLength:"Name must be at least 2 characters long",maxLength:"Employee name is too long (max 100 characters)",pattern:"Name contains unusual characters. Please verify it's correct."}}),this.addRule("employee.phone",{required:!0,pattern:/^[6-9]\d{9}$/,sanitize:!0,transform:t=>t.replace(/\D/g,""),validate:t=>{const r=t.replace(/\D/g,"");return r.length===10&&/^[6-9]/.test(r)},errorMessages:{required:"Phone number is required for contact purposes",pattern:"Phone number must be 10 digits starting with 6, 7, 8, or 9",validate:"Please enter a valid Indian mobile number"}}),this.addRule("employee.department",{required:!0,allowedValues:["Web","Social Media","Ads","SEO","HR","Accounts","Sales","Blended (HR + Sales)","Operations Head","Web Head"],sanitize:!0,errorMessages:{required:"Department selection is required for proper reporting structure",allowedValues:"Please select a valid department"}}),this.addRule("employee.role",{required:!0,minLength:2,maxLength:100,sanitize:!0,validate:t=>Array.isArray(t)?t.length>0:t&&t.trim().length>0,errorMessages:{required:"At least one role must be selected for performance evaluation",validate:"Role information is required"}}),this.addRule("client.name",{required:!0,minLength:2,maxLength:100,pattern:/^[a-zA-Z0-9\s&.,'-]+$/,sanitize:!0,errorMessages:{required:"Client name is required",minLength:"Client name must be at least 2 characters",maxLength:"Client name cannot exceed 100 characters",pattern:"Client name contains invalid characters"}}),this.addRule("client.services",{required:!1,validate:t=>!t||!Array.isArray(t)?!0:t.length<=10,errorMessages:{validate:"Maximum 10 services can be selected"}}),this.addRule("contact.email",{required:!1,pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,maxLength:254,sanitize:!0,transform:t=>t.toLowerCase().trim(),errorMessages:{pattern:"Please enter a valid email address",maxLength:"Email address is too long"}}),this.addRule("contact.phone",{required:!1,pattern:/^[\+]?[1-9][\d]{0,15}$/,sanitize:!0,transform:t=>t.replace(/[\s\-\(\)]/g,""),errorMessages:{pattern:"Please enter a valid phone number"}}),this.addRule("date.monthKey",{required:!0,pattern:/^\d{4}-\d{2}$/,validate:t=>{if(!t)return!1;const[r,a]=t.split("-").map(Number);return a>=1&&a<=12&&r>=2020&&r<=new Date().getFullYear()+1},errorMessages:{required:"Report month is required to track performance timeline",pattern:"Month format should be YYYY-MM (e.g., 2024-01)",validate:"Invalid month or year"}}),this.addRule("attendance.days",{required:!1,min:0,validate:(t,r={})=>{const a=Number(t||0);if(isNaN(a))return!1;const n=r.monthKey?yn(r.monthKey):22;return r.monthKey&&Bs(r.monthKey),a<=n},errorMessages:{min:"Days cannot be negative",validate:"Days cannot exceed the maximum working days for the selected month"}}),this.addRule("url.general",{required:!1,pattern:/^https?:\/\/.+/,maxLength:2048,sanitize:!0,errorMessages:{pattern:"Please enter a valid URL starting with http:// or https://",maxLength:"URL is too long"}}),this.addRule("url.drive",{required:!1,validate:t=>!t||fn(t),errorMessages:{validate:"Please enter a valid Google Drive URL"}}),this.addRule("text.short",{required:!1,maxLength:500,sanitize:!0,errorMessages:{maxLength:"Text must not exceed 500 characters"}}),this.addRule("text.long",{required:!1,maxLength:2e3,sanitize:!0,errorMessages:{maxLength:"Text must not exceed 2000 characters"}}),this.addRule("number.positive",{required:!1,min:0,validate:t=>{const r=Number(t);return!isNaN(r)&&r>=0},errorMessages:{validate:"Must be a positive number"}})}addRule(t,r){this.rules.set(t,r)}getRule(t){return this.rules.get(t)}hasRule(t){return this.rules.has(t)}}class Nn{constructor(){this.registry=new wn}validateField(t,r,a={}){var l,o,c,d,h,m,f,C;const n=this.registry.getRule(t);if(!n)return this.validateGeneric(t,r,a);try{const x={isValid:!0,errors:[],warnings:[],sanitizedValue:r,transformedValue:r};r==null&&(r="");const N=String(r).trim();if(n.required&&!N)return{...x,isValid:!1,errors:[((l=n.errorMessages)==null?void 0:l.required)||`${t} is required`]};if(!N&&!n.required)return x;if(n.sanitize?x.sanitizedValue=un.sanitizeInput(N):x.sanitizedValue=N,n.transform&&typeof n.transform=="function")try{x.transformedValue=n.transform(x.sanitizedValue)}catch{return{...x,isValid:!1,errors:[`Invalid ${t} format`]}}else x.transformedValue=x.sanitizedValue;n.minLength&&x.sanitizedValue.length<n.minLength&&(x.isValid=!1,x.errors.push(((o=n.errorMessages)==null?void 0:o.minLength)||`${t} must be at least ${n.minLength} characters`)),n.maxLength&&x.sanitizedValue.length>n.maxLength&&(x.isValid=!1,x.errors.push(((c=n.errorMessages)==null?void 0:c.maxLength)||`${t} must not exceed ${n.maxLength} characters`)),n.pattern&&!n.pattern.test(x.sanitizedValue)&&(x.isValid=!1,x.errors.push(((d=n.errorMessages)==null?void 0:d.pattern)||`${t} format is invalid`)),n.allowedValues&&!n.allowedValues.includes(x.sanitizedValue)&&(x.isValid=!1,x.errors.push(((h=n.errorMessages)==null?void 0:h.allowedValues)||`${t} must be one of: ${n.allowedValues.join(", ")}`));const M=Number(x.transformedValue);if(isNaN(M)||(n.min!==void 0&&M<n.min&&(x.isValid=!1,x.errors.push(((m=n.errorMessages)==null?void 0:m.min)||`${t} must be at least ${n.min}`)),n.max!==void 0&&M>n.max&&(x.isValid=!1,x.errors.push(((f=n.errorMessages)==null?void 0:f.max)||`${t} must not exceed ${n.max}`))),n.validate&&typeof n.validate=="function")try{n.validate(x.transformedValue,a)||(x.isValid=!1,x.errors.push(((C=n.errorMessages)==null?void 0:C.validate)||`${t} validation failed`))}catch{x.isValid=!1,x.errors.push(`${t} validation error`)}return x}catch(x){return console.error(`Validation error for field ${t}:`,x),{isValid:!1,errors:["Validation failed due to an internal error"],warnings:[],sanitizedValue:r,transformedValue:r}}}validateGeneric(t,r,a={}){return typeof r=="string"&&r.length>5e3?Fe.error("Input is too long (max 5000 characters)"):Fe.success()}validateFields(t,r={}){const a={},n={},l={};let o=!0;for(const[c,d]of Object.entries(t)){const h=this.validateField(c,d,r);a[c]=h,h.isValid||(o=!1,n[c]=h.errors),h.warnings&&h.warnings.length>0&&(l[c]=h.warnings)}return{isValid:o,errors:n,warnings:l,results:a}}validateEmployeeSubmission(t){var a,n,l,o,c;const r={"employee.name":(a=t.employee)==null?void 0:a.name,"employee.phone":(n=t.employee)==null?void 0:n.phone,"employee.department":(l=t.employee)==null?void 0:l.department,"employee.role":(o=t.employee)==null?void 0:o.role,"date.monthKey":t.monthKey};return(c=t.meta)!=null&&c.attendance&&(r["attendance.days"]=t.meta.attendance.wfo,r["attendance.days"]=t.meta.attendance.wfh),this.validateFields(r,t)}validateClientData(t,r=[]){const a={"client.name":t.name,"client.services":t.services,"contact.email":t.contact_email,"contact.phone":t.contact_phone},n=this.validateFields(a,{existingClients:r});return t.name&&r.some(l=>l.name.toLowerCase().trim()===t.name.toLowerCase().trim())&&(n.isValid=!1,n.errors["client.name"]=["A client with this name already exists"]),n}addRule(t,r){this.registry.addRule(t,r)}}const St=new Nn,Sn=q.createContext({openModal:()=>{},closeModal:()=>{}}),qe=()=>q.useContext(Sn),Cn={"Website Maintenance":1,SEO:1.2,"GBP SEO":1,"Social Media":1.1,"Google Ads":1.2,"Meta Ads":1.2,AI:.8};function Ws(s){return Cn[s]??1}function En(s,t){if(!s||s.length===0)return 0;let r=0,a=0;if(s.forEach(l=>{if(l.services&&l.services.length>0){let o=0,c=0;l.services.forEach(d=>{const h=typeof d=="string"?d:d.service,m=Me(l,h);if(m!==null){const f=Ws(h);o+=f,c+=f*m}}),o>0&&(r+=c/o,a++)}}),a===0)return 0;const n=r/a;return Re(Math.min(10,n/100*10))}function wl(s,t,r={}){r.monthKey;const a=s.department,n=En(t),l=(o,c)=>Re(o*(1-c)+n*c);if(a==="Web"){let o=0,c=0,d=0;(t||[]).forEach(N=>{o+=N.web_pagesThis||0,c+=N.web_onTimeThis||0,d+=N.web_bugsThis||0});const h=(t==null?void 0:t.length)||1,m=Math.min(10,o/20*10),f=Math.min(10,c/h*10),C=Math.max(0,Math.min(10,10-d/h)),x=Re(m*.4+f*.4+C*.2);return l(x,.5)}if(a==="SEO"){let o=0;(t||[]).forEach(d=>{o+=d.seo_trafficThis||0});const c=Re(Math.min(10,o/1e4*10));return l(c,.3)}if(a==="Sales"){let o=0;(t||[]).forEach(d=>{o+=d.sales_deals||0});const c=Re(Math.min(10,o/10*10));return l(c,.4)}return a==="Social Media"||a==="Ads"?l(5,.5):5}function Nl(s){const t=(s||[]).reduce((r,a)=>r+Number(a.hours||0),0);return Re(Math.min(10,t/20*10))}function Sl(s){const t=(s||[]).reduce((r,a)=>{var n;return r+Number(((n=a.relationship)==null?void 0:n.clientSatisfaction)||0)},0)/((s||[]).length||1);return Re(Math.min(10,t))}function Cl(s){const{kpiScore:t=0,learningScore:r=0,relationshipScore:a=0}=s||{};return Re(t*.5+r*.2+a*.3)}function El(s,t,r={}){try{const a=r.graceDays??3,[n,l]=(s||"").split("-").map(Number);if(!n||!l)return{dueDate:null,submittedAt:t,lateDays:0,penalty:0};const o=new Date(n,l,0),c=new Date(o.getFullYear(),o.getMonth(),o.getDate()+a),d=t?new Date(t):new Date,h=d.getTime()-c.getTime(),m=h>0?Math.ceil(h/(1e3*60*60*24)):0,f=m>0?Math.min(2,Math.ceil(m/7)*.5):0;return{dueDate:c.toISOString(),submittedAt:d.toISOString(),lateDays:m,penalty:f}}catch{return{dueDate:null,submittedAt:t,lateDays:0,penalty:0}}}function Me(s,t,r={}){var f,C;const a=r.monthKey||null;if(!(s!=null&&s.service_scopes)||!s.service_scopes[t])return null;const n=s.service_scopes[t],l=Number(n.deliverables||0);if(l<=0)return 0;const o=(n.frequency||"Monthly").toLowerCase();let d={daily:20,"bi-weekly":2,biweekly:2,weekly:4,monthly:1,quarterly:1/3}[o]??1;if(o==="daily"&&a){const[x,N]=a.split("-").map(Number),M=Bs(a);let S=0;for(let v=1;v<=M;v++){const b=new Date(x,N-1,v).getDay();b!==0&&b!==6&&S++}d=S}const h=Math.max(1,Math.round(l*d)),m=(C=(f=s.service_progress)==null?void 0:f[t])==null?void 0:C.completed;if(typeof m=="number")return Math.min(100,Math.round(m/h*100));switch(t){case"Social Media":{const x=(s.sm_graphicsPhotoshop||0)+(s.sm_graphicsCanva||0)+(s.sm_graphicsAi||0)+(s.sm_shortVideos||0)+(s.sm_longVideos||0);return Math.min(100,Math.round(x/h*100))}case"SEO":case"GBP SEO":{const x=s.seo_keywordsWorked?s.seo_keywordsWorked.length:0,N=s.seo_top3?s.seo_top3.length:0,M=x+N+(s.seo_technicalIssues||0);return Math.min(100,Math.round(M/h*100))}case"Google Ads":case"Meta Ads":{const x=s.ads_newAds||0;return Math.min(100,Math.round(x/h*100))}case"Website Maintenance":{const N=(s.web_pagesThis||0)+(s.web_saasUpsells||0);return Math.min(100,Math.round(N/h*100))}case"AI":{const x=s.ai_outputs||0;return Math.min(100,Math.round(x/h*100))}default:return 0}}class kn{constructor(){this.subscribers=new Map,this.pendingUpdates=new Set,this.lastSyncTime=Date.now(),this.syncQueue=[],this.isProcessing=!1}subscribe(t,r){return this.subscribers.has(t)||this.subscribers.set(t,new Set),this.subscribers.get(t).add(r),()=>{const a=this.subscribers.get(t);a&&(a.delete(r),a.size===0&&this.subscribers.delete(t))}}notify(t,r,a={}){const n=this.subscribers.get(t);n&&n.forEach(l=>{try{l(r,a)}catch(o){console.error(`Data sync callback error for ${t}:`,o)}})}queueSync(t){this.syncQueue.push({...t,timestamp:Date.now(),id:Math.random().toString(36).substr(2,9)}),this.processSyncQueue()}async processSyncQueue(){if(!(this.isProcessing||this.syncQueue.length===0)){this.isProcessing=!0;try{for(;this.syncQueue.length>0;){const t=this.syncQueue.shift();await this.executeOperation(t)}}catch(t){console.error("Sync queue processing error:",t)}finally{this.isProcessing=!1}}}async executeOperation(t){const{type:r,data:a,callback:n,retries:l=3}=t;for(let o=1;o<=l;o++)try{n&&await n(a),this.notify(r,a,{operation:r,timestamp:Date.now(),attempt:o});return}catch(c){if(console.error(`Sync operation ${r} failed (attempt ${o}/${l}):`,c),o===l)throw this.notify(`${r}_error`,c,{operation:r,data:a,finalAttempt:!0}),c;await new Promise(d=>setTimeout(d,1e3*o))}}forceRefresh(){this.notify("force_refresh",{timestamp:Date.now()})}clearPending(){this.syncQueue.length=0,this.pendingUpdates.clear()}}const Ue=new kn;function Mn({dataType:s,fetchFunction:t,dependencies:r=[],autoRefresh:a=!0,refreshInterval:n=3e4}){const l=i.useRef([]),o=i.useRef(0),c=i.useRef(!0);return i.useEffect(()=>{const d=Ue.subscribe("force_refresh",()=>{c.current&&t&&t(!0)}),h=Ue.subscribe(s,m=>{c.current&&(l.current=m)});return()=>{d(),h()}},[s,t]),i.useEffect(()=>{if(!a||!t)return;const d=setInterval(()=>{const h=Date.now();h-o.current>n&&(t(!1),o.current=h)},n);return()=>clearInterval(d)},[a,t,n]),i.useEffect(()=>()=>{c.current=!1},[]),{data:l.current,forceRefresh:()=>Ue.forceRefresh(),queueSync:d=>Ue.queueSync(d)}}function kl({supabase:s,dataSync:t,onSuccess:r,onError:a}){return async(n,l={})=>{const{tableName:o="submissions",operation:c="insert",skipSync:d=!1}=l;try{let h;if(c==="update"&&n.id){const{data:m,error:f}=await s.from(o).update(n).eq("id",n.id).select();if(f)throw f;h=m==null?void 0:m[0]}else{const{data:m,error:f}=await s.from(o).insert([n]).select();if(f)throw f;h=m==null?void 0:m[0]}return!d&&h&&(Ue.queueSync({type:"submission_added",data:h,callback:async m=>{t!=null&&t.addSubmission&&await t.addSubmission(m)}}),setTimeout(()=>{Ue.forceRefresh()},500)),r&&r(h),{success:!0,data:h}}catch(h){return console.error("Submission handler error:",h),a&&a(h),{success:!1,error:h}}}}const nt=["Website Development","Website Maintenance","SEO","Google Ads","Meta Ads","Social Media Management","Content Creation","Graphic Design","Video Production","Email Marketing","Analytics & Reporting","Lead Generation","E-commerce Management","Technical Support","Consulting","AI Tools"],An={Web:["Website Development","Website Maintenance","AI Tools","Technical Support","E-commerce Management","SEO","Analytics & Reporting"],Marketing:["Website Development","SEO","Google Ads","Meta Ads","Social Media Management","Content Creation","Graphic Design","Video Production","Email Marketing","Analytics & Reporting","Lead Generation"],Website:["Website Development","Website Maintenance","Technical Support"]},Ml=s=>An[s]||nt,Al=["Daily","Weekly","Bi-weekly","Monthly","Quarterly","As needed","One-time","Project-based"],Dn={"Website Development":"Project-based","Website Maintenance":"Monthly",SEO:"Monthly","Google Ads":"Weekly","Meta Ads":"Weekly","Social Media Management":"Daily","Content Creation":"Weekly","Graphic Design":"As needed","Video Production":"Monthly","Email Marketing":"Weekly","Analytics & Reporting":"Monthly","Lead Generation":"Weekly","E-commerce Management":"Daily","Technical Support":"As needed",Consulting:"As needed","AI Tools":"Monthly"},Te={name:"",team:"Web",status:"Active",client_type:"Standard",services:[],contact_email:"",contact_phone:"",start_date:"",scope_notes:"",logo_url:"",brand_colors:"",created_at:"",updated_at:""},rs=(s,t=null,r="")=>({service:s,frequency:t||Dn[s]||"Monthly",notes:r,added_date:new Date().toISOString()});var Rn={};class Ln{constructor(t,r=null){this.supabase=t,this.cache=new Map,this.notifyUpdate=typeof r=="function"?r:null,this.isLocalMode=!t||this.checkLocalMode()}checkLocalMode(){try{return!this.supabase||Rn.REACT_APP_SUPABASE_URL==="your-supabase-url"}catch{return!0}}getLocalClients(){try{const t=localStorage.getItem("bptm_clients");return t?JSON.parse(t):[]}catch{return[]}}saveLocalClients(t){try{return localStorage.setItem("bptm_clients",JSON.stringify(t)),!0}catch{return!1}}async getAllClients(){if(this.isLocalMode){const t=this.getLocalClients();return t.forEach(r=>this.cache.set(r.id,r)),t}try{const{data:t,error:r}=await this.supabase.from("clients").select("*").order("created_at",{ascending:!1});if(r)throw r;return t.forEach(a=>this.cache.set(a.id,a)),t||[]}catch(t){return console.warn("Supabase failed, falling back to local mode:",t.message),this.isLocalMode=!0,this.getLocalClients()}}async findOrCreateClientByName(t,r={}){const a=(t||"").trim();if(!a)throw new Error("Client name is required");if(this.isLocalMode){const n=this.getLocalClients(),l=n.find(c=>c.name===a);if(l)return l;const o={...Te,...r,id:"client-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),name:a,created_at:new Date().toISOString()};return n.push(o),this.saveLocalClients(n),this.notifyUpdate&&this.notifyUpdate(o),o}try{const{data:n,error:l}=await this.supabase.from("clients").select("*").eq("name",a).maybeSingle();if(l&&l.code!=="PGRST116")throw l;if(n)return n;const o={...Te,...r,name:a},{data:c,error:d}=await this.supabase.from("clients").insert(o).select("*").single();if(d)throw d;return this.notifyUpdate&&this.notifyUpdate(c),c}catch(n){return console.warn("Supabase failed, falling back to local mode:",n.message),this.isLocalMode=!0,this.findOrCreateClientByName(t,r)}}async createClient(t){const r={...Te,...t};if(this.isLocalMode){const a=this.getLocalClients(),n={...r,id:r.id||"client-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),created_at:r.created_at||new Date().toISOString()};return a.push(n),this.saveLocalClients(a),this.notifyUpdate&&this.notifyUpdate(n),n}try{const{data:a,error:n}=await this.supabase.from("clients").insert(r).select("*").single();if(n)throw n;return this.notifyUpdate&&this.notifyUpdate(a),a}catch(a){return console.warn("Supabase failed, falling back to local mode:",a.message),this.isLocalMode=!0,this.createClient(t)}}async updateClient(t){if(!(t!=null&&t.id))throw new Error("Client id is required");if(this.isLocalMode){const r=this.getLocalClients(),a=r.findIndex(n=>n.id===t.id);if(a===-1)throw new Error("Client not found");return r[a]={...r[a],...t},this.saveLocalClients(r),this.notifyUpdate&&this.notifyUpdate(r[a]),r[a]}try{const{data:r,error:a}=await this.supabase.from("clients").update(t).eq("id",t.id).select("*").single();if(a)throw a;return this.notifyUpdate&&this.notifyUpdate(r),r}catch(r){return console.warn("Supabase failed, falling back to local mode:",r.message),this.isLocalMode=!0,this.updateClient(t)}}async addServicesToClient(t,r=[]){if(this.isLocalMode){const n=this.getLocalClients().find(d=>d.id===t);if(!n)throw new Error("Client not found");const o=[...n.services||[],...r],c={...n,services:o};return this.updateClient(c)}try{const{data:a,error:n}=await this.supabase.from("clients").select("*").eq("id",t).single();if(n)throw n;const o=[...a.services||[],...r],{data:c,error:d}=await this.supabase.from("clients").update({...a,services:o}).eq("id",t).select("*").single();if(d)throw d;return this.notifyUpdate&&this.notifyUpdate(c),c}catch(a){return console.warn("Supabase failed, falling back to local mode:",a.message),this.isLocalMode=!0,this.addServicesToClient(t,r)}}}function Ct(s,t){return new Ln(s,t)}const _n={validateClientName:s=>{const t=St.validateField("client.name",s);return t.isValid?[]:t.errors},validateServices:s=>{const t=St.validateField("client.services",s);return t.isValid?[]:t.errors},validateClientData:(s,t=[])=>{const r=St.validateClientData(s,t);return{errors:r.errors,warnings:r.warnings}}},Pn=(s,t,r)=>{const[a,n]=i.useState(!1),[l,o]=i.useState({}),[c,d]=i.useState([]),[h,m]=i.useState(null),f=i.useRef(null),C=i.useCallback(async(N,M=[],S={})=>{var v,u,b;if(a)return console.log("‚ö†Ô∏è Client creation already in progress"),{success:!1,error:"Creation already in progress"};n(!0),m("validating"),o({}),d([]);try{console.log("üîç Validating client data...");const E=await s.from("clients").select("name").then(({data:R})=>R||[]),y=M.map(R=>({service:R,frequency:S[R]||"Monthly",notes:"",added_date:new Date().toISOString()})),A={...N,services:y},j=_n.validateClientData(A,E);if(!j.isValid)return o(j.errors),d(j.warnings),m("validation_failed"),{success:!1,error:"Validation failed",validationErrors:j.errors,validationWarnings:j.warnings};d(j.warnings),m("creating"),console.log("üíæ Creating client in database...");const p={name:N.name.trim(),team:N.team,client_type:N.client_type,status:"Active",services:y,contact_email:((v=N.contact_email)==null?void 0:v.trim())||"",contact_phone:((u=N.contact_phone)==null?void 0:u.trim())||"",scope_notes:((b=N.scope_notes)==null?void 0:b.trim())||"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:k,error:$}=await s.from("clients").insert([p]).select().single();if($)throw console.error("‚ùå Database creation error:",$),new Error(`Database error: ${$.message}`);m("verifying"),console.log("‚úÖ Verifying client creation...");const{data:D,error:L}=await s.from("clients").select("*").eq("id",k.id).single();if(L||!D){console.error("‚ùå Verification failed:",L);try{await s.from("clients").delete().eq("id",k.id),console.log("üîÑ Rolled back failed client creation")}catch(R){console.error("‚ùå Rollback failed:",R)}throw new Error("Client creation could not be verified")}return m("success"),f.current={client:D,timestamp:Date.now()},console.log("üéâ Client created successfully:",D.name),t&&t(D),{success:!0,client:D,message:`Client "${D.name}" created successfully`}}catch(E){console.error("‚ùå Client creation failed:",E),m("error");const y=E.message||"Unknown error occurred";return r&&r(E),{success:!1,error:y}}finally{n(!1),setTimeout(()=>{m(null)},5e3)}},[a,s,t,r]),x=i.useCallback(()=>{o({}),d([]),m(null)},[]);return{createClient:C,isCreating:a,validationErrors:l,validationWarnings:c,creationStatus:h,resetValidation:x,lastCreation:f.current}},Ks=({src:s,alt:t="Image",className:r="",fallbackSrc:a=null,showFallback:n=!0,loading:l="lazy",onLoad:o=null,onError:c=null,...d})=>{const[h,m]=i.useState({loading:!0,error:!1,loaded:!1}),f=i.useCallback(N=>{m({loading:!1,error:!1,loaded:!0}),o&&o(N)},[o]),C=i.useCallback(N=>{m(M=>({...M,loading:!1,error:!0})),c&&c(N)},[c]),x=i.useCallback(N=>{m(M=>({...M,loading:!1,error:!0}))},[]);return!s||h.error&&!a?n?e.jsx("div",{className:`bg-gray-100 flex items-center justify-center ${r}`,...d,children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"m21 19v-14c0-1.1-.9-2-2-2h-14c0-1.1-.9-2-2-2s-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-12.5-9.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5zm4.5 9h-10v-4l2-2 3 3 2-2 3 3v2z"})})}):null:e.jsxs("div",{className:"relative",children:[h.loading&&e.jsx("div",{className:`absolute inset-0 bg-gray-100 flex items-center justify-center ${r}`,children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full"})}),!h.error&&e.jsx("img",{src:s,alt:t,className:`${r} ${h.loading?"opacity-0":"opacity-100"} transition-opacity duration-200`,loading:l,onLoad:f,onError:a?C:x,...d}),h.error&&a&&e.jsx("img",{src:a,alt:t,className:r,loading:l,onLoad:f,onError:x,...d})]})},Dl=({src:s,name:t="User",size:r="md",className:a="",showFallback:n=!0})=>{const l={xs:"w-6 h-6 text-xs",sm:"w-8 h-8 text-sm",md:"w-12 h-12 text-base",lg:"w-16 h-16 text-lg",xl:"w-24 h-24 text-xl","2xl":"w-32 h-32 text-2xl"},o=l[r]||l.md,c=`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=6366f1&color=fff&size=128&font-size=0.33`;return e.jsx("div",{className:`${o} rounded-full overflow-hidden border-2 border-white shadow-sm ${a}`,children:e.jsx(Ks,{src:s,alt:`${t}'s profile picture`,className:"w-full h-full object-cover",fallbackSrc:c,showFallback:n,loading:"eager"})})},Tn=({src:s,clientName:t="Client",size:r="md",className:a="",showFallback:n=!0})=>{const l={xs:"w-8 h-6",sm:"w-12 h-9",md:"w-16 h-12",lg:"w-24 h-18",xl:"w-32 h-24"},o=l[r]||l.md,c=m=>{const f=document.createElement("canvas");f.width=128,f.height=96;const C=f.getContext("2d");C.fillStyle="#f3f4f6",C.fillRect(0,0,128,96),C.fillStyle="#6b7280",C.font="bold 14px system-ui",C.textAlign="center",C.textBaseline="middle";const x=m.length>12?m.substring(0,12)+"...":m;return C.fillText(x,64,48),f.toDataURL()},[d,h]=q.useState("");return q.useEffect(()=>{h(c(t))},[t]),e.jsx("div",{className:`${o} rounded-md overflow-hidden border border-gray-200 bg-white ${a}`,children:e.jsx(Ks,{src:s,alt:`${t} logo`,className:"w-full h-full object-contain p-1",fallbackSrc:d,showFallback:n})})};function In(s,t,r=!0,a=2e3,n,l){const[o,c]=i.useState(null),[d,h]=i.useState(!1),[m,f]=i.useState(!1),C=i.useRef(null),x=i.useRef(s),N=i.useRef(r);i.useEffect(()=>{x.current=s,N.current=r},[s,r]);const M=i.useCallback(async()=>{if(!N.current||!t)return!1;try{h(!0);const E={...x.current,lastSaved:new Date().toISOString(),sessionInfo:{userAgent:navigator.userAgent,timestamp:Date.now(),url:window.location.href}};return localStorage.setItem(t,JSON.stringify(E)),c(new Date),f(!1),n&&n(E),console.log("üíæ Auto-save successful:",t),!0}catch(E){return console.error("‚ùå Auto-save failed:",E),l&&l(E),!1}finally{h(!1)}},[t,n,l]),S=i.useCallback(()=>{C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{M()},a)},[M,a]);i.useEffect(()=>(r&&t&&s&&(f(!0),S()),()=>{C.current&&clearTimeout(C.current)}),[s,r,t,S]);const v=i.useCallback(()=>{if(!t)return null;try{const E=localStorage.getItem(t);if(E){const y=JSON.parse(E);return console.log("üìÑ Loaded saved data:",t),y}}catch(E){console.error("‚ùå Failed to load saved data:",E)}return null},[t]),u=i.useCallback(()=>{if(t)try{localStorage.removeItem(t),c(null),f(!1),console.log("üóëÔ∏è Cleared saved data:",t)}catch(E){console.error("‚ùå Failed to clear saved data:",E)}},[t]),b=i.useCallback(async()=>(C.current&&clearTimeout(C.current),await M()),[M]);return i.useEffect(()=>{const E=y=>{if(m&&r&&t){try{const A={...x.current,lastSaved:new Date().toISOString(),emergencySave:!0};localStorage.setItem(t,JSON.stringify(A)),console.log("üíæ Emergency save on page unload")}catch(A){console.error("‚ùå Emergency save failed:",A)}return y.preventDefault(),y.returnValue="You have unsaved changes. Are you sure you want to leave?","You have unsaved changes. Are you sure you want to leave?"}};return window.addEventListener("beforeunload",E),()=>window.removeEventListener("beforeunload",E)},[m,r,t]),{lastSaved:o,isSaving:d,hasUnsavedChanges:m,saveNow:b,loadSavedData:v,clearSavedData:u,isEnabled:r&&!!t}}function $n(s,t){return i.useCallback(()=>{if(!s||!t)return null;const r=[s];return Object.entries(t).forEach(([a,n])=>{n&&r.push(`${a}-${n}`)}),r.length>1?r.join("_"):null},[s,t])()}function On(){const s=Ne(),{notify:t}=pe(),{clients:r,loading:a,addClient:n,updateClient:l,fetchClients:o,getClientsByTeam:c}=Le(),d=a.clients;i.useCallback(w=>w==="All"?r:r.filter(_=>_.status===w),[r]);const h=i.useCallback(()=>o(!0),[o]),[m,f]=i.useState(!1),[C,x]=i.useState("All"),[N,M]=i.useState("Active"),[S,v]=i.useState(""),[u,b]=i.useState({...Te}),E=$n("client_form",{name:u.name,team:u.team||"new"}),{lastSaved:y,isSaving:A,hasUnsavedChanges:j,saveNow:p,loadSavedData:k,clearSavedData:$}=In(u,E,m&&(u.name||u.scope_notes),2e3,w=>console.log("üíæ Client form auto-saved"),w=>t({type:"error",title:"Auto-save failed",message:w.message})),[D,L]=i.useState(null),[R,F]=i.useState(!1),[Z,G]=i.useState(null),[ee,ie]=i.useState([]),[he,de]=i.useState({}),{isCreating:ne}=Pn(s,w=>{f(!1),b({...Te}),console.log("‚úÖ Client created successfully:",w.name),n(w)},w=>{console.error("‚ùå Error creating client:",w)});i.useEffect(()=>{if(!d&&r.length>0){const w={};nt.forEach(_=>{w[_]="Monthly"}),de(w)}},[d,r]);const re=i.useMemo(()=>{let w=r;if(C!=="All"&&(w=w.filter(_=>_.team===C)),N!=="All"&&(w=w.filter(_=>_.status===N)),S.trim()){const _=S.toLowerCase();w=w.filter(U=>U.name.toLowerCase().includes(_)||(U.scope_notes||"").toLowerCase().includes(_))}return w},[r,C,N,S]),le=i.useMemo(()=>{const w=new Set(["All"]);return r.forEach(_=>w.add(_.team||"Web")),Array.from(w)},[r]),W=w=>{ie(_=>_.includes(w)?_.filter(U=>U!==w):[..._,w])},ue=async()=>{try{if(!u.name||!u.name.trim()){t({type:"error",title:"Validation Error",message:"Please enter a client name"});return}const w=ee.map(xe=>rs(xe,he[xe]||"Monthly")),_=Ct(s,xe=>{l(xe)}),U={...u,services:w},K=await _.createClient(U);K&&(n(K),f(!1),b({...Te}),ie([]),$(),t({type:"success",title:"Client created",message:K.name}))}catch(w){t({type:"error",title:"Client create failed",message:w.message})}};i.useEffect(()=>{if(m&&E){const w=k();w&&(w.name||w.scope_notes)&&(b(w),t({type:"info",title:"Draft restored",message:"Your previous work has been restored"}))}},[m,E,k,t]);const Q=i.useCallback(()=>{j&&!window.confirm("You have unsaved changes. Discard them?")||(f(!1),b({...Te}),ie([]),$())},[j,$]),Y=async w=>{try{const U=await Ct(s,K=>{l(K)}).updateClient(w);U&&(l(U),L(null),t({type:"success",title:"Client updated",message:U.name}))}catch(_){t({type:"error",title:"Update failed",message:_.message})}},X=async(w,_)=>{try{if(!(_!=null&&_.url))return;const{error:U}=await s.from("clients").update({logo_url:_.url}).eq("id",w.id);if(U)throw U;t({type:"success",title:"Logo updated",message:w.name}),l({...w,logo_url:_.url})}catch(U){t({type:"error",title:"Logo update failed",message:U.message})}},we=async()=>{if(Z)try{const w=Ct(s,K=>{l(K)}),_=ee.map(K=>rs(K,he[K]||"Monthly")),U=await w.addServicesToClient(Z.id,_);U&&(l(U),F(!1),G(null),ie([]),t({type:"success",title:"Services added",message:U.name}))}catch(w){t({type:"error",title:"Add services failed",message:w.message})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Client Management"}),e.jsx("button",{className:"rounded-xl bg-blue-600 text-white px-4 py-2",onClick:()=>f(w=>!w),children:m?"Close":"Create New Client"})]}),m&&e.jsxs("div",{className:"border rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Client Name"}),e.jsx("input",{className:"w-full border rounded-xl p-2",value:u.name,onChange:w=>b(_=>({..._,name:w.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Team"}),e.jsxs("select",{className:"w-full border rounded-xl p-2",value:u.team,onChange:w=>b(_=>({..._,team:w.target.value})),children:[e.jsx("option",{children:"Web"}),e.jsx("option",{children:"Marketing"}),e.jsx("option",{children:"Website"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Status"}),e.jsxs("select",{className:"w-full border rounded-xl p-2",value:u.status,onChange:w=>b(_=>({..._,status:w.target.value})),children:[e.jsx("option",{children:"Active"}),e.jsx("option",{children:"Paused"}),e.jsx("option",{children:"Left"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Scope Notes"}),e.jsx("textarea",{className:"w-full border rounded-xl p-2",rows:3,value:u.scope_notes,onChange:w=>b(_=>({..._,scope_notes:w.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Services"}),e.jsx("div",{className:"grid md:grid-cols-4 gap-2 mt-2",children:nt.map(w=>e.jsxs("label",{className:"flex items-center gap-2 border rounded-xl p-2",children:[e.jsx("input",{type:"checkbox",checked:ee.includes(w),onChange:()=>W(w)}),e.jsx("span",{children:w})]},w))})]}),E&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:A?e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[e.jsx("div",{className:"animate-spin w-3 h-3 border-2 border-yellow-600 border-t-transparent rounded-full"}),e.jsx("span",{children:"Saving..."})]}):y?e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("span",{children:["Saved ",new Date().getTime()-y.getTime()<1e4?"just now":"automatically"]})]}):j?e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-600 rounded-full"}),e.jsx("span",{children:"Unsaved changes"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full"}),e.jsx("span",{children:"Ready"})]})}),j&&e.jsx("button",{onClick:p,className:"text-blue-600 hover:text-blue-800 underline",children:"Save Now"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"rounded-xl px-4 py-2 border",onClick:Q,children:"Cancel"}),e.jsx("button",{className:"rounded-xl px-4 py-2 bg-blue-600 text-white",onClick:ue,disabled:ne,children:ne?"Creating...":"Create Client"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("select",{className:"border rounded-xl p-2",value:C,onChange:w=>x(w.target.value),children:le.map(w=>e.jsx("option",{children:w},w))}),e.jsx("select",{className:"border rounded-xl p-2",value:N,onChange:w=>M(w.target.value),children:["Active","Paused","Left","All"].map(w=>e.jsx("option",{children:w},w))}),e.jsx("input",{className:"border rounded-xl p-2",placeholder:"Search clients",value:S,onChange:w=>v(w.target.value)}),e.jsx("button",{className:"rounded-xl px-3 py-2 border",onClick:()=>h(),children:"Refresh"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:re.map(w=>{var _;return e.jsxs("div",{className:"border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Tn,{url:w.logo_url,name:w.name}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:w.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[w.team," ‚Ä¢ ",w.status]})]})]}),e.jsx("button",{className:"rounded-xl px-3 py-2 border",onClick:()=>L(w),children:"Edit"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Logo"}),e.jsx(ImageUpload,{currentImageUrl:w.logo_url,onImageChange:U=>X(w,U),userId:`client-${w.id||w.name}`,type:"client-logo",maxWidth:300,maxHeight:300,placeholder:"Upload client logo",className:"max-w-xs"})]}),((_=w.services)==null?void 0:_.length)>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Services"}),e.jsx("ul",{className:"text-sm mt-1 list-disc pl-5",children:w.services.map((U,K)=>e.jsxs("li",{children:[U.service," ",e.jsxs("span",{className:"text-gray-500",children:["(",U.frequency,")"]})]},K))})]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx("button",{className:"rounded-xl px-3 py-2 border",onClick:()=>{G(w),F(!0)},children:"Add Services"})})]},w.id)})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-3 sm:p-4 w-full max-w-xs sm:max-w-md md:max-w-lg lg:max-w-2xl max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-medium",children:"Edit Client"}),e.jsx("button",{className:"text-gray-500",onClick:()=>L(null),children:"‚úï"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Client Name"}),e.jsx("input",{className:"w-full border rounded-xl p-2",value:D.name,onChange:w=>L(_=>({..._,name:w.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Team"}),e.jsxs("select",{className:"w-full border rounded-xl p-2",value:D.team,onChange:w=>L(_=>({..._,team:w.target.value})),children:[e.jsx("option",{children:"Web"}),e.jsx("option",{children:"Marketing"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Status"}),e.jsxs("select",{className:"w-full border rounded-xl p-2",value:D.status,onChange:w=>L(_=>({..._,status:w.target.value})),children:[e.jsx("option",{children:"Active"}),e.jsx("option",{children:"Paused"}),e.jsx("option",{children:"Left"})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"text-sm",children:"Scope Notes"}),e.jsx("textarea",{className:"w-full border rounded-xl p-2",rows:3,value:D.scope_notes,onChange:w=>L(_=>({..._,scope_notes:w.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{className:"rounded-xl px-4 py-2 border",onClick:()=>L(null),children:"Cancel"}),e.jsx("button",{className:"rounded-xl px-4 py-2 bg-blue-600 text-white",onClick:()=>Y(D),children:"Save"})]})]})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-3 sm:p-4 w-full max-w-xs sm:max-w-md md:max-w-lg lg:max-w-2xl max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-medium",children:"Add Services"}),e.jsx("button",{className:"text-gray-500",onClick:()=>F(!1),children:"‚úï"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3 mt-3",children:nt.map(w=>e.jsxs("label",{className:"flex items-center gap-2 border rounded-xl p-2",children:[e.jsx("input",{type:"checkbox",checked:ee.includes(w),onChange:()=>W(w)}),e.jsx("span",{children:w})]},w))}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{className:"rounded-xl px-4 py-2 border",onClick:()=>F(!1),children:"Cancel"}),e.jsx("button",{className:"rounded-xl px-4 py-2 bg-blue-600 text-white",onClick:we,children:"Add Selected"})]})]})})]})}const Un=({title:s="Team Leaderboard",period:t="monthly",metric:r="performance",showFilters:a=!0,maxItems:n=10,showAwards:l=!0})=>{const{user:o,role:c}=He(),{notify:d}=pe(),{employees:h}=Le(),[m,f]=i.useState(t),[C,x]=i.useState(r),[N,M]=i.useState([]),[S,v]=i.useState(!1),u=[{value:"daily",label:"Today",icon:"üìÖ"},{value:"weekly",label:"This Week",icon:"üìä"},{value:"monthly",label:"This Month",icon:"üìà"},{value:"quarterly",label:"This Quarter",icon:"üìã"},{value:"yearly",label:"This Year",icon:"üèÜ"}],b=[{value:"performance",label:"Overall Performance",icon:"‚≠ê",color:"blue"},{value:"sales",label:"Sales Revenue",icon:"üí∞",color:"green"},{value:"productivity",label:"Productivity Score",icon:"‚ö°",color:"yellow"},{value:"quality",label:"Quality Rating",icon:"‚ú®",color:"purple"},{value:"collaboration",label:"Team Collaboration",icon:"ü§ù",color:"indigo"},{value:"innovation",label:"Innovation Points",icon:"üí°",color:"orange"}],E={1:{icon:"ü•á",title:"Gold Medal",color:"text-yellow-500"},2:{icon:"ü•à",title:"Silver Medal",color:"text-gray-400"},3:{icon:"ü•â",title:"Bronze Medal",color:"text-orange-600"},top10:{icon:"üåü",title:"Top Performer",color:"text-blue-500"},improved:{icon:"üìà",title:"Most Improved",color:"text-green-500"},consistent:{icon:"üéØ",title:"Consistency Award",color:"text-purple-500"}};i.useEffect(()=>{y()},[m,C,h]);const y=()=>{v(!0),setTimeout(()=>{const Z=h.map((G,ee)=>{const ie=Math.random()*100,he={daily:.8+Math.random()*.4,weekly:.7+Math.random()*.6,monthly:.6+Math.random()*.8,quarterly:.5+Math.random()*1,yearly:.4+Math.random()*1.2}[m]||1,de={performance:1,sales:.8+Math.random()*.4,productivity:.9+Math.random()*.2,quality:.85+Math.random()*.3,collaboration:.7+Math.random()*.6,innovation:.6+Math.random()*.8}[C]||1,ne=Math.round(ie*he*de),re=Math.round(ne*(.8+Math.random()*.4)),le=ne-re,W=re>0?Math.round(le/re*100):0;return{id:G.id,name:G.name,role:G.role,department:G.department,avatar:G.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(G.name)}&background=random`,score:ne,previousScore:re,change:le,changePercent:W,trend:le>0?"up":le<0?"down":"neutral",achievements:A(ne,le,ee),details:j(C,ne)}}).sort((G,ee)=>ee.score-G.score).map((G,ee)=>({...G,rank:ee+1,isTopPerformer:ee<3,award:p(ee+1,G.changePercent)}));M(Z.slice(0,n)),v(!1)},500)},A=(R,F,Z)=>{const G=[];return R>90&&G.push("High Performer"),F>20&&G.push("Rising Star"),Z%3===0&&G.push("Team Player"),R>95&&G.push("Excellence Award"),G},j=(R,F)=>({performance:{tasks:Math.round(F*.8),quality:Math.round(F*.9),efficiency:Math.round(F*.85)},sales:{revenue:`$${(F*1e3).toLocaleString()}`,deals:Math.round(F*.1),conversion:`${Math.round(F*.8)}%`},productivity:{hoursWorked:Math.round(F*.4),tasksCompleted:Math.round(F*.6),efficiency:`${Math.round(F*.9)}%`},quality:{rating:(F/20).toFixed(1),reviews:Math.round(F*.2),satisfaction:`${Math.round(F*.95)}%`},collaboration:{teamProjects:Math.round(F*.1),helpRequests:Math.round(F*.3),mentoring:Math.round(F*.05)},innovation:{ideas:Math.round(F*.1),implementations:Math.round(F*.05),impact:`${Math.round(F*.8)}%`}})[R]||{},p=(R,F)=>R===1?E[1]:R===2?E[2]:R===3?E[3]:R<=10?E.top10:F>50?E.improved:F>=-5&&F<=5?E.consistent:null,k=R=>R===1?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white":R===2?"bg-gradient-to-r from-gray-300 to-gray-500 text-white":R===3?"bg-gradient-to-r from-orange-400 to-orange-600 text-white":R<=10?"bg-gradient-to-r from-blue-400 to-blue-600 text-white":"bg-gray-100 text-gray-700",$=R=>{switch(R){case"up":return"üìà";case"down":return"üìâ";default:return"‚û°Ô∏è"}},D=R=>{switch(R){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}},L=b.find(R=>R.value===C);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card-brand p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-brand-text flex items-center space-x-2",children:[e.jsx("span",{children:"üèÜ"}),e.jsx("span",{children:s})]}),e.jsx("p",{className:"text-brand-text-secondary mt-1",children:"Track team performance and celebrate achievements"})]}),a&&e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("select",{value:m,onChange:R=>f(R.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:u.map(R=>e.jsxs("option",{value:R.value,children:[R.icon," ",R.label]},R.value))}),e.jsx("select",{value:C,onChange:R=>x(R.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:b.map(R=>e.jsxs("option",{value:R.value,children:[R.icon," ",R.label]},R.value))})]})]})}),e.jsxs("div",{className:"card-brand p-6",children:[S?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((R,F)=>e.jsxs("div",{className:"animate-pulse flex items-center space-x-4 p-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]},F))}):e.jsx("div",{className:"space-y-2",children:N.map((R,F)=>e.jsxs("div",{className:`flex items-center space-x-4 p-4 rounded-lg transition-all duration-200 hover:shadow-md ${R.rank<=3?"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200":"bg-slate-50 hover:bg-slate-100"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg ${k(R.rank)}`,children:R.rank<=3?E[R.rank].icon:R.rank}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:R.avatar,alt:R.name,className:"w-12 h-12 rounded-full object-cover border-2 border-white shadow-sm"}),R.award&&l&&e.jsx("div",{className:`absolute -top-1 -right-1 text-lg ${R.award.color}`,children:R.award.icon})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-brand-text",children:R.name}),R.achievements.length>0&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:R.achievements[0]})]}),e.jsxs("p",{className:"text-sm text-brand-text-secondary",children:[R.role," ‚Ä¢ ",R.department]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold text-brand-text",children:R.score}),e.jsx("span",{className:"text-sm text-brand-text-secondary",children:L==null?void 0:L.icon})]}),e.jsxs("div",{className:`flex items-center space-x-1 text-sm ${D(R.trend)}`,children:[e.jsx("span",{children:$(R.trend)}),e.jsxs("span",{children:[R.change>0?"+":"",R.change,"(",R.changePercent>0?"+":"",R.changePercent,"%)"]})]})]}),e.jsx("div",{className:"text-right text-sm text-brand-text-secondary",children:Object.entries(R.details).slice(0,2).map(([Z,G])=>e.jsxs("div",{children:[e.jsxs("span",{className:"capitalize",children:[Z,":"]})," ",G]},Z))})]},R.id))}),!S&&N.length>0&&e.jsx("div",{className:"mt-6 pt-6 border-t border-slate-200",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-brand-text-secondary",children:[e.jsxs("span",{children:["Showing top ",N.length," performers for ",L==null?void 0:L.label.toLowerCase()]}),e.jsx("button",{onClick:y,className:"text-blue-600 hover:text-blue-800 font-medium",children:"üîÑ Refresh Data"})]})}),!S&&N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üèÜ"}),e.jsx("h3",{className:"text-lg font-medium text-brand-text mb-2",children:"No Data Available"}),e.jsx("p",{className:"text-brand-text-secondary",children:"No performance data found for the selected period and metric."})]})]})]})},Fn=()=>{const{user:s,role:t}=He(),{clients:r,employees:a}=Le(),{submissions:n}=gt(),[l,o]=i.useState({totalUsers:0,activeProjects:0,completedTasks:0,pendingTasks:0,departmentStats:{},roleDistribution:{},recentActivity:[],performanceMetrics:{}}),[c,d]=i.useState("7d"),[h,m]=i.useState(!0);i.useEffect(()=>{f()},[a,r,n,c]);const f=()=>{m(!0);try{const x=a.length,N=r.filter(y=>y.status==="active").length,M=n.filter(y=>y.status==="completed").length,S=n.filter(y=>y.status==="pending").length,v=a.reduce((y,A)=>{const j=A.department||"Unassigned";return y[j]=(y[j]||0)+1,y},{}),u=a.reduce((y,A)=>{const j=A.role||"Unassigned";return y[j]=(y[j]||0)+1,y},{}),b=n.sort((y,A)=>new Date(A.created_at)-new Date(y.created_at)).slice(0,10).map(y=>{var A;return{id:y.id,type:y.type||"submission",title:y.title||"Untitled",user:((A=a.find(j=>j.id===y.created_by))==null?void 0:A.name)||"Unknown",timestamp:y.created_at,status:y.status}}),E={completionRate:x>0?(M/(M+S)*100).toFixed(1):0,averageTasksPerUser:x>0?((M+S)/x).toFixed(1):0,activeUserPercentage:x>0?(a.filter(y=>y.status==="active").length/x*100).toFixed(1):0};o({totalUsers:x,activeProjects:N,completedTasks:M,pendingTasks:S,departmentStats:v,roleDistribution:u,recentActivity:b,performanceMetrics:E})}catch(x){console.error("Error calculating analytics:",x)}finally{m(!1)}},C=x=>new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return h?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[...Array(4)].map((x,N)=>e.jsxs("div",{className:"card-brand p-6",children:[e.jsx("div",{className:"h-4 bg-slate-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-8 bg-slate-200 rounded w-3/4"})]},N))})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-text",children:"Dashboard Analytics"}),e.jsxs("select",{value:c,onChange:x=>d(x.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"7d",children:"Last 7 days"}),e.jsx("option",{value:"30d",children:"Last 30 days"}),e.jsx("option",{value:"90d",children:"Last 90 days"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:l.totalUsers}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Total Users"})]}),e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:l.activeProjects}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Active Projects"})]}),e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:l.completedTasks}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Completed Tasks"})]}),e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600 mb-2",children:l.pendingTasks}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Pending Tasks"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card-brand p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text mb-4",children:"Department Distribution"}),e.jsx("div",{className:"space-y-3",children:Object.entries(l.departmentStats).map(([x,N])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-brand-text",children:x}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${N/l.totalUsers*100}%`}})}),e.jsx("span",{className:"text-sm font-medium text-brand-text",children:N})]})]},x))})]}),e.jsxs("div",{className:"card-brand p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text mb-4",children:"Role Distribution"}),e.jsx("div",{className:"space-y-3",children:Object.entries(l.roleDistribution).slice(0,6).map(([x,N])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-brand-text text-sm",children:x}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${N/l.totalUsers*100}%`}})}),e.jsx("span",{className:"text-sm font-medium text-brand-text",children:N})]})]},x))})]})]}),e.jsxs("div",{className:"card-brand p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text mb-4",children:"Performance Metrics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-1",children:[l.performanceMetrics.completionRate,"%"]}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Task Completion Rate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:l.performanceMetrics.averageTasksPerUser}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Avg Tasks per User"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600 mb-1",children:[l.performanceMetrics.activeUserPercentage,"%"]}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Active Users"})]})]})]}),e.jsxs("div",{className:"card-brand p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text mb-4",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:l.recentActivity.length===0?e.jsx("div",{className:"text-center py-8 text-brand-text-secondary",children:"No recent activity found"}):l.recentActivity.map(x=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-brand-text",children:x.title}),e.jsxs("div",{className:"text-sm text-brand-text-secondary",children:["by ",x.user," ‚Ä¢ ",x.type]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${x.status==="completed"?"bg-green-100 text-green-800":x.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:x.status}),e.jsx("div",{className:"text-xs text-brand-text-secondary mt-1",children:C(x.timestamp)})]})]},x.id))})]})]})},Hn=()=>{const{user:s}=He(),{showToast:t}=ut(),{syncData:r}=Le(),[a,n]=i.useState({general:{companyName:"BP Agency",timezone:"UTC",currency:"USD",language:"en"},notifications:{emailNotifications:!0,pushNotifications:!0,weeklyReports:!0,monthlyReports:!0},security:{sessionTimeout:30,passwordExpiry:90,twoFactorAuth:!1,loginAttempts:5},performance:{kpiUpdateFrequency:"daily",reportGeneration:"weekly",dataRetention:365,backupFrequency:"daily"}}),[l,o]=i.useState("general"),[c,d]=i.useState(!1);i.useEffect(()=>{h()},[]);const h=async()=>{try{d(!0),await new Promise(v=>setTimeout(v,1e3))}catch{t("Failed to load configurations","error")}finally{d(!1)}},m=async(v,u,b)=>{try{n(E=>({...E,[v]:{...E[v],[u]:b}})),await r(),t("Configuration updated successfully","success")}catch{t("Failed to update configuration","error")}},f=async()=>{try{d(!0),await new Promise(v=>setTimeout(v,1500)),t("All configurations saved successfully","success")}catch{t("Failed to save configurations","error")}finally{d(!1)}},C=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),e.jsx("input",{type:"text",value:a.general.companyName,onChange:v=>m("general","companyName",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Timezone"}),e.jsxs("select",{value:a.general.timezone,onChange:v=>m("general","timezone",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"UTC",children:"UTC"}),e.jsx("option",{value:"EST",children:"Eastern Time"}),e.jsx("option",{value:"PST",children:"Pacific Time"}),e.jsx("option",{value:"GMT",children:"Greenwich Mean Time"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsxs("select",{value:a.general.currency,onChange:v=>m("general","currency",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"CAD",children:"CAD"})]})]})]}),x=()=>e.jsx("div",{className:"space-y-4",children:Object.entries(a.notifications).map(([v,u])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:v.replace(/([A-Z])/g," $1").replace(/^./,b=>b.toUpperCase())}),e.jsx("input",{type:"checkbox",checked:u,onChange:b=>m("notifications",v,b.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})]},v))}),N=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session Timeout (minutes)"}),e.jsx("input",{type:"number",value:a.security.sessionTimeout,onChange:v=>m("security","sessionTimeout",parseInt(v.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Expiry (days)"}),e.jsx("input",{type:"number",value:a.security.passwordExpiry,onChange:v=>m("security","passwordExpiry",parseInt(v.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Two Factor Authentication"}),e.jsx("input",{type:"checkbox",checked:a.security.twoFactorAuth,onChange:v=>m("security","twoFactorAuth",v.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})]})]}),M=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"KPI Update Frequency"}),e.jsxs("select",{value:a.performance.kpiUpdateFrequency,onChange:v=>m("performance","kpiUpdateFrequency",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Retention (days)"}),e.jsx("input",{type:"number",value:a.performance.dataRetention,onChange:v=>m("performance","dataRetention",parseInt(v.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),S=[{id:"general",label:"General",icon:"‚öôÔ∏è"},{id:"notifications",label:"Notifications",icon:"üîî"},{id:"security",label:"Security",icon:"üîí"},{id:"performance",label:"Performance",icon:"üìä"}];return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Configuration Manager"}),e.jsx("button",{onClick:f,disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors",children:"Save All Changes"})]}),e.jsx("div",{className:"flex border-b border-gray-200 mb-6",children:S.map(v=>e.jsxs("button",{onClick:()=>o(v.id),className:`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${l===v.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx("span",{className:"mr-2",children:v.icon}),v.label]},v.id))}),e.jsxs("div",{className:"min-h-96",children:[l==="general"&&C(),l==="notifications"&&x(),l==="security"&&N(),l==="performance"&&M()]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Note:"}),' Changes are automatically saved when modified. Use "Save All Changes" to persist all configurations.']})})]})},zn=()=>{const{user:s}=He(),{showToast:t}=ut(),{syncData:r}=Le();gt();const[a,n]=i.useState({departmentMetrics:[],rolePerformance:[],crossFunctionalProjects:[],resourceUtilization:[]}),[l,o]=i.useState("month"),[c,d]=i.useState([]),[h,m]=i.useState(!1),[f,C]=i.useState("overview"),x=["Marketing","Sales","HR","Operations","Development","Design"],N=[{value:"week",label:"Last Week"},{value:"month",label:"Last Month"},{value:"quarter",label:"Last Quarter"},{value:"year",label:"Last Year"}];i.useEffect(()=>{M()},[l,c]);const M=async()=>{try{m(!0),await new Promise(k=>setTimeout(k,1500));const y=x.map(k=>({department:k,totalEmployees:Math.floor(Math.random()*20)+5,activeProjects:Math.floor(Math.random()*10)+1,completionRate:Math.floor(Math.random()*30)+70,efficiency:Math.floor(Math.random()*25)+75,revenue:Math.floor(Math.random()*1e5)+5e4})),A=["Manager","Senior","Junior","Intern","Freelancer"].map(k=>({role:k,averageScore:Math.floor(Math.random()*20)+80,tasksCompleted:Math.floor(Math.random()*50)+20,collaborationScore:Math.floor(Math.random()*25)+75,growthRate:Math.floor(Math.random()*15)+5})),j=Array.from({length:8},(k,$)=>({id:$+1,name:`Project ${String.fromCharCode(65+$)}`,departments:x.slice(0,Math.floor(Math.random()*3)+2),status:["Active","Completed","On Hold"][Math.floor(Math.random()*3)],progress:Math.floor(Math.random()*100),teamSize:Math.floor(Math.random()*10)+3,deadline:new Date(Date.now()+Math.random()*90*24*60*60*1e3).toLocaleDateString()})),p=x.map(k=>({department:k,utilization:Math.floor(Math.random()*30)+70,capacity:Math.floor(Math.random()*20)+80,bottlenecks:Math.floor(Math.random()*5),efficiency:Math.floor(Math.random()*25)+75}));n({departmentMetrics:y,rolePerformance:A,crossFunctionalProjects:j,resourceUtilization:p})}catch{t("Failed to generate report data","error")}finally{m(!1)}},S=async()=>{try{await new Promise(y=>setTimeout(y,1e3)),t("Report exported successfully","success")}catch{t("Failed to export report","error")}},v=()=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Total Departments"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:a.departmentMetrics.length}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Active departments"})]}),e.jsxs("div",{className:"bg-green-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"Cross-Functional Projects"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:a.crossFunctionalProjects.length}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Active projects"})]}),e.jsxs("div",{className:"bg-purple-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-2",children:"Average Efficiency"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[Math.round(a.departmentMetrics.reduce((y,A)=>y+A.efficiency,0)/a.departmentMetrics.length||0),"%"]}),e.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"Across all departments"})]}),e.jsxs("div",{className:"bg-orange-50 p-6 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-2",children:"Resource Utilization"}),e.jsxs("p",{className:"text-3xl font-bold text-orange-600",children:[Math.round(a.resourceUtilization.reduce((y,A)=>y+A.utilization,0)/a.resourceUtilization.length||0),"%"]}),e.jsx("p",{className:"text-sm text-orange-600 mt-1",children:"Average utilization"})]})]}),u=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Department Performance Metrics"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employees"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Projects"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completion Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Efficiency"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.departmentMetrics.map((y,A)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:y.department}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:y.totalEmployees}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:y.activeProjects}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs ${y.completionRate>=90?"bg-green-100 text-green-800":y.completionRate>=75?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[y.completionRate,"%"]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[y.efficiency,"%"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",y.revenue.toLocaleString()]})]},A))})]})})]}),b=()=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Cross-Functional Projects"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.crossFunctionalProjects.map(y=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:y.name}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${y.status==="Active"?"bg-green-100 text-green-800":y.status==="Completed"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:y.status})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Departments:"})," ",y.departments.join(", ")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Team Size:"})," ",y.teamSize]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Progress:"})," ",y.progress,"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Deadline:"})," ",y.deadline]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${y.progress}%`}})})})]},y.id))})})]}),E=[{id:"overview",label:"Overview",icon:"üìä"},{id:"departments",label:"Departments",icon:"üè¢"},{id:"projects",label:"Projects",icon:"üöÄ"},{id:"resources",label:"Resources",icon:"‚ö°"}];return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Cross-Dashboard Reporting"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("select",{value:l,onChange:y=>o(y.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:N.map(y=>e.jsx("option",{value:y.value,children:y.label},y.value))}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Export Report"})]})]}),e.jsx("div",{className:"flex border-b border-gray-200 mb-6",children:E.map(y=>e.jsxs("button",{onClick:()=>C(y.id),className:`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${f===y.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx("span",{className:"mr-2",children:y.icon}),y.label]},y.id))}),f==="overview"&&v(),f==="departments"&&u(),f==="projects"&&b(),f==="resources"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Resource Utilization"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.resourceUtilization.map((y,A)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:y.department}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Utilization:"}),e.jsxs("span",{className:"font-medium",children:[y.utilization,"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Capacity:"}),e.jsxs("span",{className:"font-medium",children:[y.capacity,"%"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Bottlenecks:"}),e.jsx("span",{className:"font-medium",children:y.bottlenecks})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Efficiency:"}),e.jsxs("span",{className:"font-medium",children:[y.efficiency,"%"]})]})]})]},A))})]})]})})};function Js({onNavigateToDashboard:s}){const t=Ne(),{submissions:r,clients:a,loading:n,refreshAllData:l}=Le(),{employees:o}=Tt(),{notify:c}=pe(),{openModal:d,closeModal:h}=qe(),{crossDashboardData:m,performanceMetrics:f,dashboardActivity:C,notifications:x,unreadNotifications:N,activeDashboards:M,totalActiveUsers:S,updateDashboardActivity:v,markNotificationRead:u,clearNotifications:b}=fs(),{currentUser:E,hasFeatureAccess:y}=ys(),{systemNotifications:A}=js(),{auditLogs:j,logUserAction:p}=Ns(),[k,$]=i.useState({employees:0,interns:0,managers:0,agency:0}),[D,L]=i.useState({database:"healthy",sync:"healthy",performance:"good"}),[R,F]=i.useState(!1),[Z,G]=i.useState(!1),[ee,ie]=i.useState(!1),[he,de]=i.useState(!1),[ne,re]=i.useState(!1),[le,W]=i.useState(!1),[ue,Q]=i.useState({employee:{active:0,submissions:0,lastActivity:null},agency:{active:0,updates:0,lastActivity:null},intern:{active:0,projects:0,lastActivity:null},manager:{active:1,actions:0,lastActivity:new Date().toISOString()}}),Y=i.useMemo(()=>{const w=qs(),_=r.filter(U=>U.monthKey===w);return{totalEmployees:o.length,activeEmployees:o.filter(U=>U.status==="active").length,currentMonthSubmissions:_.length,pendingReviews:_.filter(U=>{var K;return!((K=U.manager)!=null&&K.reviewed)}).length,totalClients:a.length,activeClients:a.filter(U=>U.status==="active").length,averagePerformance:_.length>0?_.reduce((U,K)=>U+(K.overallScore||0),0)/_.length:0,systemUptime:"99.9%",dataSync:n.submissions||n.clients?"syncing":"synchronized"}},[r,o,a,n]);i.useEffect(()=>{v("manager",{activeUsers:1,currentView:"controlPanel"})},[v]),i.useEffect(()=>{var w,_,U,K;$({employees:((w=C.employee)==null?void 0:w.activeUsers)||0,interns:((_=C.intern)==null?void 0:_.activeUsers)||0,managers:((U=C.manager)==null?void 0:U.activeUsers)||1,agency:((K=C.agency)==null?void 0:K.activeUsers)||0})},[C]),i.useEffect(()=>{const w=()=>{const U=t?"healthy":"local",K=n.submissions||n.clients?"syncing":"healthy",xe=Y.averagePerformance>7?"excellent":Y.averagePerformance>5?"good":"needs-attention";L({database:U,sync:K,performance:xe})};w();const _=setInterval(w,1e4);return()=>clearInterval(_)},[t,n,Y.averagePerformance]);const X=async(w,_)=>{try{switch(w){case"refresh":await l(),c("success","All dashboard data refreshed successfully");break;case"broadcast":d("Broadcast Message",e.jsx(Vn,{onSend:ft=>{console.log("Broadcasting message:",ft),c("success","Message broadcasted to all dashboards"),h()}}),h);break;case"backup":const U={submissions:r,clients:a,employees:o,timestamp:new Date().toISOString()},K=new Blob([JSON.stringify(U,null,2)],{type:"application/json"}),xe=URL.createObjectURL(K),Be=document.createElement("a");Be.href=xe,Be.download=`dashboard-backup-${new Date().toISOString().split("T")[0]}.json`,Be.click(),c("success","Dashboard data backup downloaded");break;default:c("info",`${w} action triggered for ${_}`)}}catch(U){c("error",`Failed to execute ${w}: ${U.message}`)}},we=w=>{switch(w){case"healthy":case"excellent":return"text-green-600 bg-green-100";case"good":case"syncing":return"text-yellow-600 bg-yellow-100";case"local":return"text-blue-600 bg-blue-100";case"needs-attention":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl shadow-lg text-white p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"üéõÔ∏è Manager Control Panel"}),e.jsx("p",{className:"text-blue-100",children:"Centralized oversight and control of all connected dashboards"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:()=>F(!R),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${R?"bg-white/30 hover:bg-white/40":"bg-white/20 hover:bg-white/30"}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),R?"Hide":"Show"," Analytics"]}),e.jsxs("button",{onClick:()=>G(!Z),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${Z?"bg-white/30 hover:bg-white/40":"bg-white/20 hover:bg-white/30"}`,children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),Z?"Hide":"Show"," Configuration"]}),e.jsxs("button",{onClick:()=>ie(!ee),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${ee?"bg-white/30 hover:bg-white/40":"bg-white/20 hover:bg-white/30"}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),ee?"Hide":"Show"," Reports"]}),y("userManagement")&&e.jsxs("button",{onClick:()=>de(!he),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${he?"bg-white/30 hover:bg-white/40":"bg-white/20 hover:bg-white/30"}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),he?"Hide":"Show"," Access Control"]}),e.jsxs("button",{onClick:()=>re(!ne),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${ne?"bg-white/30 hover:bg-white/40":"bg-white/20 hover:bg-white/30"}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-5 5v-5zM4.868 19.718A10.001 10.001 0 0119.718 4.868M4.868 19.718L19.718 4.868"})}),ne?"Hide":"Show"," Notifications",A&&A.filter(w=>!w.read).length>0&&e.jsx("span",{className:"ml-1 px-2 py-1 bg-red-500 text-white rounded-full text-xs",children:A.filter(w=>!w.read).length})]}),e.jsxs("button",{onClick:()=>{W(!le),p("view","audit_logs",{dashboard:"manager"})},className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${le?"bg-white/30 hover:bg-white/40":"bg-white/20 hover:bg-white/30"}`,children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),le?"Hide":"Show"," Audit Logs",e.jsx("span",{className:"ml-1 px-2 py-1 bg-blue-500 text-white rounded-full text-xs",children:j.length})]}),e.jsxs("button",{onClick:()=>X("refresh","all"),className:"flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh All"]}),e.jsxs("button",{onClick:()=>X("broadcast","all"),className:"flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"})}),"Broadcast"]}),e.jsxs("button",{onClick:()=>X("backup","all"),className:"flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Backup"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"üè• System Health"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Database"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${we(D.database)}`,children:D.database})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Data Sync"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${we(D.sync)}`,children:D.sync})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Performance"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${we(D.performance)}`,children:D.performance})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"üë• Active Users"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Employees"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:k.employees})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Interns"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:k.interns})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Agency Team"}),e.jsx("span",{className:"text-lg font-bold text-amber-600",children:k.agency})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"üìä Key Metrics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Avg Performance"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[Y.averagePerformance.toFixed(1),"/10"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Pending Reviews"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:Y.pendingReviews})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"System Uptime"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:Y.systemUptime})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6",children:[e.jsx(rt,{title:"Employee Dashboard",icon:"üë•",color:"blue",stats:[{label:"Total Employees",value:Y.totalEmployees},{label:"Active This Month",value:Y.activeEmployees},{label:"Submissions",value:Y.currentMonthSubmissions}],onNavigate:()=>s("employee"),onQuickAction:w=>X(w,"employee")}),e.jsx(rt,{title:"Agency Dashboard",icon:"üöÄ",color:"amber",stats:[{label:"Active Users",value:k.agency},{label:"Total Clients",value:Y.totalClients},{label:"Active Clients",value:Y.activeClients}],onNavigate:()=>s("agency"),onQuickAction:w=>X(w,"agency")}),e.jsx(rt,{title:"Intern Dashboard",icon:"üéì",color:"orange",stats:[{label:"Active Interns",value:k.interns},{label:"Projects",value:12},{label:"Completion Rate",value:"85%"}],onNavigate:()=>s("intern"),onQuickAction:w=>X(w,"intern")}),e.jsx(rt,{title:"Manager Dashboard",icon:"‚ö°",color:"purple",stats:[{label:"Pending Reviews",value:Y.pendingReviews},{label:"Team Performance",value:`${Y.averagePerformance.toFixed(1)}/10`},{label:"Data Sync",value:Y.dataSync}],onNavigate:()=>s("manager"),onQuickAction:w=>X(w,"manager")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white text-lg",children:"üè¢"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Organization Chart"}),e.jsx("p",{className:"text-sm text-gray-600",children:"View department hierarchies"})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total Employees"}),e.jsx("span",{className:"font-medium",children:Y.totalEmployees})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Active Employees"}),e.jsx("span",{className:"font-medium text-green-600",children:Y.activeEmployees})]})]}),e.jsx("button",{onClick:()=>s("organizationChart"),className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-2 px-4 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-medium",children:"View Organization Chart"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-teal-600 rounded-lg flex items-center justify-center text-white text-lg",children:"üìû"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Employee Directory"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Contact information & WhatsApp"})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"With Phone Numbers"}),e.jsx("span",{className:"font-medium",children:o.filter(w=>w.phone).length})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"WhatsApp Ready"}),e.jsx("span",{className:"font-medium text-gray-900",children:o.filter(w=>w.phone&&w.phone.length>8).length})]})]}),e.jsx("button",{onClick:()=>s("employeeDirectory"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium",children:"View Employee Directory"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center text-gray-600 text-lg",children:"üìä"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Client Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Projects & satisfaction tracking"})]})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total Clients"}),e.jsx("span",{className:"font-medium",children:Y.totalClients})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Active Projects"}),e.jsx("span",{className:"font-medium text-gray-900",children:Y.activeClients})]})]}),e.jsx("button",{onClick:()=>s("clientDirectory"),className:"w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-2 px-4 rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-200 font-medium",children:"View Client Management"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:["üîî Real-time Notifications",N>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:N})]}),e.jsx("button",{onClick:b,className:"text-sm text-gray-500 hover:text-gray-700",children:"Clear All"})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:x.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"No notifications"}):x.slice(0,10).map(w=>e.jsx("div",{className:`p-3 rounded-lg border-l-4 ${w.read?"bg-gray-50 border-gray-300":w.type==="error"?"bg-red-50 border-red-400":w.type==="warning"?"bg-yellow-50 border-yellow-400":"bg-blue-50 border-blue-400"}`,onClick:()=>u(w.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:w.title}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:w.message}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(w.timestamp).toLocaleTimeString()})]}),!w.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full ml-2 mt-1"})]})},w.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"üìà Recent Activity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Je,{icon:"üìù",message:"New employee submission received",time:"2 minutes ago",type:"submission"}),e.jsx(Je,{icon:"üë•",message:"3 employees logged into their dashboards",time:"5 minutes ago",type:"login"}),e.jsx(Je,{icon:"üéì",message:"Intern completed project milestone",time:"12 minutes ago",type:"achievement"}),e.jsx(Je,{icon:"üöÄ",message:"Agency dashboard updated with new announcements",time:"18 minutes ago",type:"update"}),e.jsx(Je,{icon:"‚ö°",message:"Manager reviewed 2 employee submissions",time:"25 minutes ago",type:"review"})]})]}),R&&e.jsx("div",{className:"mt-6",children:e.jsx(Fn,{})}),Z&&e.jsx("div",{className:"mt-6",children:e.jsx(Hn,{})}),ee&&e.jsx("div",{className:"mt-6",children:e.jsx(zn,{})}),he&&y("userManagement")&&e.jsx("div",{className:"mt-6",children:e.jsx(jr,{})}),ne&&e.jsx("div",{className:"mt-6",children:e.jsx(wr,{})}),le&&e.jsx("div",{className:"mt-6",children:e.jsx(Nr,{})})]})}function rt({title:s,icon:t,color:r,stats:a,onNavigate:n,onQuickAction:l}){const o={blue:"border-blue-200 bg-blue-50",amber:"border-amber-200 bg-amber-50",orange:"border-orange-200 bg-orange-50",purple:"border-purple-200 bg-purple-50"},c={blue:"bg-blue-600 hover:bg-blue-700",amber:"bg-amber-600 hover:bg-amber-700",orange:"bg-orange-600 hover:bg-orange-700",purple:"bg-purple-600 hover:bg-purple-700"};return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border-2 ${o[r]} p-6`,children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:t}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s})]})}),e.jsx("div",{className:"space-y-2 mb-4",children:a.map((d,h)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:d.label}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:d.value})]},h))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:n,className:`flex-1 px-3 py-2 ${c[r]} text-white rounded-lg text-sm font-medium transition-colors`,children:"Open"}),e.jsx("button",{onClick:()=>l("monitor"),className:"px-3 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm hover:bg-gray-50 transition-colors",children:"Monitor"})]})]})}function Je({icon:s,message:t,time:r,type:a}){const n={submission:"text-blue-600",login:"text-green-600",achievement:"text-orange-600",update:"text-amber-600",review:"text-purple-600"};return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-lg",children:s}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-900",children:t}),e.jsx("p",{className:`text-xs ${n[a]}`,children:r})]})]})}function Vn({onSend:s}){const[t,r]=i.useState(""),[a,n]=i.useState("normal"),[l,o]=i.useState(["all"]),c=()=>{t.trim()&&s({message:t,priority:a,targets:l,timestamp:new Date().toISOString()})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),e.jsx("textarea",{value:t,onChange:d=>r(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,placeholder:"Enter your message to broadcast to all dashboards..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),e.jsxs("select",{value:a,onChange:d=>n(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx("button",{onClick:c,disabled:!t.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Send Broadcast"})})]})}const Rl=Object.freeze(Object.defineProperty({__proto__:null,ManagerControlPanel:Js},Symbol.toStringTag,{value:"Module"})),qn=()=>{const s=i.useContext(rr);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},ce={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"},Bn={[ce.PENDING]:"bg-yellow-100 text-yellow-800 border-yellow-200",[ce.APPROVED]:"bg-green-100 text-green-800 border-green-200",[ce.REJECTED]:"bg-red-100 text-red-800 border-red-200"},Wn={[ce.PENDING]:"‚è≥",[ce.APPROVED]:"‚úÖ",[ce.REJECTED]:"‚ùå"};function Kn(){const s=Ne(),{notify:t}=pe(),{openModal:r,closeModal:a}=qe(),{refreshEmployees:n}=Tt(),[l,o]=i.useState([]),[c,d]=i.useState(!0),[h,m]=i.useState("all"),[f,C]=i.useState(""),x=i.useCallback(async()=>{d(!0);try{if(s){const{data:u,error:b}=await s.from("employee_signups").select("*").order("submitted_at",{ascending:!1});if(b)throw b;o(u||[])}else{const u=JSON.parse(localStorage.getItem("employee_signups")||"[]");o(u.sort((b,E)=>new Date(E.submitted_at)-new Date(b.submitted_at)))}}catch(u){console.error("Error loading signups:",u),t("Failed to load signup applications","error")}finally{d(!1)}},[s,t]);i.useEffect(()=>{x()},[x]);const N=l.filter(u=>{const b=h==="all"||u.status===h,E=!f||u.name.toLowerCase().includes(f.toLowerCase())||u.email.toLowerCase().includes(f.toLowerCase())||u.department.toLowerCase().includes(f.toLowerCase());return b&&E}),M=i.useCallback(async u=>{r({title:"‚úÖ Approve Application",content:e.jsx(as,{signup:u,action:"approve",onSubmit:async b=>{try{if(s){await s.from("employee_signups").update({status:ce.APPROVED,hr_notes:b.hrNotes,reviewed_at:new Date().toISOString(),reviewed_by:"HR Team"}).eq("id",u.id);const E={name:u.name,email:u.email,phone:u.phone,department:u.department,role:u.role.join(", "),status:"active",hire_date:b.startDate||u.expectedJoinDate,address:`${u.address.street}, ${u.address.city}, ${u.address.state} ${u.address.zipCode}`,emergency_contact:`${u.emergencyContact.name} (${u.emergencyContact.relationship}) - ${u.emergencyContact.phone}`,notes:`Approved from signup. Education: ${u.education}. Experience: ${u.experience}.`};await s.from("employees").insert([E]),await s.from("notifications").insert([{type:"employee_approved",title:"Application Approved",message:`${u.name}'s employee application has been approved. Welcome to the team!`,data:{applicantEmail:u.email,startDate:b.startDate},created_at:new Date().toISOString()}])}else{const y=JSON.parse(localStorage.getItem("employee_signups")||"[]").map(j=>j.id===u.id?{...j,status:ce.APPROVED,hr_notes:b.hrNotes,reviewed_at:new Date().toISOString()}:j);localStorage.setItem("employee_signups",JSON.stringify(y));const A=JSON.parse(localStorage.getItem("employees")||"[]");A.push({id:Date.now().toString(),name:u.name,email:u.email,phone:u.phone,department:u.department,role:u.role.join(", "),status:"active",hire_date:b.startDate||u.expectedJoinDate}),localStorage.setItem("employees",JSON.stringify(A))}await x(),await n(),a(),t(`${u.name}'s application has been approved!`,"success")}catch(E){console.error("Error approving application:",E),t("Failed to approve application","error")}}})})},[s,r,a,t,x,n]),S=i.useCallback(async u=>{r({title:"‚ùå Reject Application",content:e.jsx(as,{signup:u,action:"reject",onSubmit:async b=>{try{if(s)await s.from("employee_signups").update({status:ce.REJECTED,hr_notes:b.hrNotes,reviewed_at:new Date().toISOString(),reviewed_by:"HR Team"}).eq("id",u.id),await s.from("notifications").insert([{type:"employee_rejected",title:"Application Status Update",message:`${u.name}'s employee application has been reviewed.`,data:{applicantEmail:u.email,reason:b.hrNotes},created_at:new Date().toISOString()}]);else{const y=JSON.parse(localStorage.getItem("employee_signups")||"[]").map(A=>A.id===u.id?{...A,status:ce.REJECTED,hr_notes:b.hrNotes,reviewed_at:new Date().toISOString()}:A);localStorage.setItem("employee_signups",JSON.stringify(y))}await x(),a(),t(`${u.name}'s application has been rejected`,"info")}catch(E){console.error("Error rejecting application:",E),t("Failed to reject application","error")}}})})},[s,r,a,t,x]),v=i.useCallback(u=>{r({title:`üìã Application Details - ${u.name}`,content:e.jsx(Jn,{signup:u}),size:"large"})},[r]);return c?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading applications..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"HR Approval Workflow"}),e.jsx("p",{className:"text-gray-600",children:"Review and manage employee signup applications"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"üîÑ Refresh"})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ls,{label:"Search Applications",value:f,onChange:C,placeholder:"Search by name, email, or department..."})}),e.jsxs("div",{className:"sm:w-48",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("select",{value:h,onChange:u=>m(u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Applications"}),e.jsx("option",{value:ce.PENDING,children:"Pending Review"}),e.jsx("option",{value:ce.APPROVED,children:"Approved"}),e.jsx("option",{value:ce.REJECTED,children:"Rejected"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{label:"Total Applications",value:l.length,color:"bg-blue-500"},{label:"Pending Review",value:l.filter(u=>u.status===ce.PENDING).length,color:"bg-yellow-500"},{label:"Approved",value:l.filter(u=>u.status===ce.APPROVED).length,color:"bg-green-500"},{label:"Rejected",value:l.filter(u=>u.status===ce.REJECTED).length,color:"bg-red-500"}].map((u,b)=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${u.color} mr-3`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:u.label}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.value})]})]})},b))}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üìã"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No applications found"}),e.jsx("p",{className:"text-gray-600",children:f||h!=="all"?"Try adjusting your search or filter criteria":"No employee signup applications have been submitted yet"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:N.map(u=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:u.name}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Bn[u.status]}`,children:[Wn[u.status]," ",u.status.charAt(0).toUpperCase()+u.status.slice(1)]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",u.email]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Department:"})," ",u.department]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Role(s):"})," ",Array.isArray(u.role)?u.role.join(", "):u.role]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Expected Join:"})," ",new Date(u.expectedJoinDate).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Submitted:"})," ",new Date(u.submitted_at).toLocaleDateString()]}),u.reviewed_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reviewed:"})," ",new Date(u.reviewed_at).toLocaleDateString()]})]}),u.hr_notes&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"HR Notes:"})," ",u.hr_notes]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>v(u),className:"px-3 py-1 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:"View Details"}),u.status===ce.PENDING&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(u),className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700",children:"‚úÖ Approve"}),e.jsx("button",{onClick:()=>S(u),className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700",children:"‚ùå Reject"})]})]})]})},u.id))})})]})}function as({signup:s,action:t,onSubmit:r}){const{notify:a}=pe(),[n,l]=i.useState({hrNotes:"",startDate:t==="approve"?s.expectedJoinDate:""}),[o,c]=i.useState(!1),d=async h=>{if(h.preventDefault(),!n.hrNotes.trim()){a({type:"error",title:"Validation Error",message:"Please provide HR notes"});return}c(!0);try{await r(n)}finally{c(!1)}};return e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Application Summary"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Department:"})," ",s.department]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role(s):"})," ",Array.isArray(s.role)?s.role.join(", "):s.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected Join Date:"})," ",new Date(s.expectedJoinDate).toLocaleDateString()]})]})]}),t==="approve"&&e.jsx(ls,{label:"Start Date",type:"date",value:n.startDate,onChange:h=>l(m=>({...m,startDate:h})),required:!0}),e.jsx(er,{label:t==="approve"?"Approval Notes":"Rejection Reason",value:n.hrNotes,onChange:h=>l(m=>({...m,hrNotes:h})),placeholder:t==="approve"?"Add any notes for the new employee, onboarding instructions, etc.":"Please provide a reason for rejection that will be communicated to the applicant",rows:4,required:!0}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>window.closeModal&&window.closeModal(),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o,className:`px-4 py-2 rounded-md text-white disabled:opacity-50 ${t==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:o?"Processing...":t==="approve"?"Approve Application":"Reject Application"})]})]})}function Jn({signup:s}){var t,r,a,n,l,o,c,d,h;return e.jsxs("div",{className:"space-y-6 max-h-96 overflow-y-auto",children:[e.jsx(be,{title:"Personal Information",icon:"üë§",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",s.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",s.phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date of Birth:"})," ",s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():"Not provided"]})]})}),e.jsx(be,{title:"Address",icon:"üìç",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:(t=s.address)==null?void 0:t.street}),e.jsxs("p",{children:[(r=s.address)==null?void 0:r.city,", ",(a=s.address)==null?void 0:a.state," ",(n=s.address)==null?void 0:n.zipCode]}),e.jsx("p",{children:(l=s.address)==null?void 0:l.country})]})}),e.jsx(be,{title:"Emergency Contact",icon:"üö®",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",(o=s.emergencyContact)==null?void 0:o.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Relationship:"})," ",(c=s.emergencyContact)==null?void 0:c.relationship]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",(d=s.emergencyContact)==null?void 0:d.phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Email:"})," ",(h=s.emergencyContact)==null?void 0:h.email]})]})}),e.jsx(be,{title:"Professional Information",icon:"üíº",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Department:"})," ",s.department]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Role(s):"})," ",Array.isArray(s.role)?s.role.join(", "):s.role]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expected Join Date:"})," ",new Date(s.expectedJoinDate).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expected Salary:"})," ",s.expectedSalary||"Not specified"]})]})}),e.jsx(be,{title:"Education & Experience",icon:"üéì",children:e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Education:"}),e.jsx("p",{className:"mt-1 text-gray-600",children:s.education})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Experience:"}),e.jsx("p",{className:"mt-1 text-gray-600",children:s.experience})]}),s.skills&&s.skills.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Skills:"}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:s.skills.map((m,f)=>e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:m},f))})]}),s.certifications&&e.jsxs("div",{children:[e.jsx("strong",{children:"Certifications:"}),e.jsx("p",{className:"mt-1 text-gray-600",children:s.certifications})]})]})}),e.jsx(be,{title:"Additional Information",icon:"üîó",children:e.jsxs("div",{className:"space-y-4 text-sm",children:[s.portfolioUrl&&e.jsxs("div",{children:[e.jsx("strong",{children:"Portfolio:"}),e.jsx("a",{href:s.portfolioUrl,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:underline",children:s.portfolioUrl})]}),s.linkedinUrl&&e.jsxs("div",{children:[e.jsx("strong",{children:"LinkedIn:"}),e.jsx("a",{href:s.linkedinUrl,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:underline",children:s.linkedinUrl})]}),s.githubUrl&&e.jsxs("div",{children:[e.jsx("strong",{children:"GitHub:"}),e.jsx("a",{href:s.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-blue-600 hover:underline",children:s.githubUrl})]}),s.coverLetter&&e.jsxs("div",{children:[e.jsx("strong",{children:"Cover Letter:"}),e.jsx("p",{className:"mt-1 text-gray-600",children:s.coverLetter})]})]})})]})}async function Gn(s,t,r,a=""){if(!s){console.log("No Supabase client available - using local storage");const l=JSON.parse(localStorage.getItem("employee_exits")||"[]").map(o=>o.id===t?{...o,status:r,hr_notes:a,updated_at:new Date().toISOString()}:o);return localStorage.setItem("employee_exits",JSON.stringify(l)),l.find(o=>o.id===t)}try{const{data:n,error:l}=await s.from("employee_exits").update({status:r,hr_notes:a,updated_at:new Date().toISOString()}).eq("id",t).select("*").single();if(l)throw l;return console.log("‚úÖ Employee exit status updated:",n.employee_name,r),n}catch(n){throw console.error("Error updating employee exit status:",n),n}}async function Gs(s){if(!s)return console.log("No Supabase client available - using local storage"),JSON.parse(localStorage.getItem("employee_exits")||"[]");try{const{data:t,error:r}=await s.from("employee_exits").select("*").order("created_at",{ascending:!1});if(r){if(r.code==="PGRST205")return console.log("Employee exits table does not exist"),[];throw r}return t||[]}catch(t){return console.error("Error fetching employee exits:",t),[]}}async function Yn(s){const t=await Gs(s);return{total:t.length,pending:t.filter(a=>a.status==="pending").length,approved:t.filter(a=>a.status==="approved").length,completed:t.filter(a=>a.status==="completed").length,thisMonth:t.filter(a=>{const n=new Date(a.created_at),l=new Date;return n.getMonth()===l.getMonth()&&n.getFullYear()===l.getFullYear()}).length}}const Qn={pending:"bg-gray-100 text-gray-800 border-gray-200",approved:"bg-gray-100 text-gray-800 border-gray-200",completed:"bg-gray-100 text-gray-800 border-gray-200"},Xn={pending:"‚è≥",approved:"‚úÖ",completed:"üéØ"};function Zn(){const s=Ne(),{notify:t}=pe(),{openModal:r,closeModal:a}=qe(),{refreshEmployees:n}=Tt(),[l,o]=i.useState([]),[c,d]=i.useState([]),[h,m]=i.useState(!0),[f,C]=i.useState({total:0,pending:0,approved:0,completed:0,thisMonth:0}),[x,N]=i.useState("all"),[M,S]=i.useState(""),[v,u]=i.useState(null),b=i.useCallback(async()=>{try{m(!0);const[p,k]=await Promise.all([Gs(s),Yn(s)]);o(p),C(k)}catch(p){console.error("Error loading exit records:",p),t("Failed to load exit records","error")}finally{m(!1)}},[s,t]);i.useEffect(()=>{b()},[b]),i.useEffect(()=>{let p=l;if(x!=="all"&&(p=p.filter(k=>k.status===x)),M){const k=M.toLowerCase();p=p.filter($=>$.employee_name.toLowerCase().includes(k)||$.department.toLowerCase().includes(k)||$.exit_reason.toLowerCase().includes(k))}d(p)},[l,x,M]);const E=i.useCallback(async(p,k,$="")=>{try{if(await Gn(s,p,k,$),k==="approved"||k==="completed"){const D=l.find(L=>L.id===p);if(D&&s){const R={status:k==="completed"?"Inactive":"Exiting",updated_at:new Date().toISOString()};(k==="completed"||new Date(D.last_working_day)<=new Date)&&(R.departure_date=D.last_working_day),await s.from("employees").update(R).eq("name",D.employee_name).eq("phone",D.employee_phone)}}await b(),n&&await n(),t(`Exit request ${k} successfully`,"success")}catch(D){console.error("Error updating exit status:",D),t("Failed to update exit status","error")}},[s,l,b,n,t]),y=i.useCallback(p=>{u(p),r({title:`Exit Details - ${p.employee_name}`,content:e.jsxs("div",{className:"space-y-6 max-h-96 overflow-y-auto",children:[e.jsx(be,{title:"Employee Information",icon:"üë§",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Name:"}),e.jsx("p",{className:"text-gray-900",children:p.employee_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Department:"}),e.jsx("p",{className:"text-gray-900",children:p.department})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Phone:"}),e.jsx("p",{className:"text-gray-900",children:p.employee_phone})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Role:"}),e.jsx("p",{className:"text-gray-900",children:Array.isArray(p.role)?p.role.join(", "):p.role})]})]})}),e.jsx(be,{title:"Exit Information",icon:"üìã",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Reason:"}),e.jsx("p",{className:"text-gray-900",children:p.exit_reason}),p.custom_reason&&e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:p.custom_reason})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Last Working Day:"}),e.jsx("p",{className:"text-gray-900",children:new Date(p.last_working_day).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Notice Period:"}),e.jsxs("p",{className:"text-gray-900",children:[p.notice_period," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Immediate Exit:"}),e.jsx("p",{className:"text-gray-900",children:p.immediate_exit?"Yes":"No"})]})]})}),p.overall_experience&&e.jsx(be,{title:"Exit Interview",icon:"üí¨",children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Overall Experience:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:p.overall_experience})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Reason for Leaving:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:p.reason_for_leaving})]}),p.improvement_suggestions&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Improvement Suggestions:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:p.improvement_suggestions})]}),p.would_recommend_company&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Would Recommend Company:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:p.would_recommend_company})]})]})}),e.jsxs(be,{title:"Asset Return",icon:"üíº",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${p.laptop_returned,"bg-gray-500"}`}),e.jsxs("span",{children:["Laptop: ",p.laptop_returned?"Returned":"Pending"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${p.access_cards_returned,"bg-gray-500"}`}),e.jsxs("span",{children:["Access Cards: ",p.access_cards_returned?"Returned":"Pending"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-2 h-2 rounded-full mr-2 ${p.documents_returned,"bg-gray-500"}`}),e.jsxs("span",{children:["Documents: ",p.documents_returned?"Returned":"Pending"]})]})]}),p.other_assets&&e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Other Assets:"}),e.jsx("p",{className:"text-gray-900 text-sm mt-1",children:p.other_assets})]})]}),p.handover_notes&&e.jsx(be,{title:"Handover",icon:"üîÑ",children:e.jsxs("div",{className:"space-y-3 text-sm",children:[p.handover_to&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Handover To:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:p.handover_to})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Handover Notes:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:p.handover_notes})]}),p.pending_tasks&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Pending Tasks:"}),e.jsx("p",{className:"text-gray-900 mt-1",children:p.pending_tasks})]})]})}),p.hr_notes&&e.jsx(be,{title:"HR Notes",icon:"üìù",children:e.jsx("p",{className:"text-gray-900 text-sm",children:p.hr_notes})})]}),actions:[{label:"Close",onClick:a,variant:"secondary"}]})},[r,a]),A=i.useCallback(p=>{r({title:"Approve Exit Request",content:e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-700 mb-4",children:["Are you sure you want to approve the exit request for ",e.jsx("strong",{children:p.employee_name}),"?"]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"This will:"}),e.jsxs("ul",{className:"text-sm text-gray-800 space-y-1",children:[e.jsx("li",{children:'‚Ä¢ Change employee status to "Exiting"'}),e.jsx("li",{children:"‚Ä¢ Initiate the handover process"}),e.jsx("li",{children:"‚Ä¢ Begin asset return coordination"}),e.jsxs("li",{children:["‚Ä¢ Set departure date: ",new Date(p.last_working_day).toLocaleDateString()]})]})]})]}),actions:[{label:"Cancel",onClick:a,variant:"secondary"},{label:"Approve",onClick:()=>{E(p.id,"approved"),a()},variant:"primary"}]})},[r,a,E]),j=i.useCallback(p=>{r({title:"Complete Exit Process",content:e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-700 mb-4",children:["Mark the exit process as completed for ",e.jsx("strong",{children:p.employee_name}),"?"]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"This will:"}),e.jsxs("ul",{className:"text-sm text-gray-800 space-y-1",children:[e.jsx("li",{children:'‚Ä¢ Change employee status to "Inactive"'}),e.jsx("li",{children:"‚Ä¢ Set final departure date"}),e.jsx("li",{children:"‚Ä¢ Complete the exit workflow"}),e.jsx("li",{children:"‚Ä¢ Archive the employee record"})]})]})]}),actions:[{label:"Cancel",onClick:a,variant:"secondary"},{label:"Complete",onClick:()=>{E(p.id,"completed"),a()},variant:"primary"}]})},[r,a,E]);return h?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading exit records..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx("span",{className:"text-lg",children:"üìä"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Exits"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.total})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx("span",{className:"text-lg",children:"‚è≥"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:f.pending})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx("span",{className:"text-lg",children:"‚úÖ"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:f.approved})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx("span",{className:"text-lg",children:"üéØ"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:f.completed})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx("span",{className:"text-lg",children:"üìÖ"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:f.thisMonth})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","pending","approved","completed"].map(p=>e.jsxs("button",{onClick:()=>N(p),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${x===p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[p==="all"?"All":p.charAt(0).toUpperCase()+p.slice(1),p!=="all"&&e.jsxs("span",{className:"ml-1 text-xs",children:["(",p==="pending"?f.pending:p==="approved"?f.approved:f.completed,")"]})]},p))}),e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx("input",{type:"text",placeholder:"Search by name, department, or reason...",value:M,onChange:p=>S(p.target.value),className:"w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg border overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Exit Records (",c.length,")"]})}),c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üìã"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No exit records found"}),e.jsx("p",{className:"text-gray-600",children:M||x!=="all"?"Try adjusting your filters or search terms":"No employee exit requests have been submitted yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Exit Reason"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Working Day"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:p.employee_name}),e.jsx("div",{className:"text-sm text-gray-500",children:p.employee_phone})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:p.department}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:p.exit_reason}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(p.last_working_day).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Qn[p.status]}`,children:[e.jsx("span",{className:"mr-1",children:Xn[p.status]}),p.status.charAt(0).toUpperCase()+p.status.slice(1)]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>y(p),className:"text-blue-600 hover:text-blue-900",children:"View"}),p.status==="pending"&&e.jsx("button",{onClick:()=>A(p),className:"text-green-600 hover:text-green-900",children:"Approve"}),p.status==="approved"&&e.jsx("button",{onClick:()=>j(p),className:"text-purple-600 hover:text-purple-900",children:"Complete"})]})]},p.id))})]})})]})]})}function el(){const{user:s,userRole:t}=qn(),{openModal:r,closeModal:a}=qe(),[n,l]=i.useState("overview"),o=()=>{r({title:"üöÄ Join Our Team",content:e.jsx(nr,{onClose:a,onSuccess:()=>{n==="hr-workflow"&&window.location.reload()}}),size:"large",showCloseButton:!0})},c=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Employee Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee signups and HR approval workflows"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üë•"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Employee Signup"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Submit an application to join our team"}),e.jsx("button",{onClick:o,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Apply Now"})]})}),(t==="manager"||t==="hr")&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìã"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"HR Approval Workflow"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Review and approve employee applications"}),e.jsx("button",{onClick:()=>l("hr-workflow"),className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Review Applications"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìñ"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Employee Directory"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"View all current employees"}),e.jsx("button",{onClick:()=>l("directory"),className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",children:"View Directory"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìù"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Employee Onboarding"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Complete onboarding form for new employees"}),e.jsx("button",{onClick:()=>window.location.hash="#/employee-onboarding",className:"w-full px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700",children:"Start Onboarding"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üí∞"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Employee Incentives"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Apply for hiring, testimonial, and promotional incentives"}),e.jsx("button",{onClick:()=>window.location.hash="#/employee-incentives",className:"w-full px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700",children:"Apply for Incentives"})]})}),(t==="manager"||t==="hr")&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üí∞"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"HR Incentive Approval"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Review and approve employee incentive applications"}),e.jsx("button",{onClick:()=>window.location.hash="#/hr-incentive-approval",className:"w-full px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700",children:"Review Incentives"})]})}),(t==="manager"||t==="hr")&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìä"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Incentive Reporting"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"View analytics and reports for employee incentives"}),e.jsx("button",{onClick:()=>window.location.hash="#/manager-incentive-reporting",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"View Reports"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üö™"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Exit Management"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Manage employee exits and offboarding"}),e.jsx("button",{onClick:()=>l("exit-workflow"),className:"w-full px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Manage Exits"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"New employee signup form created"}),e.jsx("span",{className:"text-gray-400",children:"‚Ä¢ Just now"})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"HR approval workflow implemented"}),e.jsx("span",{className:"text-gray-400",children:"‚Ä¢ Just now"})]}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-gray-600",children:"Employee management system enhanced"}),e.jsx("span",{className:"text-gray-400",children:"‚Ä¢ Just now"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"üìö How it Works"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"font-medium",children:"1."}),e.jsx("span",{children:"Candidates fill out the comprehensive signup form with personal, professional, and background information"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"font-medium",children:"2."}),e.jsx("span",{children:"HR team receives notifications and can review applications in the approval workflow"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"font-medium",children:"3."}),e.jsx("span",{children:"Applications can be approved (creating employee records) or rejected with feedback"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"font-medium",children:"4."}),e.jsx("span",{children:"Approved employees are automatically added to the employee directory and system"})]})]})]})]}),d=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Employee Directory"}),e.jsx("p",{className:"text-gray-600",children:"View all current employees"})]}),e.jsx("button",{onClick:()=>l("overview"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"‚Üê Back to Overview"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üë•"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Employee Directory"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The employee directory will be integrated with the existing employee management system."}),e.jsx("p",{className:"text-sm text-gray-500",children:"This will show all employees from the employees table, including those approved through the signup process."})]})})]});return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("nav",{className:"flex space-x-1 bg-white rounded-lg shadow-sm border border-gray-200 p-1",children:[e.jsx("button",{onClick:()=>l("overview"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="overview"?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"üìä Overview"}),(t==="manager"||t==="hr")&&e.jsx("button",{onClick:()=>l("hr-workflow"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="hr-workflow"?"bg-green-600 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"üìã HR Workflow"}),e.jsx("button",{onClick:()=>l("directory"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="directory"?"bg-purple-600 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"üìñ Directory"}),e.jsx("button",{onClick:()=>l("exit-workflow"),className:`flex-1 px-4 py-2 text-sm font-medium rounded-md transition-colors ${n==="exit-workflow"?"bg-red-600 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:"üö™ Exit Management"})]})}),n==="overview"&&c(),n==="hr-workflow"&&(t==="manager"||t==="hr")&&e.jsx(Kn,{}),n==="directory"&&d(),n==="exit-workflow"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Exit Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee exits and offboarding process"})]}),e.jsx("button",{onClick:()=>l("overview"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"‚Üê Back to Overview"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"üìù Employee Exit Form"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Employees can submit exit requests through this form. The form captures exit details, conducts exit interviews, and manages asset returns."}),e.jsx(ar,{})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"‚öôÔ∏è Exit Workflow Management"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"HR and managers can review, approve, and track employee exit requests. Monitor the complete exit process from submission to completion."}),e.jsx(Zn,{})]})]})]}),n==="hr-workflow"&&t!=="manager"&&t!=="hr"&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üîí"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Access Restricted"}),e.jsx("p",{className:"text-gray-600",children:"HR Approval Workflow is only available to managers and HR personnel."})]})})]})})}const tl=({employeeId:s=null,isManager:t=!1})=>{const{user:r,role:a}=He(),{notify:n}=pe(),{employees:l}=Le(),[o,c]=i.useState([]),[d,h]=i.useState(s||(r==null?void 0:r.id)),[m,f]=i.useState(null),[C,x]=i.useState({title:"",description:"",target:"",current:"",unit:"",category:"performance",priority:"medium",deadline:""}),[N,M]=i.useState(!1),S=[{value:"performance",label:"Performance",icon:"üìä"},{value:"productivity",label:"Productivity",icon:"‚ö°"},{value:"quality",label:"Quality",icon:"‚ú®"},{value:"learning",label:"Learning & Development",icon:"üìö"},{value:"collaboration",label:"Collaboration",icon:"ü§ù"},{value:"innovation",label:"Innovation",icon:"üí°"}],v=[{value:"low",label:"Low",color:"text-green-600"},{value:"medium",label:"Medium",color:"text-yellow-600"},{value:"high",label:"High",color:"text-orange-600"},{value:"critical",label:"Critical",color:"text-red-600"}];i.useEffect(()=>{u()},[d]);const u=()=>{c([{id:1,title:"Monthly Sales Target",description:"Achieve monthly sales target of $50,000",target:"50000",current:"35000",unit:"USD",category:"performance",priority:"high",deadline:"2024-02-29",progress:70,employeeId:d},{id:2,title:"Customer Satisfaction Score",description:"Maintain customer satisfaction above 4.5/5",target:"4.5",current:"4.2",unit:"rating",category:"quality",priority:"medium",deadline:"2024-03-15",progress:93,employeeId:d},{id:3,title:"Training Completion",description:"Complete 3 professional development courses",target:"3",current:"1",unit:"courses",category:"learning",priority:"medium",deadline:"2024-04-30",progress:33,employeeId:d}])},b=()=>{if(!C.title.trim()||!C.target.trim()){n({title:"Validation Error",message:"Please fill in title and target value",type:"error"});return}const j={id:Date.now(),...C,current:C.current||"0",progress:C.current&&C.target?Math.round(parseFloat(C.current)/parseFloat(C.target)*100):0,employeeId:d,createdAt:new Date().toISOString()};c(p=>[...p,j]),x({title:"",description:"",target:"",current:"",unit:"",category:"performance",priority:"medium",deadline:""}),n({title:"KPI Added",message:"New KPI has been successfully created",type:"success"})},E=j=>{c(p=>p.filter(k=>k.id!==j)),n({title:"KPI Deleted",message:"KPI has been removed",type:"success"})},y=j=>j>=90?"bg-green-500":j>=70?"bg-blue-500":j>=50?"bg-yellow-500":"bg-red-500",A=l.find(j=>j.id===d);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card-brand p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-brand-text",children:"KPI Management"}),e.jsx("p",{className:"text-brand-text-secondary mt-1",children:t?"Manage team KPIs and track performance":"Track your key performance indicators"})]}),t&&e.jsxs("select",{value:d,onChange:j=>h(j.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Employee"}),l.map(j=>e.jsxs("option",{value:j.id,children:[j.name," - ",j.role]},j.id))]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:o.length}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Total KPIs"})]}),e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-1",children:o.filter(j=>j.progress>=90).length}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"Achieved"})]}),e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 mb-1",children:o.filter(j=>j.progress>=50&&j.progress<90).length}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"In Progress"})]}),e.jsxs("div",{className:"card-brand p-6 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 mb-1",children:o.filter(j=>j.progress<50).length}),e.jsx("div",{className:"text-sm text-brand-text-secondary",children:"At Risk"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card-brand p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-text mb-4",children:"Add New KPI"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Title *"}),e.jsx("input",{type:"text",value:C.title,onChange:j=>x(p=>({...p,title:j.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter KPI title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Description"}),e.jsx("textarea",{value:C.description,onChange:j=>x(p=>({...p,description:j.target.value})),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe the KPI"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Target *"}),e.jsx("input",{type:"number",value:C.target,onChange:j=>x(p=>({...p,target:j.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Target value"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Current"}),e.jsx("input",{type:"number",value:C.current,onChange:j=>x(p=>({...p,current:j.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Current value"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Category"}),e.jsx("select",{value:C.category,onChange:j=>x(p=>({...p,category:j.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:S.map(j=>e.jsxs("option",{value:j.value,children:[j.icon," ",j.label]},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Priority"}),e.jsx("select",{value:C.priority,onChange:j=>x(p=>({...p,priority:j.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:v.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Unit"}),e.jsx("input",{type:"text",value:C.unit,onChange:j=>x(p=>({...p,unit:j.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., USD, %, hours"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Deadline"}),e.jsx("input",{type:"date",value:C.deadline,onChange:j=>x(p=>({...p,deadline:j.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsx("button",{onClick:b,className:"w-full btn-brand-primary",children:"Add KPI"})]})]}),e.jsxs("div",{className:"card-brand p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-brand-text mb-4",children:["Current KPIs ",A&&`- ${A.name}`]}),e.jsx("div",{className:"space-y-4",children:o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìä"}),e.jsx("p",{className:"text-brand-text-secondary",children:"No KPIs defined yet"})]}):o.map(j=>e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-brand-text",children:j.title}),e.jsx("p",{className:"text-sm text-brand-text-secondary mt-1",children:j.description})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>f(j.id),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>E(j.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Delete"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{children:["Progress: ",j.current,"/",j.target," ",j.unit]}),e.jsxs("span",{className:"font-medium",children:[j.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${y(j.progress)}`,style:{width:`${Math.min(j.progress,100)}%`}})})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-brand-text-secondary",children:[e.jsx("span",{className:`px-2 py-1 rounded-full ${j.priority==="critical"?"bg-red-100 text-red-800":j.priority==="high"?"bg-orange-100 text-orange-800":j.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:j.priority}),j.deadline&&e.jsxs("span",{children:["Due: ",new Date(j.deadline).toLocaleDateString()]})]})]},j.id))})]})]})]})},sl=q.memo(function({onViewReport:t,onEditEmployee:r,onEditReport:a}){var Ht,zt,Vt,qt,Bt,Wt,Kt,Jt,Gt;const n=Ne(),{notify:l}=pe(),{allSubmissions:o,loading:c,error:d,refreshSubmissions:h}=gt(),{submissions:m,refreshAllData:f,updateSubmission:C}=Le(),{openModal:x,closeModal:N}=qe(),{enhancedSubmissions:M,isEnhancedSyncActive:S}=Mn({refreshInterval:3e4}),v=S&&M.length>0?M:m.length>0?m:o,[u,b]=i.useState("controlPanel"),[E,y]=i.useState("all"),[A,j]=i.useState(""),[p,k]=i.useState({department:"All",performance:"All",status:"All"}),[$,D]=i.useState({key:"name",direction:"asc"}),[L,R]=i.useState(new Set),[F,Z]=i.useState({}),[G,ee]=i.useState("All"),[ie,he]=i.useState("All"),[de,ne]=i.useState(10),[re,le]=i.useState(!1),[W,ue]=i.useState({refreshing:!1,exporting:!1,savingEvaluation:!1,bulkOperations:!1}),[Q,Y]=i.useState({isOpen:!1,submission:null,score:8,comments:"",recommendations:"",testimonialUrl:""}),X=i.useMemo(()=>{if(!v.length)return{employees:[],stats:{},departments:[]};const g=E==="all"?v:v.filter(I=>I.monthKey===E),T={};g.forEach(I=>{var V,z,te,ae,oe;const O=`${(V=I.employee)==null?void 0:V.name}-${(z=I.employee)==null?void 0:z.phone}`;T[O]||(T[O]={name:((te=I.employee)==null?void 0:te.name)||"Unknown",phone:((ae=I.employee)==null?void 0:ae.phone)||"N/A",department:((oe=I.employee)==null?void 0:oe.department)||"Unknown",submissions:[],latestSubmission:null,averageScore:0,totalHours:0,performance:"Medium"}),T[O].submissions.push(I)});const P=Object.values(T).map(I=>{I.submissions.sort((V,z)=>z.monthKey.localeCompare(V.monthKey)),I.latestSubmission=I.submissions[0];const O=I.submissions.reduce((V,z)=>{var te;return V+(((te=z.scores)==null?void 0:te.overall)||0)},0);return I.averageScore=I.submissions.length?(O/I.submissions.length).toFixed(1):0,I.totalHours=I.submissions.reduce((V,z)=>V+(z.learning||[]).reduce((te,ae)=>te+(ae.durationMins||0),0)/60,0),I.performance=I.averageScore>=8?"High":I.averageScore>=6?"Medium":"Low",I.hasTestimonial=I.submissions.some(V=>{var z;return(z=V.manager)==null?void 0:z.testimonialUrl}),I});let H=P.filter(I=>{const O=!A||I.name.toLowerCase().includes(A.toLowerCase())||I.department.toLowerCase().includes(A.toLowerCase()),V=p.department==="All"||I.department===p.department,z=p.performance==="All"||I.performance===p.performance;return O&&V&&z});H.sort((I,O)=>{let V,z;switch($.key){case"name":V=I.name,z=O.name;break;case"score":V=parseFloat(I.averageScore),z=parseFloat(O.averageScore);break;case"department":V=I.department,z=O.department;break;case"hours":V=I.totalHours,z=O.totalHours;break;default:V=I.name,z=O.name}return $.direction==="desc"?typeof V=="string"?z.localeCompare(V):z-V:typeof V=="string"?V.localeCompare(z):V-z});const J={totalEmployees:P.length,totalSubmissions:g.length,averageScore:P.length?(P.reduce((I,O)=>I+parseFloat(O.averageScore),0)/P.length).toFixed(1):0,highPerformers:P.filter(I=>I.performance==="High").length,needsAttention:P.filter(I=>I.performance==="Low").length,withPenalties:P.filter(I=>{var O,V;return((V=(O=I.latestSubmission)==null?void 0:O.discipline)==null?void 0:V.penalty)>0}).length,missingLearning:P.filter(I=>{const O=I.latestSubmission;return O?(O.learning||[]).reduce((z,te)=>z+(te.durationMins||0),0)/60<de:!1}).length},B=[...new Set(P.map(I=>I.department))].sort();return{employees:H,stats:J,departments:B,allEmployees:P}},[v,E,A,p,$,de]),we=i.useMemo(()=>{try{const g=new Set;return(X.employees||[]).forEach(T=>{const P=T.latestSubmission;((P==null?void 0:P.clients)||[]).forEach(H=>(H.services||[]).forEach(J=>{const B=typeof J=="string"?J:J.service;B&&g.add(B)}))}),["All",...Array.from(g).sort()]}catch{return["All"]}},[X]),w=g=>{var T,P,H,J,B,I,O,V,z,te,ae,oe;Y({isOpen:!0,submission:g,score:((T=g.manager)==null?void 0:T.score)||8,comments:((P=g.manager)==null?void 0:P.comments)||"",recommendations:((H=g.manager)==null?void 0:H.recommendations)||"",testimonialUrl:((J=g.manager)==null?void 0:J.testimonialUrl)||"",rubrics:{collaboration:((I=(B=g.manager)==null?void 0:B.rubrics)==null?void 0:I.collaboration)||7,ownership:((V=(O=g.manager)==null?void 0:O.rubrics)==null?void 0:V.ownership)||7,quality:((te=(z=g.manager)==null?void 0:z.rubrics)==null?void 0:te.quality)||7,communication:((oe=(ae=g.manager)==null?void 0:ae.rubrics)==null?void 0:oe.communication)||7}})},_=async()=>{var g,T,P,H;if(!(!Q.submission||!n||W.savingEvaluation)){ue(J=>({...J,savingEvaluation:!0}));try{console.log("Saving employee evaluation...");const J={...Q.submission,manager:{score:Q.score,comments:Q.comments,recommendations:Q.recommendations,testimonialUrl:Q.testimonialUrl,rubrics:{collaboration:Number(((g=Q.rubrics)==null?void 0:g.collaboration)||0),ownership:Number(((T=Q.rubrics)==null?void 0:T.ownership)||0),quality:Number(((P=Q.rubrics)==null?void 0:P.quality)||0),communication:Number(((H=Q.rubrics)==null?void 0:H.communication)||0)},evaluatedAt:new Date().toISOString(),evaluatedBy:"Manager"}},{error:B}=await n.from("submissions").update(J).eq("id",Q.submission.id);if(B)throw B;console.log("Refreshing submissions data..."),await C(J),await h(),Y({isOpen:!1,submission:null,score:8,comments:"",recommendations:""}),console.log("Evaluation saved successfully"),l({type:"success",title:"Evaluation saved",message:"Manager evaluation updated."}),x("Success","Employee evaluation saved successfully!",N)}catch(J){console.error("Failed to save evaluation:",J),l({type:"error",title:"Save failed",message:J.message}),x("Error","Failed to save evaluation. Please try again.",N)}finally{ue(J=>({...J,savingEvaluation:!1}))}}},U=async()=>{if(!W.refreshing){ue(g=>({...g,refreshing:!0}));try{console.log("Refreshing dashboard data..."),await Promise.all([f(),h()]),console.log("Dashboard data refreshed successfully")}catch(g){console.error("Failed to refresh data:",g),x("Error","Failed to refresh data. Please try again.",N)}finally{ue(g=>({...g,refreshing:!1}))}}},K=async()=>{if(!W.exporting){ue(g=>({...g,exporting:!0}));try{console.log("Exporting bulk data...");const T=[["Employee Name","Department","Phone","Average Score","Total Hours","Performance","Latest Month","Reports Count"],...X.employees.map(B=>{var I;return[B.name,B.department,B.phone,B.averageScore,B.totalHours.toFixed(1),B.performance,((I=B.latestSubmission)==null?void 0:I.monthKey)||"N/A",B.submissions.length]})].map(B=>B.join(",")).join(`
`),P=new Blob([T],{type:"text/csv;charset=utf-8;"}),H=document.createElement("a"),J=URL.createObjectURL(P);H.setAttribute("href",J),H.setAttribute("download",`employee-performance-${new Date().toISOString().split("T")[0]}.csv`),H.style.visibility="hidden",document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(J),console.log("Data exported successfully"),x("Success","Employee data exported successfully!",N)}catch(g){console.error("Failed to export data:",g),x("Error","Failed to export data. Please try again.",N)}finally{ue(g=>({...g,exporting:!1}))}}},xe=g=>{const T=g.submissions,P=g.name;if(!T||T.length===0){x("No Data",`No submissions found for ${P}`,N);return}const H=`
<!DOCTYPE html>
<html>
<head>
    <title>Performance Report - ${P}</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; margin: 0; padding: 20px; line-height: 1.6; color: #1f2937; }
        .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #3b82f6; }
        .header h1 { color: #3b82f6; margin: 0; font-size: 28px; }
        .header h2 { color: #374151; margin: 10px 0; font-size: 24px; }
        .header .meta { color: #6b7280; font-size: 14px; }
        .section { margin: 30px 0; page-break-inside: avoid; }
        .section h3 { color: #374151; border-left: 4px solid #3b82f6; padding-left: 12px; margin-bottom: 15px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; text-align: center; }
        .stat-value { font-size: 32px; font-weight: bold; color: #3b82f6; margin-bottom: 5px; }
        .stat-label { font-size: 14px; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; }
        .performance-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .performance-table th, .performance-table td { border: 1px solid #d1d5db; padding: 12px; text-align: left; }
        .performance-table th { background: #3b82f6; color: white; font-weight: 600; }
        .score-good { color: #059669; font-weight: bold; }
        .score-medium { color: #d97706; font-weight: bold; }
        .score-poor { color: #dc2626; font-weight: bold; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center; color: #6b7280; font-size: 12px; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>
    <div class="header">
        <h1>Branding Pioneers</h1>
        <h2>Employee Performance Report</h2>
        <h2>${P}</h2>
        <div class="meta">
            Department: ${g.department} | Generated: ${new Date().toLocaleDateString()}
        </div>
    </div>

    <div class="section">
        <h3>Performance Summary</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">${g.averageScore}/10</div>
                <div class="stat-label">Average Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${T.length}</div>
                <div class="stat-label">Reports Submitted</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${g.totalHours.toFixed(1)}h</div>
                <div class="stat-label">Total Learning</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${g.performance}</div>
                <div class="stat-label">Performance Level</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Monthly Performance</h3>
        <table class="performance-table">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Overall Score</th>
                    <th>KPI Score</th>
                    <th>Learning Score</th>
                    <th>Learning Hours</th>
                    <th>Manager Notes</th>
                </tr>
            </thead>
            <tbody>
                ${T.map(O=>{var te,ae,oe,Ze,Yt,Qt;const V=((O.learning||[]).reduce((Qs,Xs)=>Qs+(Xs.durationMins||0),0)/60).toFixed(1),z=((te=O.scores)==null?void 0:te.overall)>=8?"score-good":((ae=O.scores)==null?void 0:ae.overall)>=6?"score-medium":"score-poor";return`
                        <tr>
                            <td><strong>${monthLabel(O.monthKey)}</strong></td>
                            <td class="${z}">${((oe=O.scores)==null?void 0:oe.overall)||"N/A"}/10</td>
                            <td>${((Ze=O.scores)==null?void 0:Ze.kpiScore)||"N/A"}/10</td>
                            <td>${((Yt=O.scores)==null?void 0:Yt.learningScore)||"N/A"}/10</td>
                            <td>${V}h</td>
                            <td>${((Qt=O.manager)==null?void 0:Qt.comments)||"No comments"}</td>
                        </tr>
                    `}).join("")}
            </tbody>
        </table>
    </div>

    <div class="footer">
        <p>This report was generated by the Branding Pioneers Monthly Tactical System</p>
        <p>For questions about this report, contact your HR department</p>
    </div>
</body>
</html>
    `,J=new Blob([H],{type:"text/html"}),B=URL.createObjectURL(J),I=document.createElement("a");I.href=B,I.download=`${P.replace(/\s+/g,"_")}_Performance_Report_${new Date().toISOString().split("T")[0]}.html`,I.click(),URL.revokeObjectURL(B)},Be=async g=>{if(W.bulkOperations)return;if(console.log("Opening Report View for:",g.name),!g.submissions||g.submissions.length===0){x("No Data",`No submissions found for ${g.name}`,N);return}const T=g.phone&&g.phone!=="N/A"?g.phone:"no-phone";console.log("Using phone number:",T),console.log("Submissions count:",g.submissions.length),ue(P=>({...P,bulkOperations:!0}));try{t(g.name,T),await new Promise(P=>setTimeout(P,100))}catch(P){console.error("Failed to open report view:",P),x("Error","Failed to open report view. Please try again.",N)}finally{setTimeout(()=>{ue(P=>({...P,bulkOperations:!1}))},500)}},ft=g=>{if(console.log("Opening Full Report for:",g.name),!g.submissions||g.submissions.length===0){x("No Data",`No submissions found for ${g.name}`,N);return}const T=g.phone&&g.phone!=="N/A"?g.phone:"no-phone";console.log("Using phone number:",T),console.log("Submissions count:",g.submissions.length),t(g.name,T)},Ys=async g=>{if(!W.bulkOperations){if(console.log("Opening Report Editor for:",g.name),!g.latestSubmission){x("No Data",`No submissions found for ${g.name}`,N);return}ue(T=>({...T,bulkOperations:!0}));try{a(g.name,g.phone,g.latestSubmission),await new Promise(T=>setTimeout(T,100))}catch(T){console.error("Failed to open report editor:",T),x("Error","Failed to open report editor. Please try again.",N)}finally{setTimeout(()=>{ue(T=>({...T,bulkOperations:!1}))},500)}}};return c?e.jsx(ss,{show:!0,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(vn,{size:"xl",showText:!0,text:"Loading team data..."})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(st,{}),e.jsx(st,{}),e.jsx(st,{}),e.jsx(st,{})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsx(jn,{rows:8,columns:6})})]})}):d?e.jsx(ss,{show:!0,children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"text-red-600 text-lg mb-2",children:"Error Loading Data"}),e.jsx("div",{className:"text-red-700 mb-4",children:d}),e.jsx(dn,{onClick:U,disabled:W.refreshing,variant:"danger",loading:W.refreshing,loadingText:"Retrying...",children:"Try Again"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Manager Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Monitor team performance and manage evaluations"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{onClick:U,disabled:W.refreshing,className:"flex items-center gap-2 px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed disabled:text-gray-400 transition-colors",children:[W.refreshing?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full"}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),W.refreshing?"Refreshing...":"Refresh"]}),e.jsxs("button",{onClick:K,disabled:W.exporting,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed transition-colors",children:[W.exporting?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),W.exporting?"Exporting...":"Export CSV"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border",children:e.jsx("div",{className:"px-6 py-0",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>b("controlPanel"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="controlPanel"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Control Panel"}),e.jsx("button",{onClick:()=>b("dashboard"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="dashboard"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Employee Dashboard"}),e.jsx("button",{onClick:()=>b("clients"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="clients"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Client Management"}),e.jsx("button",{onClick:()=>b("clientDashboard"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="clientDashboard"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Client Progress"}),e.jsx("button",{onClick:()=>b("leaderboard"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="leaderboard"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Leaderboard"}),e.jsx("button",{onClick:()=>b("hrManagement"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="hrManagement"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"HR Management"}),e.jsx("button",{onClick:()=>b("kpiEditor"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${u==="kpiEditor"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"KPI Editor"})]})})}),u==="dashboard"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-blue-100",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:X.stats.totalEmployees})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-green-100",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"High Performers"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:X.stats.highPerformers})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-yellow-100",children:e.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Needs Attention"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:X.stats.needsAttention})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-full bg-purple-100",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Avg Team Score"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[X.stats.averageScore,"/10"]})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"Search employees, departments...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:A,onChange:g=>j(g.target.value),autoComplete:"off"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("select",{value:p.department,onChange:g=>k(T=>({...T,department:g.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"All",children:"All Departments"}),X.departments.map(g=>e.jsx("option",{value:g,children:g},g))]}),e.jsxs("select",{value:p.performance,onChange:g=>k(T=>({...T,performance:g.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"All",children:"All Performance"}),e.jsx("option",{value:"High",children:"High Performers"}),e.jsx("option",{value:"Medium",children:"Medium Performers"}),e.jsx("option",{value:"Low",children:"Needs Attention"})]}),e.jsxs("select",{value:E,onChange:g=>y(g.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Months"}),(()=>{const g=new Set;return o.forEach(T=>{T.monthKey&&g.add(T.monthKey)}),Array.from(g).sort((T,P)=>P.localeCompare(T)).map(T=>e.jsx("option",{value:T,children:new Date(T+"-01").toLocaleDateString("en-US",{year:"numeric",month:"long"})},T))})()]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Team Overview (",X.employees.length," employees)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Sort by:"}),e.jsxs("select",{value:$.key,onChange:g=>D(T=>({...T,key:g.target.value})),className:"text-sm border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"score",children:"Score"}),e.jsx("option",{value:"department",children:"Department"}),e.jsx("option",{value:"hours",children:"Learning Hours"})]}),e.jsx("button",{onClick:()=>D(g=>({...g,direction:g.direction==="asc"?"desc":"asc"})),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx("svg",{className:`w-4 h-4 transform ${$.direction==="desc"?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const g={};(X.employees||[]).forEach(T=>{g[`${T.name}-${T.phone}`]=!0}),Z(g)},className:"text-xs px-2 py-1 border rounded hover:bg-gray-50",children:"Expand All"}),e.jsx("button",{onClick:()=>Z({}),className:"text-xs px-2 py-1 border rounded hover:bg-gray-50",children:"Collapse All"})]})]})}),e.jsxs("div",{className:"px-6 py-3 border-b border-gray-100 bg-gray-50 flex flex-wrap gap-2 text-xs",children:[e.jsxs("span",{className:"px-2 py-1 rounded-full bg-blue-100 text-blue-800",children:["Avg Score: ",X.stats.averageScore]}),e.jsxs("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-800",children:["High Perf: ",X.stats.highPerformers]}),e.jsxs("span",{className:"px-2 py-1 rounded-full bg-yellow-100 text-yellow-800",children:["Needs Attention: ",X.stats.needsAttention]}),e.jsxs("span",{className:"px-2 py-1 rounded-full bg-red-100 text-red-800",children:["Penalties: ",X.stats.withPenalties]}),e.jsxs("span",{className:"px-2 py-1 rounded-full bg-purple-100 text-purple-800",children:[e.jsxs("span",{className:"hidden sm:inline",children:["Missing Learning (<",de,"h): "]}),X.stats.missingLearning]})]}),X.employees.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"Users"}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mb-2",children:"No employees found"}),e.jsx("div",{className:"text-gray-500",children:"Try adjusting your filters or search query"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Performance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Avg Score"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Learning Hours"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reports"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X.employees.map((g,T)=>{var P,H,J,B,I;return e.jsxs(q.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:g.name}),e.jsx("div",{className:"text-sm text-gray-500",children:g.phone})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:g.department})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g.performance==="High"?"bg-green-100 text-green-800":g.performance==="Medium"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:g.performance})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:`text-lg font-semibold ${g.averageScore>=8?"text-green-600":g.averageScore>=6?"text-yellow-600":"text-red-600"}`,children:[g.averageScore,"/10"]}),((H=(P=g.latestSubmission)==null?void 0:P.discipline)==null?void 0:H.penalty)>0&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Penalty: -",g.latestSubmission.discipline.penalty," ‚Ä¢ ",g.latestSubmission.discipline.lateDays," day(s) late"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[g.totalHours.toFixed(1),"h"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:g.submissions.length}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Z(O=>({...O,[`${g.name}-${g.phone}`]:!O[`${g.name}-${g.phone}`]})),className:"text-gray-600 hover:text-gray-900 hover:bg-gray-50 px-3 py-1 rounded",children:F[`${g.name}-${g.phone}`]?"Hide":"Progress"}),e.jsxs("button",{onClick:()=>Be(g),disabled:W.bulkOperations,className:"text-blue-600 hover:text-blue-900 hover:bg-blue-50 disabled:text-blue-300 disabled:bg-gray-50 disabled:cursor-not-allowed px-3 py-1 rounded transition-colors flex items-center gap-1",children:[W.bulkOperations?e.jsx("div",{className:"animate-spin w-3 h-3 border border-blue-300 border-t-transparent rounded-full"}):null,"View Report"]}),e.jsx("button",{onClick:()=>ft(g),className:"text-blue-600 hover:text-blue-900 hover:bg-blue-50 px-3 py-1 rounded transition-colors",children:"Full Report"}),e.jsx("button",{onClick:()=>xe(g),className:"text-green-600 hover:text-green-900 hover:bg-green-50 px-3 py-1 rounded transition-colors",children:"Download PDF"}),e.jsx("button",{onClick:()=>{W.bulkOperations||(ue(O=>({...O,bulkOperations:!0})),r(g.name,g.phone),setTimeout(()=>{ue(O=>({...O,bulkOperations:!1}))},500))},disabled:W.bulkOperations,className:"text-orange-600 hover:text-orange-900 hover:bg-orange-50 disabled:text-orange-300 disabled:bg-gray-50 disabled:cursor-not-allowed px-3 py-1 rounded transition-colors",children:"Edit Employee"}),g.latestSubmission&&e.jsxs("button",{onClick:()=>Ys(g),disabled:W.bulkOperations,className:"text-indigo-600 hover:text-indigo-900 hover:bg-indigo-50 disabled:text-indigo-300 disabled:bg-gray-50 disabled:cursor-not-allowed px-3 py-1 rounded transition-colors flex items-center gap-1",children:[W.bulkOperations?e.jsx("div",{className:"animate-spin w-3 h-3 border border-indigo-300 border-t-transparent rounded-full"}):null,"Edit Report"]}),g.latestSubmission&&e.jsx("button",{onClick:()=>w(g.latestSubmission),className:"text-purple-600 hover:text-purple-900 hover:bg-purple-50 px-3 py-1 rounded transition-colors",children:"Evaluate"}),((B=(J=g.latestSubmission)==null?void 0:J.manager)==null?void 0:B.testimonialUrl)&&e.jsx("a",{href:g.latestSubmission.manager.testimonialUrl,target:"_blank",rel:"noreferrer",className:"text-xs text-purple-700 underline",children:"Testimonial"})]})})]}),F[`${g.name}-${g.phone}`]&&e.jsx("tr",{className:"bg-gray-50/50",children:e.jsx("td",{colSpan:7,className:"px-6 py-4",children:(I=g.latestSubmission)!=null&&I.clients&&g.latestSubmission.clients.length>0?e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:g.latestSubmission.clients.map((O,V)=>e.jsxs("div",{className:"border rounded-lg p-3 bg-white",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:O.name}),Array.isArray(O.services)&&O.services.length>0?e.jsx("div",{className:"space-y-2",children:O.services.map((z,te)=>{const ae=typeof z=="string"?z:z.service,oe=Me(O,ae,{monthKey:g.latestSubmission.monthKey})||0,Ze=Ws(ae);return e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"flex justify-between mb-0.5",children:[e.jsxs("span",{className:"font-medium",children:[ae," ",e.jsxs("span",{className:"text-gray-500",children:["(w ",Ze,")"]})]}),e.jsxs("span",{children:[oe,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 h-1.5 rounded-full",children:e.jsx("div",{className:`${oe>=100?"bg-green-500":oe>=60?"bg-yellow-500":"bg-red-500"} h-1.5 rounded-full`,style:{width:`${oe}%`}})})]},te)})}):e.jsx("div",{className:"text-xs text-gray-500",children:"No services scoped"})]},V))}):e.jsx("div",{className:"text-sm text-gray-600",children:"No client data in latest submission."})})})]},`${g.name}-${g.phone}`)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Underperforming Scopes"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Period: ",E==="all"?"All":new Date(E+"-01").toLocaleString(void 0,{month:"long",year:"numeric"})]}),e.jsx("select",{className:"text-xs border rounded px-2 py-1",value:G,onChange:g=>ee(g.target.value),children:we.map(g=>e.jsx("option",{children:g},g))}),e.jsx("select",{className:"text-xs border rounded px-2 py-1",value:ie,onChange:g=>he(g.target.value),children:["All",...X.departments||[]].map(g=>e.jsx("option",{children:g},g))})]})]}),(()=>{try{const g=[];(X.employees||[]).forEach(P=>{if(ie!=="All"&&P.department!==ie)return;const H=P.latestSubmission;!H||!H.clients||H.clients.forEach(J=>{(J.services||[]).forEach(B=>{const I=typeof B=="string"?B:B.service,O=Me(J,I,{monthKey:H.monthKey})||0;O<60&&(G==="All"||I===G)&&g.push({employee:P.name,client:J.name,service:I,pct:O})})})});const T=g.sort((P,H)=>P.pct-H.pct).slice(0,10);return T.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No underperforming scopes found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Employee"}),e.jsx("th",{className:"py-2 pr-4",children:"Client"}),e.jsx("th",{className:"py-2 pr-4",children:"Service"}),e.jsx("th",{className:"py-2 pr-4",children:"Progress"})]})}),e.jsx("tbody",{children:T.map((P,H)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-2 pr-4",children:P.employee}),e.jsx("td",{className:"py-2 pr-4",children:P.client}),e.jsx("td",{className:"py-2 pr-4",children:P.service}),e.jsxs("td",{className:"py-2 pr-4",children:[e.jsx("div",{className:"w-24 sm:w-32 md:w-40 bg-gray-200 h-2 rounded-full",children:e.jsx("div",{className:`${P.pct>=100?"bg-green-500":P.pct>=60?"bg-yellow-500":"bg-red-500"} h-2 rounded-full`,style:{width:`${Math.max(0,Math.min(100,P.pct))}%`}})}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:[P.pct,"%"]})]})]},`${P.employee}-${P.client}-${P.service}-${H}`))})]})})}catch{return e.jsx("div",{className:"text-sm text-gray-600",children:"Unable to compute scope analytics."})}})()]})]}),u==="clients"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:"üë•"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Client Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add and manage clients for your team"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>le(!re),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:re?"Cancel":"+ Add New Client"}),e.jsx("button",{onClick:()=>window.location.hash="#/client-onboarding",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"üìã Client Onboarding"})]})]}),re&&e.jsx("div",{className:"mt-4 border-t pt-4",children:e.jsx(tr,{onSuccess:()=>{le(!1),l("Client added successfully!","success")},onCancel:()=>le(!1)})})]}),e.jsx(On,{})]}),u==="clientDashboard"&&e.jsx(sr,{}),u==="leaderboard"&&e.jsx(Un,{allSubmissions:o}),u==="hrManagement"&&e.jsx(el,{}),u==="kpiEditor"&&e.jsx(tl,{submissions:v,onKPIUpdate:(g,T)=>{h(),l("KPIs updated successfully!","success")}}),u==="controlPanel"&&e.jsx(Js,{}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Top Improving Scopes"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Compared to previous month"})]}),(()=>{try{const g=[];(X.employees||[]).forEach(P=>{const H=(P.submissions||[]).sort((I,O)=>O.monthKey.localeCompare(I.monthKey));if(H.length<2)return;const J=H[0],B=H[1];(J.clients||[]).forEach(I=>{const O=(B.clients||[]).find(V=>V.name===I.name);O&&(I.services||[]).forEach(V=>{const z=typeof V=="string"?V:V.service,te=Me(I,z,{monthKey:J.monthKey})||0,ae=Me(O,z,{monthKey:B.monthKey})||0,oe=te-ae;oe>0&&g.push({employee:P.name,client:I.name,service:z,delta:oe,nowPct:te,prevPct:ae})})})});const T=g.sort((P,H)=>H.delta-P.delta).slice(0,10);return T.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No significant improvements detected."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Employee"}),e.jsx("th",{className:"py-2 pr-4",children:"Client"}),e.jsx("th",{className:"py-2 pr-4",children:"Service"}),e.jsx("th",{className:"py-2 pr-4",children:"Œî%"})]})}),e.jsx("tbody",{children:T.map((P,H)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-2 pr-4",children:P.employee}),e.jsx("td",{className:"py-2 pr-4",children:P.client}),e.jsx("td",{className:"py-2 pr-4",children:P.service}),e.jsxs("td",{className:"py-2 pr-4 text-green-700 font-semibold",children:["+",Math.round(P.delta),"%"]})]},`${P.employee}-${P.client}-${P.service}-${H}`))})]})})}catch{return e.jsx("div",{className:"text-sm text-gray-600",children:"Unable to compute improvements."})}})()]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Top Improving Clients"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Average service improvement"})]}),(()=>{try{const g=[];(X.employees||[]).forEach(P=>{const H=(P.submissions||[]).sort((I,O)=>O.monthKey.localeCompare(I.monthKey));if(H.length<2)return;const J=H[0],B=H[1];(J.clients||[]).forEach(I=>{const O=(B.clients||[]).find(z=>z.name===I.name);if(!O)return;let V=[];if((I.services||[]).forEach(z=>{const te=typeof z=="string"?z:z.service,ae=Me(I,te,{monthKey:J.monthKey})||0,oe=Me(O,te,{monthKey:B.monthKey})||0;V.push(ae-oe)}),V.length){const z=V.reduce((te,ae)=>te+ae,0)/V.length;z>0&&g.push({employee:P.name,client:I.name,delta:z})}})});const T=g.sort((P,H)=>H.delta-P.delta).slice(0,10);return T.length===0?e.jsx("div",{className:"text-sm text-gray-600",children:"No significant improvements detected."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Employee"}),e.jsx("th",{className:"py-2 pr-4",children:"Client"}),e.jsx("th",{className:"py-2 pr-4",children:"Œî%"})]})}),e.jsx("tbody",{children:T.map((P,H)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-2 pr-4",children:P.employee}),e.jsx("td",{className:"py-2 pr-4",children:P.client}),e.jsxs("td",{className:"py-2 pr-4 text-green-700 font-semibold",children:["+",Math.round(P.delta),"%"]})]},`${P.employee}-${P.client}-${H}`))})]})})}catch{return e.jsx("div",{className:"text-sm text-gray-600",children:"Unable to compute improvements."})}})()]}),Q.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-xs sm:max-w-md md:max-w-lg lg:max-w-2xl max-h-[95vh] sm:max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"px-3 sm:px-6 py-3 sm:py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Evaluate: ",(zt=(Ht=Q.submission)==null?void 0:Ht.employee)==null?void 0:zt.name]}),e.jsx("button",{onClick:()=>Y(g=>({...g,isOpen:!1})),className:"text-gray-400 hover:text-gray-500",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"px-3 sm:px-6 py-3 sm:py-4 space-y-4 sm:space-y-6",children:[((qt=(Vt=Q.submission)==null?void 0:Vt.discipline)==null?void 0:qt.penalty)>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm text-yellow-800",children:["Late submission penalty applied: -",Q.submission.discipline.penalty," (late by ",Q.submission.discipline.lateDays," day(s))."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Testimonial URL (optional)"}),e.jsx("input",{type:"url",value:Q.testimonialUrl,onChange:g=>Y(T=>({...T,testimonialUrl:g.target.value})),placeholder:"https://... (video/review link)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add a link to a client testimonial or video to award recognition."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rubric Ratings (1-10)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Collaboration"}),e.jsx("input",{type:"number",min:"1",max:"10",value:((Bt=Q.rubrics)==null?void 0:Bt.collaboration)||0,onChange:g=>Y(T=>({...T,rubrics:{...T.rubrics,collaboration:parseInt(g.target.value)||0}})),className:"w-full px-3 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Ownership"}),e.jsx("input",{type:"number",min:"1",max:"10",value:((Wt=Q.rubrics)==null?void 0:Wt.ownership)||0,onChange:g=>Y(T=>({...T,rubrics:{...T.rubrics,ownership:parseInt(g.target.value)||0}})),className:"w-full px-3 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Quality"}),e.jsx("input",{type:"number",min:"1",max:"10",value:((Kt=Q.rubrics)==null?void 0:Kt.quality)||0,onChange:g=>Y(T=>({...T,rubrics:{...T.rubrics,quality:parseInt(g.target.value)||0}})),className:"w-full px-3 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Communication"}),e.jsx("input",{type:"number",min:"1",max:"10",value:((Jt=Q.rubrics)==null?void 0:Jt.communication)||0,onChange:g=>Y(T=>({...T,rubrics:{...T.rubrics,communication:parseInt(g.target.value)||0}})),className:"w-full px-3 py-2 border rounded-lg"})]})]})]}),((Gt=Q.submission)==null?void 0:Gt.clients)&&Q.submission.clients.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Client Scope Progress (Submission Month)"}),e.jsx("div",{className:"space-y-3",children:Q.submission.clients.map((g,T)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:g.name}),Array.isArray(g.services)&&g.services.length>0?e.jsx("div",{className:"space-y-2",children:g.services.map((P,H)=>{const J=typeof P=="string"?P:P.service,B=Me(g,J,{monthKey:Q.submission.monthKey})||0;return e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"flex justify-between mb-0.5",children:[e.jsx("span",{className:"font-medium",children:J}),e.jsxs("span",{children:[B,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 h-1.5 rounded-full",children:e.jsx("div",{className:`${B>=100?"bg-green-500":B>=60?"bg-yellow-500":"bg-red-500"} h-1.5 rounded-full`,style:{width:`${B}%`}})})]},H)})}):e.jsx("div",{className:"text-xs text-gray-500",children:"No services scoped"})]},T))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager Score (1-10)"}),e.jsx("input",{type:"number",min:"1",max:"10",value:Q.score,onChange:g=>Y(T=>({...T,score:parseInt(g.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comments"}),e.jsx("textarea",{rows:4,value:Q.comments,onChange:g=>Y(T=>({...T,comments:g.target.value})),placeholder:"Add your feedback about the employee's performance...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Recommendations"}),e.jsx("textarea",{rows:3,value:Q.recommendations,onChange:g=>Y(T=>({...T,recommendations:g.target.value})),placeholder:"Provide recommendations for improvement...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>Y(g=>({...g,isOpen:!1})),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:_,disabled:!n||W.savingEvaluation,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[W.savingEvaluation&&e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),W.savingEvaluation?"Saving...":"Save Evaluation"]})]})]})})]})}),Ll=Object.freeze(Object.defineProperty({__proto__:null,ManagerDashboard:sl},Symbol.toStringTag,{value:"Module"}));function rl({employee:s,onBack:t}){const r=Ne(),{allSubmissions:a,refreshSubmissions:n}=gt(),{openModal:l,closeModal:o}=qe(),{notify:c}=pe(),[d,h]=i.useState(null),[m,f]=i.useState(""),[C,x]=i.useState(!1),N=i.useMemo(()=>a.filter(u=>{var b,E;return((b=u.employee)==null?void 0:b.name)===s.name&&((E=u.employee)==null?void 0:E.phone)===s.phone&&!u.isDraft}).sort((u,b)=>b.monthKey.localeCompare(u.monthKey)),[a,s]),M=u=>{h(u),f(u.manager_remarks||""),x(!0)},S=async()=>{if(!(!d||!r))try{const{error:u}=await r.from("submissions").update({manager_remarks:m,manager_edited_at:new Date().toISOString(),manager_edited_by:"Manager"}).eq("id",d.id);if(u)throw u;c({type:"success",title:"Saved",message:"Manager remarks updated."}),l("Success","Manager remarks saved successfully!",()=>{o(),x(!1),h(null),n()})}catch(u){c({type:"error",title:"Save failed",message:u.message}),l("Error",`Failed to save remarks: ${u.message}`,o)}},v=async u=>{r&&l("Confirm Delete",`Are you sure you want to delete ${s.name}'s submission for ${Nt(u.monthKey)}? This action cannot be undone.`,async()=>{try{const{error:b}=await r.from("submissions").delete().eq("id",u.id);if(b)throw b;c({type:"success",title:"Deleted",message:"Submission removed."}),l("Success","Submission deleted successfully!",()=>{o(),n()})}catch(b){c({type:"error",title:"Delete failed",message:b.message}),l("Error",`Failed to delete submission: ${b.message}`,o)}},o)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Edit Employee Data"}),e.jsxs("p",{className:"text-gray-600",children:[s.name," - ",s.phone]})]}),e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"‚Üê Back to Dashboard"})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4 sm:p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Employee Submissions"}),N.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìä"}),e.jsx("p",{className:"text-gray-600",children:"No completed submissions found for this employee."})]}):e.jsx("div",{className:"space-y-4",children:N.map((u,b)=>{var E,y;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:Nt(u.monthKey)}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Score: ",((y=(E=u.scores)==null?void 0:E.overall)==null?void 0:y.toFixed(1))||"N/A","/10 ‚Ä¢ Submitted: ",new Date(u.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(u),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"‚úèÔ∏è Edit Remarks"}),e.jsx("button",{onClick:()=>v(u),className:"px-3 py-1 text-sm bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"üóëÔ∏è Delete"})]})]}),u.manager_remarks&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mt-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-800 mb-1",children:"Manager Remarks:"}),e.jsx("p",{className:"text-sm text-blue-700 whitespace-pre-wrap",children:u.manager_remarks}),u.manager_edited_at&&e.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:["Last edited: ",new Date(u.manager_edited_at).toLocaleString()]})]})]},u.id||b)})})]}),C&&d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-xs sm:max-w-md md:max-w-lg lg:max-w-2xl p-3 sm:p-6 max-h-[95vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Edit Remarks - ",Nt(d.monthKey)]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager Remarks"}),e.jsx("textarea",{value:m,onChange:u=>f(u.target.value),className:"w-full border border-gray-300 rounded-lg p-3 text-base resize-y",rows:6,placeholder:"Add your feedback, suggestions, or remarks for this employee's performance..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{x(!1),h(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Save Remarks"})]})]})})]})}const _l=Object.freeze(Object.defineProperty({__proto__:null,ManagerEditEmployee:rl},Symbol.toStringTag,{value:"Module"}));export{Sn as $,dn as A,wl as B,st as C,vl as D,Nl as E,ss as F,Sl as G,Cl as H,js as I,Te as J,tl as K,vn as L,Ml as M,Al as N,cn as O,Dl as P,dl as Q,jl as R,Dn as S,ul as T,ml as U,hl as V,xl as W,pl as X,gl as Y,fl as Z,yl as _,ut as a,fs as a0,ys as a1,Ns as a2,Fn as a3,zn as a4,wr as a5,Nr as a6,Oe as a7,Rl as a8,Ll as a9,_l as aa,Le as b,gt as c,Ne as d,Me as e,qe as f,Ws as g,Mn as h,St as i,e as j,qn as k,$n as l,Nt as m,In as n,Tt as o,br as p,gn as q,Bs as r,El as s,qs as t,He as u,xr as v,yn as w,pr as x,kl as y,Ue as z};
