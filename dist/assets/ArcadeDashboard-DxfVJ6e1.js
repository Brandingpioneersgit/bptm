import{d as R,j as e}from"./manager-dashboard-BSBEKJka.js";import{r as n}from"./react-vendor-z5qVsTvS.js";import{c as u}from"./arcadeValidation-D-laYFZz.js";import"./shared-ui-DksRfdM8.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";import"./forms-F81hZsoD.js";const L=({currentUser:r,onNavigate:i})=>{const d=R(),[l,h]=n.useState({currentPoints:0,totalEarned:0,totalRedeemed:0,pendingActivities:0,pendingRedemptions:0}),[c,p]=n.useState([]),[o,g]=n.useState([]),[N,x]=n.useState(!0),[b,m]=n.useState(null);n.useEffect(()=>{if(r!=null&&r.id){const t=u(r);if(!t.isEligible){m(t.reason),x(!1);return}j()}},[r]);const j=async()=>{try{if(x(!0),m(null),!d)throw new Error("Database connection not available");await Promise.all([y(),v(),w()])}catch(t){console.error("Error loading arcade data:",t),m("Failed to load arcade dashboard. Please try again.")}finally{x(!1)}},y=async()=>{var t;try{const{data:s,error:a}=await d.from("arcade_employee_summary").select("*").eq("employee_id",r.id).single();if(a){if(console.error("Error fetching arcade data:",a),a.code==="PGRST116"||(t=a.message)!=null&&t.includes("does not exist")){h({currentPoints:0,totalEarned:0,totalRedeemed:0,pendingActivities:0,pendingRedemptions:0});return}throw a}s&&h({currentPoints:s.current_points||0,totalEarned:s.total_earned||0,totalRedeemed:s.total_redeemed||0,pendingActivities:s.pending_activities||0,pendingRedemptions:s.pending_redemptions||0})}catch(s){throw console.error("Error fetching arcade data:",s),s}},v=async()=>{var t;try{const{data:s,error:a}=await d.from("arcade_activities").select("*").eq("employee_id",r.id).order("created_at",{ascending:!1}).limit(5);if(a){if(console.error("Error fetching activities:",a),a.code==="PGRST116"||(t=a.message)!=null&&t.includes("does not exist")){p([]);return}throw a}p(s||[])}catch(s){throw console.error("Error fetching activities:",s),s}},w=async()=>{var t;try{const{data:s,error:a}=await d.from("arcade_redemptions").select("*").eq("employee_id",r.id).order("created_at",{ascending:!1}).limit(5);if(a){if(console.error("Error fetching redemptions:",a),a.code==="PGRST116"||(t=a.message)!=null&&t.includes("does not exist")){g([]);return}throw a}g(s||[])}catch(s){throw console.error("Error fetching redemptions:",s),s}},f=t=>{const s={pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",fulfilled:"bg-blue-100 text-blue-800"};return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s[t]||"bg-gray-100 text-gray-800"}`,children:t.charAt(0).toUpperCase()+t.slice(1)})},_=(t,s)=>{const a={client_engagement:"Client Engagement",content_creation:"Content Creation",attendance:"Attendance",performance:"Performance",polls:"Poll Performance"};return{whatsapp_appreciation:"WhatsApp Appreciation",google_review:"Google Review",video_testimonial:"Video Testimonial",client_referral:"Client Referral",bp_reel:"BP Reel",full_video:"Full Video",monthly_attendance:"100% Monthly Attendance",employee_referral:"Employee Referral",tactical_goals:"Tactical Goals",strategic_goals:"Strategic Goals",poll_first:"Poll - 1st Place",poll_second:"Poll - 2nd Place",poll_third:"Poll - 3rd Place"}[s]||`${a[t]||t} - ${s}`};if(r){const t=u(r);if(!t.isEligible)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🚫"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Restricted"}),e.jsx("p",{className:"text-gray-600 mb-4",children:t.reason}),e.jsx("button",{onClick:()=>i("agency"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"← Back to Dashboard"})]})})}return N?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your Arcade dashboard..."})]})}):b?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-red-600 mb-4",children:b}),e.jsxs("div",{className:"space-x-4",children:[e.jsx("button",{onClick:()=>j(),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700",children:"Retry"}),e.jsx("button",{onClick:()=>i("agency"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700",children:"← Back to Dashboard"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"🎮 Arcade Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",r==null?void 0:r.name,"! Ready to earn some points?"]})]}),e.jsx("button",{onClick:()=>i("agency"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"← Back to Dashboard"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Current Points"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:l.currentPoints})]}),e.jsx("div",{className:"text-purple-500 text-3xl",children:"💎"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Earned"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:l.totalEarned})]}),e.jsx("div",{className:"text-green-500 text-3xl",children:"🏆"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Redeemed"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:l.totalRedeemed})]}),e.jsx("div",{className:"text-blue-500 text-3xl",children:"🎁"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:l.pendingActivities+l.pendingRedemptions})]}),e.jsx("div",{className:"text-orange-500 text-3xl",children:"⏳"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("button",{onClick:()=>i("arcade-earn"),className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"💰"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Earn Points"}),e.jsx("p",{className:"text-green-100",children:"Log activities and earn rewards"})]})}),e.jsx("button",{onClick:()=>i("arcade-redeem"),className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"🛍️"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Redeem Rewards"}),e.jsx("p",{className:"text-purple-100",children:"Spend your points on amazing rewards"})]})}),e.jsx("button",{onClick:()=>i("arcade-history"),className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:"📊"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"View History"}),e.jsx("p",{className:"text-blue-100",children:"Track your activities and redemptions"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Recent Activities"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[c.length," activities"]})]}),c.length>0?e.jsx("div",{className:"space-y-4",children:c.map(t=>e.jsxs("div",{className:"border-l-4 border-green-400 pl-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:_(t.activity_type,t.activity_subtype)}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-green-600 font-bold",children:["+",t.points_earned]}),f(t.status)]})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:t.description}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleDateString()})]},t.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"📝"}),e.jsx("p",{className:"text-gray-500",children:"No activities yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Start earning points by logging your activities!"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Recent Redemptions"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[o.length," redemptions"]})]}),o.length>0?e.jsx("div",{className:"space-y-4",children:o.map(t=>e.jsxs("div",{className:"border-l-4 border-purple-400 pl-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.reward_name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-purple-600 font-bold",children:["-",t.points_required]}),f(t.status)]})]}),t.request_details&&e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:t.request_details}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleDateString()})]},t.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-2",children:"🎁"}),e.jsx("p",{className:"text-gray-500",children:"No redemptions yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Start redeeming your points for amazing rewards!"})]})]})]}),e.jsxs("div",{className:"mt-8 bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Quick Stats"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.totalEarned}),e.jsx("p",{className:"text-sm text-gray-600",children:"Lifetime Points"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:l.totalRedeemed}),e.jsx("p",{className:"text-sm text-gray-600",children:"Points Spent"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.filter(t=>t.status==="approved").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Approved Activities"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:o.filter(t=>t.status==="fulfilled").length}),e.jsx("p",{className:"text-sm text-gray-600",children:"Fulfilled Rewards"})]})]})]})]})})};export{L as default};
