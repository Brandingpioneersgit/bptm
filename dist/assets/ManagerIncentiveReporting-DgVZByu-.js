import{d as F,j as e}from"./manager-dashboard-BSBEKJka.js";import{r as m}from"./react-vendor-z5qVsTvS.js";import{u as U}from"./shared-ui-DksRfdM8.js";import{L as O}from"./LoadingButton-BtGitHou.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";import"./forms-F81hZsoD.js";const Z=()=>{const b=F(),{showToast:v}=U(),[f,j]=m.useState([]),[V,N]=m.useState([]),[S,w]=m.useState(!0),[u,T]=m.useState("last30days"),[g,k]=m.useState("all"),[y,R]=m.useState("all"),[D,C]=m.useState("csv");m.useEffect(()=>{E()},[]);const E=async()=>{w(!0);try{if(b){const{data:t,error:l}=await b.from("incentive_applications").select(`
            *,
            employees!inner(name, phone, department)
          `).order("created_at",{ascending:!1});l?console.error("Error loading applications:",l):j(t||[]);const{data:r,error:i}=await b.from("employees").select("*").eq("status","active");i?console.error("Error loading employees:",i):N(r||[])}else{const t=JSON.parse(localStorage.getItem("incentive_applications")||"[]"),l=JSON.parse(localStorage.getItem("employees")||"[]");j(t),N(l)}}catch(t){console.error("Error loading data:",t),v("Failed to load data","error")}finally{w(!1)}},n=m.useMemo(()=>{let t=f;g!=="all"&&(t=t.filter(i=>i.status===g)),y!=="all"&&(t=t.filter(i=>i.incentive_type===y));const l=new Date,r=new Date;switch(u){case"last7days":r.setDate(l.getDate()-7);break;case"last30days":r.setDate(l.getDate()-30);break;case"last90days":r.setDate(l.getDate()-90);break;case"thisyear":r.setFullYear(l.getFullYear(),0,1);break;default:return t}return t=t.filter(i=>new Date(i.created_at)>=r),t},[f,g,y,u]),c=m.useMemo(()=>{const t=n.length,l=n.filter(s=>s.status==="pending").length,r=n.filter(s=>s.status==="approved").length,i=n.filter(s=>s.status==="rejected").length,o=n.filter(s=>s.status==="disbursed").length,p=n.filter(s=>s.status==="disbursed").reduce((s,x)=>s+({hiring_recommendation:3e3,client_testimonial:1e3,promotional_video:500}[x.incentive_type]||0),0),a={hiring_recommendation:n.filter(s=>s.incentive_type==="hiring_recommendation").length,client_testimonial:n.filter(s=>s.incentive_type==="client_testimonial").length,promotional_video:n.filter(s=>s.incentive_type==="promotional_video").length},d={};return n.forEach(s=>{var h;const x=((h=s.employees)==null?void 0:h.department)||"Unknown";d[x]=(d[x]||0)+1}),{total:t,pending:l,approved:r,rejected:i,disbursed:o,totalDisbursed:p,byType:a,byDepartment:d,approvalRate:t>0?((r+o)/t*100).toFixed(1):0,avgProcessingTime:"2.5 days"}},[n]),L=()=>{D==="csv"?$():I()},$=()=>{const t=["Employee Name","Phone","Department","Incentive Type","Amount (INR)","Status","Applied Date","Approved Date","Disbursed Date","Disbursement Reference"],l=n.map(a=>{var s,x,h,_,A;const d={hiring_recommendation:3e3,client_testimonial:1e3,promotional_video:500};return[((s=a.employees)==null?void 0:s.name)||a.employee_name||"N/A",((x=a.employees)==null?void 0:x.phone)||a.employee_phone||"N/A",((h=a.employees)==null?void 0:h.department)||"N/A",((_=a.incentive_type)==null?void 0:_.replace("_"," ").replace(/\b\w/g,P=>P.toUpperCase()))||"N/A",d[a.incentive_type]||0,((A=a.status)==null?void 0:A.toUpperCase())||"N/A",new Date(a.created_at).toLocaleDateString(),a.approved_at?new Date(a.approved_at).toLocaleDateString():"N/A",a.disbursement_date?new Date(a.disbursement_date).toLocaleDateString():"N/A",a.disbursement_reference||"N/A"]}),r=[t,...l].map(a=>a.map(d=>`"${d}"`).join(",")).join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),p=URL.createObjectURL(i);o.setAttribute("href",p),o.setAttribute("download",`incentive_report_${new Date().toISOString().split("T")[0]}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),v("Report exported to CSV successfully","success")},I=()=>{const t=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Incentive Report</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .analytics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
          .metric-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; }
          .metric-value { font-size: 24px; font-weight: bold; color: #3b82f6; }
          .metric-label { font-size: 14px; color: #666; margin-top: 5px; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background-color: #f5f5f5; font-weight: bold; }
          .status-pending { color: #f59e0b; }
          .status-approved { color: #10b981; }
          .status-rejected { color: #ef4444; }
          .status-disbursed { color: #8b5cf6; }
          @media print { body { margin: 0; } }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Employee Incentive Report</h1>
          <p>Generated on: ${new Date().toLocaleDateString()}</p>
          <p>Period: ${u.replace(/([A-Z])/g," $1").toLowerCase()}</p>
        </div>
        
        <div class="analytics">
          <div class="metric-card">
            <div class="metric-value">${c.total}</div>
            <div class="metric-label">Total Applications</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">${c.disbursed}</div>
            <div class="metric-label">Disbursed</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">â‚¹${c.totalDisbursed.toLocaleString()}</div>
            <div class="metric-label">Total Disbursed</div>
          </div>
          <div class="metric-card">
            <div class="metric-value">${c.approvalRate}%</div>
            <div class="metric-label">Approval Rate</div>
          </div>
        </div>
        
        <table>
          <thead>
            <tr>
              <th>Employee</th>
              <th>Department</th>
              <th>Incentive Type</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Applied Date</th>
            </tr>
          </thead>
          <tbody>
            ${n.map(r=>{var o,p,a,d;const i={hiring_recommendation:3e3,client_testimonial:1e3,promotional_video:500};return`
                <tr>
                  <td>${((o=r.employees)==null?void 0:o.name)||r.employee_name||"N/A"}</td>
                  <td>${((p=r.employees)==null?void 0:p.department)||"N/A"}</td>
                  <td>${((a=r.incentive_type)==null?void 0:a.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase()))||"N/A"}</td>
                  <td>â‚¹${(i[r.incentive_type]||0).toLocaleString()}</td>
                  <td class="status-${r.status}">${((d=r.status)==null?void 0:d.toUpperCase())||"N/A"}</td>
                  <td>${new Date(r.created_at).toLocaleDateString()}</td>
                </tr>
              `}).join("")}
          </tbody>
        </table>
      </body>
      </html>
    `,l=window.open("","_blank");l.document.write(t),l.document.close(),l.focus(),l.print(),v("Report opened for printing/PDF export","success")};return S?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading incentive data..."})]}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ðŸ’° Incentive Reporting Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track and analyze employee incentive disbursements"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:D,onChange:t=>C(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"csv",children:"Export CSV"}),e.jsx("option",{value:"pdf",children:"Export PDF"})]}),e.jsx(O,{onClick:L,variant:"primary",children:"ðŸ“Š Export Report"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("select",{value:u,onChange:t=>T(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"last7days",children:"Last 7 Days"}),e.jsx("option",{value:"last30days",children:"Last 30 Days"}),e.jsx("option",{value:"last90days",children:"Last 90 Days"}),e.jsx("option",{value:"thisyear",children:"This Year"}),e.jsx("option",{value:"all",children:"All Time"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:g,onChange:t=>k(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"disbursed",children:"Disbursed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Incentive Type"}),e.jsxs("select",{value:y,onChange:t=>R(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"hiring_recommendation",children:"Hiring Recommendation (â‚¹3,000)"}),e.jsx("option",{value:"client_testimonial",children:"Client Testimonial (â‚¹1,000)"}),e.jsx("option",{value:"promotional_video",children:"Promotional Video (â‚¹500)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Applications"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.total})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ðŸ“‹"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Disbursed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.disbursed})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"âœ…"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Disbursed"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["â‚¹",c.totalDisbursed.toLocaleString()]})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ðŸ’°"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approval Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[c.approvalRate,"%"]})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"ðŸ“Š"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ðŸ“ˆ Incentive Type Breakdown"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Hiring Recommendation (â‚¹3,000)"}),e.jsx("span",{className:"font-semibold",children:c.byType.hiring_recommendation})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Client Testimonial (â‚¹1,000)"}),e.jsx("span",{className:"font-semibold",children:c.byType.client_testimonial})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Promotional Video (â‚¹500)"}),e.jsx("span",{className:"font-semibold",children:c.byType.promotional_video})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ðŸ¢ Department Breakdown"}),e.jsx("div",{className:"space-y-4",children:Object.entries(c.byDepartment).map(([t,l])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:t}),e.jsx("span",{className:"font-semibold",children:l})]},t))})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ðŸ“‹ Incentive Applications"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Showing ",n.length," applications"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Incentive Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Applied Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Disbursed Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(t=>{var i,o,p,a,d;const l={hiring_recommendation:3e3,client_testimonial:1e3,promotional_video:500},r={pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",disbursed:"bg-purple-100 text-purple-800"};return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((i=t.employees)==null?void 0:i.name)||t.employee_name||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:((o=t.employees)==null?void 0:o.phone)||t.employee_phone||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((p=t.employees)==null?void 0:p.department)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((a=t.incentive_type)==null?void 0:a.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase()))||"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["â‚¹",(l[t.incentive_type]||0).toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r[t.status]||"bg-gray-100 text-gray-800"}`,children:((d=t.status)==null?void 0:d.toUpperCase())||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.disbursement_date?new Date(t.disbursement_date).toLocaleDateString():"-"})]},t.id)})})]})}),n.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ“Š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No applications found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your filters to see more data."})]})]})]})};export{Z as default};
