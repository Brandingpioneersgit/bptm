import{d as E,u as P,t as T,j as e,m as v}from"./manager-dashboard-BSBEKJka.js";import{r}from"./react-vendor-z5qVsTvS.js";import{u as U,S as h,T as F,N,a as u}from"./shared-ui-DksRfdM8.js";import{E as D,C as q}from"./forms-F81hZsoD.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";function V({onBack:d=null,existingSubmission:n=null}){const y=E(),{notify:b}=U(),{user:K,isLoggedIn:M}=P(),[t,g]=r.useState({employee:{name:"",phone:"",department:"Web",role:[]},monthKey:T(),attendance:{wfo:0,wfh:0},tasks:{count:0,aiTableLink:"",aiTableScreenshot:""},clients:[],learning:[],aiUsageNotes:"",feedback:{company:"",hr:"",management:""},isDraft:!1}),[A,O]=r.useState(!1),[p,w]=r.useState(!1),[o,C]=r.useState({}),[i,j]=r.useState(1),m=[{id:1,title:"Employee & Month",icon:"ðŸ‘¤"},{id:2,title:"Attendance & Tasks",icon:"ðŸ“…"},{id:3,title:"Clients & KPIs",icon:"ðŸ“Š"},{id:4,title:"Learning & AI",icon:"ðŸŽ“"},{id:5,title:"Feedback & Submit",icon:"ðŸ’¬"}];r.useEffect(()=>{n&&g({employee:n.employee||{name:"",phone:"",department:"Web",role:[]},monthKey:n.month_key||T(),attendance:n.attendance||{wfo:0,wfh:0},tasks:n.tasks||{count:0,aiTableLink:"",aiTableScreenshot:""},clients:n.clients||[],learning:n.learning||[],aiUsageNotes:n.ai_usage_notes||"",feedback:n.feedback||{company:"",hr:"",management:""},isDraft:n.is_draft||!1})},[n]),r.useEffect(()=>{authState.isLoggedIn&&authState.currentUser&&!t.employee.name&&g(a=>({...a,employee:{name:authState.currentUser.name||"",phone:authState.currentUser.phone||"",department:authState.currentUser.department||"Web",role:authState.currentUser.role||[]}}))},[authState,t.employee.name]);const x=r.useCallback(a=>{const s={};switch(a){case 1:t.employee.name||(s.employeeName="Employee name is required"),t.employee.phone||(s.employeePhone="Phone number is required"),t.monthKey||(s.monthKey="Month is required");break;case 2:t.attendance.wfo<0&&(s.wfo="WFO days cannot be negative"),t.attendance.wfh<0&&(s.wfh="WFH days cannot be negative"),t.tasks.count<0&&(s.taskCount="Task count cannot be negative");break;case 3:t.clients.length===0&&(s.clients="At least one client is required");break;case 4:t.learning.length===0&&(s.learning="At least one learning activity is required");break;case 5:t.feedback.company.trim()||(s.companyFeedback="Company feedback is required");break}return C(s),Object.keys(s).length===0},[t]),S=r.useCallback(async(a=!1)=>{if(!a&&!x(5)){b("Please fix validation errors before submitting","error");return}w(!0);try{const s={employee_name:t.employee.name,employee_phone:t.employee.phone,month_key:t.monthKey,department:t.employee.department,role:t.employee.role,attendance:t.attendance,tasks_completed:t.tasks.count,ai_table_link:t.tasks.aiTableLink,ai_table_screenshot:t.tasks.aiTableScreenshot,clients:t.clients,learning:t.learning,ai_usage_notes:t.aiUsageNotes,feedback:t.feedback,is_draft:a,submitted_at:new Date().toISOString(),updated_at:new Date().toISOString()};let l;if(n?l=await y.from("submissions").update(s).eq("id",n.id).select().single():l=await y.from("submissions").insert([s]).select().single(),l.error)throw l.error;b(a?"Draft saved successfully!":n?"Tactical form updated successfully!":"Tactical form submitted successfully!","success"),!a&&d&&setTimeout(()=>d(),1500)}catch(s){console.error("Submission error:",s),b("Failed to save form. Please try again.","error")}finally{w(!1)}},[t,n,y,b,d,x]),f=r.useCallback((a,s)=>{g(l=>({...l,[a]:s})),o[a]&&C(l=>({...l,[a]:null}))},[o]),c=r.useCallback((a,s,l)=>{g(k=>({...k,[a]:{...k[a],[s]:l}}))},[]),L=r.useCallback(()=>{x(i)&&j(a=>Math.min(a+1,m.length))},[i,x]),_=r.useCallback(()=>{j(a=>Math.max(a-1,1))},[]),I=r.useCallback(a=>{j(a)},[]);return A?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading tactical form..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Monthly Tactical Form"}),e.jsxs("p",{className:"text-blue-100 mt-1",children:[v(t.monthKey)," - Step ",i," of ",m.length]})]}),d&&e.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-700 hover:bg-blue-600 rounded-lg transition-colors",children:"â† Back to Dashboard"})]})})}),e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:m.map((a,s)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:()=>I(a.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors ${i===a.id?"bg-blue-100 text-blue-700 border border-blue-200":i>a.id?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"text-lg",children:a.icon}),e.jsx("span",{className:"text-sm font-medium hidden sm:block",children:a.title})]}),s<m.length-1&&e.jsx("div",{className:`w-8 h-0.5 mx-2 ${i>a.id?"bg-green-300":"bg-gray-200"}`})]},a.id))})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[i===1&&e.jsx(h,{title:"Employee Information & Reporting Period",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(D,{value:t.employee,onChange:a=>f("employee",a),error:o.employeeName||o.employeePhone,required:!0}),e.jsx(F,{label:"Reporting Month",value:v(t.monthKey),disabled:!0,className:"bg-gray-50"})]})}),i===2&&e.jsx(h,{title:"Attendance & Task Completion",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Work Attendance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(N,{label:"Work From Office (Days)",value:t.attendance.wfo,onChange:a=>c("attendance","wfo",a),min:0,max:31,error:o.wfo}),e.jsx(N,{label:"Work From Home (Days)",value:t.attendance.wfh,onChange:a=>c("attendance","wfh",a),min:0,max:31,error:o.wfh})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Total: ",t.attendance.wfo+t.attendance.wfh," days"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Task Management"}),e.jsx(N,{label:"Tasks Completed",value:t.tasks.count,onChange:a=>c("tasks","count",a),min:0,error:o.taskCount}),e.jsx(F,{label:"AI Table Link (Optional)",value:t.tasks.aiTableLink,onChange:a=>c("tasks","aiTableLink",a),placeholder:"https://...",className:"mt-4"})]})]})}),i===3&&e.jsx(h,{title:"Client Work & KPIs",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Client Projects"}),e.jsx(q,{value:t.clients,onChange:a=>f("clients",a),error:o.clients,multiple:!0,required:!0}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Select all clients you worked with this month"})]})})}),i===4&&e.jsx(h,{title:"Learning & AI Usage",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Learning Activities"}),e.jsx(u,{label:"Learning Activities (Minimum 6 hours)",value:t.learning.map(a=>a.activity||a).join(`
`),onChange:a=>{const s=a.split(`
`).filter(l=>l.trim()).map(l=>({activity:l.trim()}));f("learning",s)},placeholder:"Enter each learning activity on a new line...\\ne.g., React Advanced Patterns - 3 hours\\nNode.js Performance Optimization - 4 hours",rows:6,error:o.learning,required:!0})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"AI Tool Usage"}),e.jsx(u,{label:"AI Usage Notes",value:t.aiUsageNotes,onChange:a=>f("aiUsageNotes",a),placeholder:"Describe how you used AI tools this month (ChatGPT, Claude, GitHub Copilot, etc.)...",rows:4})]})]})}),i===5&&e.jsx(h,{title:"Feedback & Final Review",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(u,{label:"Company Feedback",value:t.feedback.company,onChange:a=>c("feedback","company",a),placeholder:"Share your feedback about the company, processes, or suggestions for improvement...",rows:4,error:o.companyFeedback,required:!0}),e.jsx(u,{label:"HR Feedback (Optional)",value:t.feedback.hr,onChange:a=>c("feedback","hr",a),placeholder:"Any feedback specifically for HR department...",rows:3}),e.jsx(u,{label:"Management Feedback (Optional)",value:t.feedback.management,onChange:a=>c("feedback","management",a),placeholder:"Any feedback for management or leadership...",rows:3}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Submission Summary"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:["Employee: ",t.employee.name]}),e.jsxs("p",{children:["Month: ",v(t.monthKey)]}),e.jsxs("p",{children:["Total Attendance: ",t.attendance.wfo+t.attendance.wfh," days"]}),e.jsxs("p",{children:["Tasks Completed: ",t.tasks.count]}),e.jsxs("p",{children:["Clients: ",t.clients.length]}),e.jsxs("p",{children:["Learning Activities: ",t.learning.length]})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-8 pt-6 border-t",children:[e.jsx("button",{onClick:_,disabled:i===1,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"â† Previous"}),e.jsx("div",{className:"flex gap-3",children:i===m.length?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>S(!0),disabled:p,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:p?"Saving...":"Save Draft"}),e.jsx("button",{onClick:()=>S(!1),disabled:p,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:p?"Submitting...":"Submit Form"})]}):e.jsx("button",{onClick:L,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Next â†’"})})]})]})})]})}export{V as TacticalForm,V as default};
