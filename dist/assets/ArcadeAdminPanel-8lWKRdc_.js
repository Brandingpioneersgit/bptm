import{d as J,j as e}from"./manager-dashboard-BSBEKJka.js";import{r as l}from"./react-vendor-z5qVsTvS.js";import{f as K,c as Q}from"./arcadeValidation-D-laYFZz.js";import"./shared-ui-DksRfdM8.js";import"./clients-Dg_kG3rU.js";import"./supabase-vendor-D6KV1zBy.js";import"./auth-out34swX.js";import"./employees-C0R0oL0z.js";import"./forms-F81hZsoD.js";const ie=({currentUser:n,onNavigate:P})=>{var E,w;const a=J(),[y,S]=l.useState([]),[b,A]=l.useState([]),[f,C]=l.useState([]),[o,k]=l.useState({}),[R,T]=l.useState(!0),[p,q]=l.useState("activities"),[X,Y]=l.useState(""),[M,I]=l.useState([]),[D,v]=l.useState(!1),[r,c]=l.useState({employee_id:"",escalation_type:"",escalation_subtype:"",description:"",points_deducted:0});l.useEffect(()=>{n!=null&&n.id&&(j(),u(),N(),h(),L())},[n]);const L=async()=>{try{const{data:t,error:s}=await a.from("employees").select("id, name, email, department").neq("department","HR").order("name");if(s){console.error("Error fetching employees:",s);return}I(t||[])}catch(t){console.error("Error:",t)}},j=async()=>{try{const{data:t,error:s}=await a.from("arcade_activities").select(`
          *,
          employees!inner(name, email, department)
        `).eq("status","pending").order("created_at",{ascending:!1});if(s){console.error("Error fetching pending activities:",s);return}S(t||[])}catch(t){console.error("Error:",t)}},u=async()=>{try{const{data:t,error:s}=await a.from("arcade_redemptions").select(`
          *,
          employees!inner(name, email, department)
        `).eq("status","pending").order("created_at",{ascending:!1});if(s){console.error("Error fetching pending redemptions:",s);return}A(t||[])}catch(t){console.error("Error:",t)}},N=async()=>{try{const{data:t,error:s}=await a.from("arcade_escalations").select(`
          *,
          employees!inner(name, email, department)
        `).order("created_at",{ascending:!1}).limit(50);if(s){console.error("Error fetching escalations:",s);return}C(t||[])}catch(t){console.error("Error:",t)}},h=async()=>{try{const{data:t,error:s}=await a.from("arcade_employee_summary").select("*");if(s){console.error("Error fetching summary:",s);return}const i=(t==null?void 0:t.length)||0,d=(t==null?void 0:t.reduce((m,x)=>m+(x.total_points_earned||0),0))||0,g=(t==null?void 0:t.reduce((m,x)=>m+(x.total_points_redeemed||0),0))||0,W=i>0?Math.round(d/i):0,H=(t==null?void 0:t.sort((m,x)=>(x.current_points||0)-(m.current_points||0)).slice(0,5))||[];k({totalEmployees:i,totalPointsEarned:d,totalPointsRedeemed:g,averagePoints:W,topPerformers:H})}catch(t){console.error("Error:",t)}finally{T(!1)}},O=async t=>{try{const{error:s}=await a.from("arcade_activities").update({status:"approved",approved_by:n.id,approved_at:new Date().toISOString()}).eq("id",t);if(s){console.error("Error approving activity:",s),alert("Error approving activity");return}alert("Activity approved successfully!"),j(),h()}catch(s){console.error("Error:",s),alert("Error approving activity")}},F=async t=>{try{const{error:s}=await a.from("arcade_activities").update({status:"rejected",approved_by:n.id,approved_at:new Date().toISOString()}).eq("id",t);if(s){console.error("Error rejecting activity:",s),alert("Error rejecting activity");return}alert("Activity rejected successfully!"),j()}catch(s){console.error("Error:",s),alert("Error rejecting activity")}},V=async t=>{try{const{error:s}=await a.from("arcade_redemptions").update({status:"approved",approved_by:n.id,approved_at:new Date().toISOString()}).eq("id",t);if(s){console.error("Error approving redemption:",s),alert("Error approving redemption");return}alert("Redemption approved successfully!"),u(),h()}catch(s){console.error("Error:",s),alert("Error approving redemption")}},$=async t=>{try{const{error:s}=await a.from("arcade_redemptions").update({status:"rejected",approved_by:n.id,approved_at:new Date().toISOString()}).eq("id",t);if(s){console.error("Error rejecting redemption:",s),alert("Error rejecting redemption");return}alert("Redemption rejected successfully!"),u()}catch(s){console.error("Error:",s),alert("Error rejecting redemption")}},z=async t=>{try{const{error:s}=await a.from("arcade_redemptions").update({status:"fulfilled",fulfilled_at:new Date().toISOString()}).eq("id",t);if(s){console.error("Error fulfilling redemption:",s),alert("Error fulfilling redemption");return}alert("Redemption marked as fulfilled!"),u()}catch(s){console.error("Error:",s),alert("Error fulfilling redemption")}},B=async t=>{t.preventDefault();try{const s=K(r,n);if(!s.isValid){alert(s.errors.join(". "));return}const{data:i}=await a.from("employees").select("*").eq("id",r.employee_id).single();if(i){const g=Q(i);if(!g.isEligible){alert(`Target employee is not eligible for Arcade Program: ${g.reason}`);return}}const{error:d}=await a.from("arcade_escalations").insert([{employee_id:r.employee_id,escalation_type:r.escalation_type,escalation_subtype:r.escalation_subtype,description:r.description,points_deducted:r.points_deducted,reported_by:n.id}]);if(d){console.error("Error creating escalation:",d),alert("Error creating escalation");return}alert("Escalation created successfully!"),v(!1),c({employee_id:"",escalation_type:"",escalation_subtype:"",description:"",points_deducted:0}),N(),h()}catch(s){console.error("Error:",s),alert("Error creating escalation")}},_=t=>({client_issues:[{value:"whatsapp_complaint",label:"WhatsApp Complaint (-2 pts)",points:2},{value:"call_escalation",label:"Call Escalation (-5 pts)",points:5},{value:"non_response",label:"Non-response to Client (-2 pts/day)",points:2},{value:"client_loss",label:"Client Loss (-30 pts)",points:30}],meeting_attendance:[{value:"daily_operations",label:"Daily Operations (-1 pt)",points:1},{value:"tactical",label:"Tactical (-3 pts)",points:3},{value:"strategic",label:"Strategic (-5 pts)",points:5}],performance_issues:[{value:"missed_deadline",label:"Missed Deadline (-3 pts)",points:3},{value:"missed_tactical_target",label:"Missed Tactical Target (-1 pt)",points:1},{value:"missed_strategic_target",label:"Missed Strategic Target (-2 pts)",points:2},{value:"late_payments",label:"Late Payments (-2 pts/month)",points:2}],behavioral_issues:[{value:"colleague_misbehavior",label:"Colleague Misbehavior (-10 pts)",points:10},{value:"unannounced_leaves",label:"Unannounced Leaves (-5 pts)",points:5}]})[t]||[],G=(t,s)=>{const i={client_engagement:"Client Engagement",content_creation:"Content Creation",attendance:"Attendance",performance:"Performance",polls:"Poll Performance"};return{whatsapp_appreciation:"WhatsApp Appreciation",google_review:"Google Review",video_testimonial:"Video Testimonial",client_referral:"Client Referral",bp_reel:"BP Reel",full_video:"Full Video",monthly_attendance:"100% Monthly Attendance",employee_referral:"Employee Referral",tactical_goals:"Tactical Goals",strategic_goals:"Strategic Goals",poll_first:"Poll - 1st Place",poll_second:"Poll - 2nd Place",poll_third:"Poll - 3rd Place"}[s]||`${i[t]||t} - ${s}`};return R?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading admin panel..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"ðŸŽ® Arcade Admin Panel"}),e.jsx("p",{className:"text-gray-600",children:"Manage the Arcade program and employee activities"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>v(!0),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"âš ï¸ Create Escalation"}),e.jsx("button",{onClick:()=>P("dashboard"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"â† Back to Dashboard"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-3xl mr-4",children:"ðŸ‘¥"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.totalEmployees})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-3xl mr-4",children:"ðŸ’°"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Points Earned"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.totalPointsEarned})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-3xl mr-4",children:"ðŸ›ï¸"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Points Redeemed"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.totalPointsRedeemed})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-3xl mr-4",children:"ðŸ“Š"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Points"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.averagePoints})]})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{key:"activities",label:"Pending Activities",icon:"ðŸ’°",count:y.length},{key:"redemptions",label:"Pending Redemptions",icon:"ðŸ›ï¸",count:b.length},{key:"escalations",label:"Recent Escalations",icon:"âš ï¸",count:f.length},{key:"analytics",label:"Top Performers",icon:"ðŸ†",count:((E=o.topPerformers)==null?void 0:E.length)||0}].map(t=>e.jsxs("button",{onClick:()=>q(t.key),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${p===t.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{children:t.icon}),e.jsx("span",{children:t.label}),e.jsx("span",{className:"bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs",children:t.count})]},t.key))})})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg",children:[p==="activities"&&e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Pending Activities"}),y.length>0?e.jsx("div",{className:"space-y-4",children:y.map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:G(t.activity_type,t.activity_subtype)}),e.jsxs("span",{className:"font-bold text-green-600",children:["+",t.points_earned," pts"]})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["ðŸ‘¤ ",t.employees.name]}),e.jsxs("span",{children:["ðŸ“§ ",t.employees.email]}),e.jsxs("span",{children:["ðŸ¢ ",t.employees.department]}),e.jsxs("span",{children:["ðŸ“… ",new Date(t.created_at).toLocaleDateString()]})]}),t.proof_url&&e.jsx("a",{href:t.proof_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm mt-2 inline-block",children:"ðŸ“Ž View Proof"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>O(t.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors",children:"âœ… Approve"}),e.jsx("button",{onClick:()=>F(t.id),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors",children:"âŒ Reject"})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"âœ…"}),e.jsx("p",{className:"text-gray-500",children:"No pending activities"})]})]}),p==="redemptions"&&e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Pending Redemptions"}),b.length>0?e.jsx("div",{className:"space-y-4",children:b.map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.reward_name}),e.jsxs("span",{className:"font-bold text-purple-600",children:["-",t.points_required," pts"]}),e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs capitalize",children:t.reward_type.replace("_"," ")})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.request_details}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["ðŸ‘¤ ",t.employees.name]}),e.jsxs("span",{children:["ðŸ“§ ",t.employees.email]}),e.jsxs("span",{children:["ðŸ¢ ",t.employees.department]}),e.jsxs("span",{children:["ðŸ“… ",new Date(t.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>V(t.id),className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors",children:"âœ… Approve"}),e.jsx("button",{onClick:()=>$(t.id),className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors",children:"âŒ Reject"}),t.status==="approved"&&e.jsx("button",{onClick:()=>z(t.id),className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors",children:"ðŸ“¦ Fulfill"})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"âœ…"}),e.jsx("p",{className:"text-gray-500",children:"No pending redemptions"})]})]}),p==="escalations"&&e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Recent Escalations"}),f.length>0?e.jsx("div",{className:"space-y-4",children:f.map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"font-medium text-gray-900 capitalize",children:[t.escalation_type.replace("_"," ")," - ",t.escalation_subtype.replace("_"," ")]}),e.jsxs("span",{className:"font-bold text-red-600",children:["-",t.points_deducted," pts"]})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["ðŸ‘¤ ",t.employees.name]}),e.jsxs("span",{children:["ðŸ“§ ",t.employees.email]}),e.jsxs("span",{children:["ðŸ¢ ",t.employees.department]}),e.jsxs("span",{children:["ðŸ“… ",new Date(t.created_at).toLocaleDateString()]})]})]})})},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"ðŸ“‹"}),e.jsx("p",{className:"text-gray-500",children:"No escalations found"})]})]}),p==="analytics"&&e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Top Performers"}),((w=o.topPerformers)==null?void 0:w.length)>0?e.jsx("div",{className:"space-y-4",children:o.topPerformers.map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"text-2xl",children:s===0?"ðŸ¥‡":s===1?"ðŸ¥ˆ":s===2?"ðŸ¥‰":"ðŸ…"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.employee_name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.department})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:[t.current_points," pts"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Earned: ",t.total_points_earned]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Redeemed: ",t.total_points_redeemed]})]})]})},t.employee_id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"ðŸ†"}),e.jsx("p",{className:"text-gray-500",children:"No performance data available"})]})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Create Escalation"}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),e.jsxs("select",{value:r.employee_id,onChange:t=>c({...r,employee_id:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),M.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.department]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Escalation Type"}),e.jsxs("select",{value:r.escalation_type,onChange:t=>{c({...r,escalation_type:t.target.value,escalation_subtype:"",points_deducted:0})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"client_issues",children:"Client Issues"}),e.jsx("option",{value:"meeting_attendance",children:"Meeting Attendance"}),e.jsx("option",{value:"performance_issues",children:"Performance Issues"}),e.jsx("option",{value:"behavioral_issues",children:"Behavioral Issues"})]})]}),r.escalation_type&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specific Issue"}),e.jsxs("select",{value:r.escalation_subtype,onChange:t=>{const s=_(r.escalation_type).find(i=>i.value===t.target.value);c({...r,escalation_subtype:t.target.value,points_deducted:(s==null?void 0:s.points)||0})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Issue"}),_(r.escalation_type).map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Points to Deduct"}),e.jsx("input",{type:"number",value:r.points_deducted,onChange:t=>c({...r,points_deducted:parseInt(t.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>c({...r,description:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:"3",placeholder:"Provide details about the escalation...",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Create Escalation"})]})]})]})})]})})};export{ie as default};
